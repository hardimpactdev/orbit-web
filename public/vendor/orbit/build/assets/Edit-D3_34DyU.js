import{d as U,k as F,z as O,c as u,g as o,a as r,u as t,h as B,w as d,b as a,C as $,l as V,p as z,m as S,f,t as p,A,B as I,r as h,s as y,F as q,o as m}from"./app-DCjzOA_Z.js";import{_ as M}from"./Heading.vue_vue_type_script_setup_true_lang-BwQHPwFZ.js";import{X as v,Y as x,I as T}from"./craft-ui-LxbrBGk3.js";import{T as P}from"./triangle-alert-D-OmGdw0.js";const R={class:"mb-6"},X={class:"space-y-6"},H={key:0,class:"mt-2 text-sm text-red-400"},J={class:"flex items-center"},Y={class:"space-y-6"},K={class:"grid grid-cols-2 gap-4"},G={key:0,class:"mt-2 text-sm text-red-400"},Q={key:0,class:"mt-2 text-sm text-red-400"},W={key:0,class:"mt-2 text-sm text-red-400"},Z={class:"pt-6 border-t border-border"},ee={class:"flex items-center"},te={class:"mt-2 text-sm text-muted-foreground"},se={class:"font-mono text-foreground"},re={key:0,class:"mt-2 text-sm text-muted-foreground"},oe={key:1,class:"mt-2 text-sm text-amber-400 flex items-center"},le={class:"mt-8 flex gap-3"},me=U({__name:"Edit",props:{server:{}},setup(k){const i=k,s=F({name:i.server.name,host:i.server.host,user:i.server.user,port:i.server.port,is_local:i.server.is_local}),c=h(""),_=h(!0),g=h(null),b=h({}),w=y(()=>c.value||"test"),C=y(()=>{const n=c.value||"test";return Object.entries(b.value).filter(([e,l])=>l===n&&parseInt(e)!==i.server.id).map(([e])=>parseInt(e))}),N=y(()=>C.value.length>0),D=async()=>{try{const e=await(await fetch(`/environments/${i.server.id}/config`)).json();e.success&&e.data&&(g.value=e.data,c.value=e.data.tld||"test")}catch(n){console.error("Failed to load config:",n)}finally{_.value=!1}},j=async()=>{try{const e=await(await fetch("/api/environments/tlds")).json();e.success&&(b.value=e.data||{})}catch(n){console.error("Failed to load other server TLDs:",n)}},E=async()=>{const n=c.value.trim()||"test";if(!g.value)return{success:!1,error:"Config not loaded"};try{const e=await fetch(`/environments/${i.server.id}/config`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({paths:g.value.paths||[],tld:n,default_php_version:g.value.default_php_version||"8.4"})});if(!e.ok){const l=await e.text();try{return{success:!1,error:JSON.parse(l).message||"Request failed"}}catch{return{success:!1,error:`Server error: ${e.status}`}}}return await e.json()}catch(e){return{success:!1,error:e.message}}},L=async()=>{const n=await E();if(!n.success){alert("Failed to save TLD configuration: "+(n.error||"Unknown error"));return}s.put(`/environments/${i.server.id}`)};return O(()=>{D(),j()}),(n,e)=>(m(),u(q,null,[o(t(B),{title:"Edit Environment"}),r("div",null,[r("div",R,[o(t(V),{href:"/servers",class:"text-zinc-400 hover:text-white flex items-center transition-colors text-sm"},{default:d(()=>[o(t($),{class:"w-4 h-4 mr-1"}),e[6]||(e[6]=a(" Back to Environments ",-1))]),_:1})]),o(M,{title:"Edit Environment"}),r("form",{onSubmit:z(L,["prevent"]),class:"mt-8 max-w-lg"},[r("div",X,[r("div",null,[o(t(v),{for:"name",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[7]||(e[7]=[a("Name",-1)])]),_:1}),o(t(x),{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=l=>t(s).name=l),type:"text",id:"name",required:"",class:"w-full"},null,8,["modelValue"]),t(s).errors.name?(m(),u("p",H,p(t(s).errors.name),1)):f("",!0)]),r("div",J,[S(r("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t(s).is_local=l),type:"checkbox",id:"is_local",class:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-lime-400 focus:ring-lime-400/20 focus:ring-offset-0"},null,512),[[A,t(s).is_local]]),o(t(v),{for:"is_local",class:"ml-2 text-muted-foreground"},{default:d(()=>[...e[8]||(e[8]=[a(" This is a local environment ",-1)])]),_:1})]),S(r("div",Y,[r("div",K,[r("div",null,[o(t(v),{for:"host",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[9]||(e[9]=[a("Host",-1)])]),_:1}),o(t(x),{modelValue:t(s).host,"onUpdate:modelValue":e[2]||(e[2]=l=>t(s).host=l),type:"text",id:"host",class:"w-full"},null,8,["modelValue"]),t(s).errors.host?(m(),u("p",G,p(t(s).errors.host),1)):f("",!0)]),r("div",null,[o(t(v),{for:"port",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[10]||(e[10]=[a("Port",-1)])]),_:1}),o(t(x),{modelValue:t(s).port,"onUpdate:modelValue":e[3]||(e[3]=l=>t(s).port=l),type:"number",id:"port",class:"w-full"},null,8,["modelValue"]),t(s).errors.port?(m(),u("p",Q,p(t(s).errors.port),1)):f("",!0)])]),r("div",null,[o(t(v),{for:"user",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[11]||(e[11]=[a("SSH User",-1)])]),_:1}),o(t(x),{modelValue:t(s).user,"onUpdate:modelValue":e[4]||(e[4]=l=>t(s).user=l),type:"text",id:"user",class:"w-full"},null,8,["modelValue"]),t(s).errors.user?(m(),u("p",W,p(t(s).errors.user),1)):f("",!0)])],512),[[I,!t(s).is_local]]),r("div",Z,[e[15]||(e[15]=r("h3",{class:"text-sm font-medium text-foreground mb-4"},"DNS Configuration",-1)),r("div",null,[o(t(v),{for:"tld",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[12]||(e[12]=[a(" TLD (Top-Level Domain) ",-1)])]),_:1}),r("div",ee,[e[13]||(e[13]=r("span",{class:"text-muted-foreground mr-1"},".",-1)),o(t(x),{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value=l),type:"text",id:"tld",placeholder:"test",class:"w-32 font-mono"},null,8,["modelValue"])]),r("p",te,[e[14]||(e[14]=a(" Sites will be accessible at ",-1)),r("span",se,"sitename."+p(w.value),1)]),_.value?(m(),u("p",re," Loading current TLD... ")):f("",!0),N.value?(m(),u("p",oe,[o(t(P),{class:"w-4 h-4 mr-1"}),a(" Another environment is using ."+p(w.value)+" - this may cause DNS conflicts ",1)])):f("",!0)])])]),r("div",le,[o(t(T),{type:"submit",disabled:t(s).processing,variant:"secondary"},{default:d(()=>[...e[16]||(e[16]=[a(" Save Changes ",-1)])]),_:1},8,["disabled"]),o(t(T),{"as-child":"",variant:"ghost"},{default:d(()=>[o(t(V),{href:"/servers"},{default:d(()=>[...e[17]||(e[17]=[a("Cancel",-1)])]),_:1})]),_:1})])],32)])],64))}});export{me as default};
