import{c as oe,d as ke,Z as fe,B as xe,a as r,h as i,g as C,r as u,u as a,i as he,b as t,w as d,l as B,_ as Y,t as m,e as p,f as k,T as we,P as Z,$ as J,F,j as V,o,z as K,s as Q,v as ee,L as te,I as h,X as ge,a0 as ye}from"./app-DiMZxkRm.js";import{a as _}from"./axios-C06TfyrI.js";import{_ as se}from"./Modal.vue_vue_type_script_setup_true_lang-3JyK5hnx.js";import{_ as be}from"./EditorIcon.vue_vue_type_script_setup_true_lang-DsaaiWj1.js";import{I as v}from"./craft-ui-CGsjg9tx.js";import{A as R}from"./arrow-left-CBgbbb5d.js";import{L as z}from"./loader-circle-CyQlpWW1.js";import{X as _e}from"./x-BW73i5Ij.js";import{P as ne}from"./package-BbMzqieu.js";const ae=oe("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const ze=oe("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),$e={key:0},Pe={class:"flex items-center gap-4 mb-8"},Ce={class:"flex items-center gap-2"},je={class:"text-2xl font-semibold tracking-tight text-zinc-100"},Le={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Ae={key:1},Ue={class:"flex items-center gap-4 mb-8"},Fe={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Se={class:"text-red-400 mb-4"},Ie={key:2},We={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Me={class:"flex items-center gap-4"},Te={class:"flex items-center gap-2"},Be={class:"text-2xl font-semibold tracking-tight text-zinc-100"},Ve={class:"text-sm text-zinc-500 mt-1"},De={class:"flex items-center gap-2"},Ee={class:"space-y-6"},Ne={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Re={key:0,class:"p-8 text-center"},qe={class:"flex h-12 w-12 mx-auto items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50 mb-4"},He={key:1,class:"divide-y divide-zinc-800/50"},Oe={class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},Xe=["onClick"],Ge={class:"flex-1 min-w-0"},Ye={class:"flex items-center gap-2 flex-wrap"},Ze={class:"font-medium text-sm text-zinc-100"},Je={class:"text-xs text-zinc-500 font-mono"},Ke={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},Qe={key:0,class:"px-4 pb-4 pl-16 border-t border-zinc-800/50 bg-zinc-900/30"},et={class:"pt-4"},tt={class:"flex items-center gap-2 mb-3"},st={key:0,class:"py-3 text-center"},nt={key:1,class:"py-2"},at={key:2,class:"space-y-1"},ot={class:"flex items-center gap-2"},it={class:"text-sm text-zinc-300 font-mono"},lt={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},rt={class:"divide-y divide-zinc-800/50"},ct={class:"flex items-center gap-4 px-4 py-3"},dt={class:"font-mono text-sm text-zinc-300"},ut={class:"flex items-center gap-4 px-4 py-3"},mt={class:"flex items-center gap-2"},vt={class:"font-mono text-sm text-zinc-300"},pt={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-lime-500/10 text-lime-400 ring-1 ring-inset ring-lime-500/20"},kt={class:"flex items-center gap-4 px-4 py-3"},ft={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-lime-500/10 text-lime-400 ring-1 ring-inset ring-lime-500/20"},xt={key:1,class:"text-sm text-zinc-500"},ht={class:"p-6"},wt={key:0,class:"text-center py-6"},gt={key:1,class:"text-center py-6"},yt={key:2},bt=["value"],_t={class:"flex justify-end gap-3 mt-6"},zt={class:"p-6"},$t={class:"text-zinc-400 mb-4"},Pt={class:"text-white font-medium"},Ct={key:0,class:"text-center py-6"},jt={key:1},Lt=["value"],At={class:"flex justify-end gap-3 mt-6"},Dt=ke({layout:fe,__name:"Show",props:{environment:{},workspaceName:{},editor:{},remoteApiUrl:{}},setup(f){const c=f,w=s=>c.remoteApiUrl?`${c.remoteApiUrl}${s}`:`/api/environments/${c.environment.id}${s}`,l=u(null),D=u(!0),j=u(null),L=u(!1),$=u(""),S=u(!1),I=u(null);async function ie(){D.value=!0,j.value=null;try{const{data:s}=await _.get(w(`/workspaces/${c.workspaceName}`));s.success&&s.data?l.value=s.data:j.value=s.error||"Workspace not found"}catch(s){if(te.isCancel(s))return;console.error("Failed to load workspace:",s),j.value="Failed to load workspace"}finally{D.value=!1}}const W=u([]),E=u(!1),g=u(new Set),A=u({}),y=u(new Set),U=u(!1),P=u(null),b=u(""),M=u(!1),T=u(null),q=K(()=>{if(!l.value)return[];const s=new Set(l.value.projects.map(e=>e.name));return W.value.filter(e=>!s.has(e.name))}),H=async()=>{if(L.value=!0,W.value.length===0){E.value=!0;try{const{data:s}=await _.get(w("/projects"));s.success&&s.data?.projects&&(W.value=s.data.projects)}catch(s){if(te.isCancel(s))return;console.error("Failed to load projects:",s)}finally{E.value=!1}}},le=()=>{if(!l.value)return;const e=`${l.value.path}/${l.value.name}.code-workspace`;let n;if(c.environment.external_access||!c.environment.is_local){const x=c.environment.user,G=c.environment.external_access&&c.environment.external_host?c.environment.external_host:c.environment.host;n=`${c.editor.scheme}://vscode-remote/ssh-remote+${x}@${G}${e}?windowId=_blank`}else n=`${c.editor.scheme}://file${e}`;window.open(n,"_blank")},re=()=>{if(!l.value)return;const s=c.environment.user,e=c.environment.external_access&&c.environment.external_host?c.environment.external_host:c.environment.host,n=`ssh://${s}@${e}${l.value.path}`;window.open(n,"_self")},ce=async()=>{if(!$.value||!l.value)return;const s=$.value;S.value=!0;try{const{data:e}=await _.post(w(`/workspaces/${l.value.name}/projects`),{project:s},{});e.success&&e.workspace?(l.value=e.workspace,h.success(`Project "${s}" added to workspace`)):h.error("Failed to add project",{description:e.error||"Unknown error"}),L.value=!1,$.value=""}catch{}finally{S.value=!1}},de=async s=>{if(l.value){I.value=s;try{const{data:e}=await _.delete(w(`/workspaces/${l.value.name}/projects/${s}`),{});e.success&&e.workspace?(l.value=e.workspace,h.success(`Project "${s}" removed from workspace`)):h.error("Failed to remove project",{description:e.error||"Unknown error"})}catch{}finally{I.value=null}}},O=s=>W.value.find(n=>n.name===s)?.display_name||s,ue=s=>{g.value.has(s)?g.value.delete(s):(g.value.add(s),A.value[s]||N(s)),g.value=new Set(g.value)},N=async s=>{y.value.add(s),y.value=new Set(y.value);try{const{data:e}=await _.get(w(`/packages/${s}/linked`),{});e.success&&(A.value[s]=e.linked_packages||[])}catch{}finally{y.value.delete(s),y.value=new Set(y.value)}},X=K(()=>!P.value||!l.value?[]:l.value.projects.filter(s=>s.name!==P.value)),me=s=>{P.value=s,b.value="",U.value=!0},ve=async()=>{if(!b.value||!P.value)return;const s=b.value,e=P.value;M.value=!0;try{const{data:n}=await _.post(w(`/packages/${e}/link`),{package:s},{});n.success?(h.success(`Package "${s}" linked to "${e}"`),await N(e)):h.error("Failed to link package",{description:n.error||"Unknown error"}),U.value=!1,b.value=""}catch{}finally{M.value=!1}},pe=async(s,e)=>{T.value=`${s}:${e}`;try{const{data:n}=await _.delete(w(`/packages/${s}/unlink/${encodeURIComponent(e)}`),{});n.success?(h.success(`Package "${e}" unlinked from "${s}"`),await N(s)):h.error("Failed to unlink package",{description:n.error||"Unknown error"})}catch{}finally{T.value=null}};return xe(()=>{ie()}),(s,e)=>(o(),r(F,null,[i(a(he),{title:`${l.value?.name||f.workspaceName} - Workspaces`},null,8,["title"]),D.value?(o(),r("div",$e,[t("header",Pe,[i(a(B),{href:`/environments/${f.environment.id}/workspaces`,class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50 text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors"},{default:d(()=>[i(a(R),{class:"w-4 h-4"})]),_:1},8,["href"]),t("div",null,[t("div",Ce,[i(a(Y),{class:"w-5 h-5 text-lime-400"}),t("h1",je,m(f.workspaceName),1)])])]),t("div",Le,[i(a(z),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[6]||(e[6]=t("p",{class:"text-zinc-500"},"Loading workspace...",-1))])])):j.value?(o(),r("div",Ae,[t("header",Ue,[i(a(B),{href:`/environments/${f.environment.id}/workspaces`,class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50 text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors"},{default:d(()=>[i(a(R),{class:"w-4 h-4"})]),_:1},8,["href"]),e[7]||(e[7]=t("div",null,[t("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"}," Workspace Not Found ")],-1))]),t("div",Fe,[t("p",Se,m(j.value),1),i(a(v),{"as-child":"",variant:"secondary",size:"sm"},{default:d(()=>[i(a(B),{href:`/environments/${f.environment.id}/workspaces`},{default:d(()=>[...e[8]||(e[8]=[p(" Back to Workspaces ",-1)])]),_:1},8,["href"])]),_:1})])])):l.value?(o(),r("div",Ie,[t("header",We,[t("div",Me,[i(a(B),{href:`/environments/${f.environment.id}/workspaces`,class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50 text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors"},{default:d(()=>[i(a(R),{class:"w-4 h-4"})]),_:1},8,["href"]),t("div",null,[t("div",Te,[i(a(Y),{class:"w-5 h-5 text-lime-400"}),t("h1",Be,m(l.value.name),1)]),t("p",Ve,m(l.value.project_count)+" project"+m(l.value.project_count!==1?"s":""),1)])]),t("div",De,[f.environment.external_access?(o(),k(a(v),{key:0,onClick:re,variant:"secondary",size:"sm",title:"Open in Terminal"},{default:d(()=>[i(a(we),{class:"w-4 h-4 mr-1.5"}),e[9]||(e[9]=p(" SSH ",-1))]),_:1})):C("",!0),l.value.has_workspace_file?(o(),k(a(v),{key:1,onClick:le,variant:"secondary",size:"sm"},{default:d(()=>[i(be,{editor:f.editor.scheme,class:"w-4 h-4 mr-1.5"},null,8,["editor"]),p(" Open in "+m(f.editor.name),1)]),_:1})):C("",!0),i(a(v),{onClick:H,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:d(()=>[i(a(Z),{class:"w-4 h-4 mr-1.5"}),e[10]||(e[10]=p(" Add Project ",-1))]),_:1})])]),t("div",Ee,[t("div",Ne,[e[15]||(e[15]=t("div",{class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},[t("h2",{class:"text-sm font-medium text-zinc-100"},"Projects")],-1)),l.value.projects.length===0?(o(),r("div",Re,[t("div",qe,[i(a(J),{class:"w-6 h-6 text-zinc-400"})]),e[12]||(e[12]=t("p",{class:"text-zinc-500 mb-4"},"No projects in this workspace yet.",-1)),i(a(v),{onClick:H,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:d(()=>[i(a(Z),{class:"w-4 h-4 mr-1.5"}),e[11]||(e[11]=p(" Add Your First Project ",-1))]),_:1})])):(o(),r("div",He,[(o(!0),r(F,null,V(l.value.projects,n=>(o(),r("div",{key:n.name},[t("div",Oe,[t("button",{onClick:x=>ue(n.name),class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50 text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors"},[g.value.has(n.name)?(o(),k(a(ge),{key:0,class:"w-4 h-4"})):(o(),k(a(ye),{key:1,class:"w-4 h-4"}))],8,Xe),t("div",Ge,[t("div",Ye,[i(a(J),{class:"w-4 h-4 text-lime-400"}),t("span",Ze,m(O(n.name)),1),t("span",Je,m(n.name),1)])]),t("div",Ke,[i(a(v),{onClick:x=>me(n.name),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Link a package"},{default:d(()=>[i(a(ae),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"]),i(a(v),{onClick:x=>de(n.name),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",disabled:I.value===n.name,title:"Remove project"},{default:d(()=>[I.value===n.name?(o(),k(a(z),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(o(),k(a(_e),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])])]),g.value.has(n.name)?(o(),r("div",Qe,[t("div",et,[t("div",tt,[i(a(ne),{class:"w-3.5 h-3.5 text-zinc-500"}),e[13]||(e[13]=t("span",{class:"text-xs text-zinc-500 uppercase tracking-wider font-medium"},"Linked Packages",-1))]),y.value.has(n.name)?(o(),r("div",st,[i(a(z),{class:"w-4 h-4 animate-spin text-zinc-500 mx-auto"})])):!A.value[n.name]||A.value[n.name].length===0?(o(),r("div",nt,[...e[14]||(e[14]=[t("p",{class:"text-xs text-zinc-500"},"No packages linked.",-1)])])):(o(),r("div",at,[(o(!0),r(F,null,V(A.value[n.name],x=>(o(),r("div",{key:x.name,class:"flex items-center justify-between py-2 px-3 rounded-md bg-zinc-800/50 border border-zinc-700/50"},[t("div",ot,[i(a(ne),{class:"w-3.5 h-3.5 text-amber-400"}),t("span",it,m(x.name),1)]),i(a(v),{onClick:G=>pe(n.name,x.name),variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-red-400 hover:bg-zinc-700",disabled:T.value===`${n.name}:${x.name}`,title:"Unlink package"},{default:d(()=>[T.value===`${n.name}:${x.name}`?(o(),k(a(z),{key:0,class:"w-3 h-3 animate-spin"})):(o(),k(a(ze),{key:1,class:"w-3 h-3"}))]),_:2},1032,["onClick","disabled"])]))),128))]))])])):C("",!0)]))),128))]))]),t("div",lt,[e[19]||(e[19]=t("div",{class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},[t("h2",{class:"text-sm font-medium text-zinc-100"},"Workspace Info")],-1)),t("div",rt,[t("div",ct,[e[16]||(e[16]=t("span",{class:"text-sm text-zinc-500 w-28 shrink-0"},"Path",-1)),t("span",dt,m(l.value.path),1)]),t("div",ut,[e[17]||(e[17]=t("span",{class:"text-sm text-zinc-500 w-28 shrink-0"},"Workspace file",-1)),t("div",mt,[t("span",vt,m(l.value.name)+".code-workspace",1),l.value.has_workspace_file?(o(),r("span",pt," Ready ")):C("",!0)])]),t("div",kt,[e[18]||(e[18]=t("span",{class:"text-sm text-zinc-500 w-28 shrink-0"},"CLAUDE.md",-1)),l.value.has_claude_md?(o(),r("span",ft," Present ")):(o(),r("span",xt,"Not found"))])])])])])):C("",!0),i(se,{show:L.value,title:"Add Project to Workspace",onClose:e[2]||(e[2]=n=>L.value=!1)},{default:d(()=>[t("div",ht,[E.value?(o(),r("div",wt,[i(a(z),{class:"w-6 h-6 mx-auto text-zinc-400 animate-spin mb-2"}),e[20]||(e[20]=t("p",{class:"text-zinc-400"},"Loading projects...",-1))])):q.value.length===0?(o(),r("div",gt,[...e[21]||(e[21]=[t("p",{class:"text-zinc-400"},"All projects are already in this workspace.",-1)])])):(o(),r("div",yt,[e[23]||(e[23]=t("label",{for:"project-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a project ",-1)),Q(t("select",{id:"project-select","onUpdate:modelValue":e[0]||(e[0]=n=>$.value=n),class:"w-full"},[e[22]||(e[22]=t("option",{value:""},"Choose a project...",-1)),(o(!0),r(F,null,V(q.value,n=>(o(),r("option",{key:n.name,value:n.name},m(n.display_name||n.name),9,bt))),128))],512),[[ee,$.value]])])),t("div",_t,[i(a(v),{onClick:e[1]||(e[1]=n=>L.value=!1),variant:"ghost"},{default:d(()=>[...e[24]||(e[24]=[p("Cancel",-1)])]),_:1}),i(a(v),{onClick:ce,variant:"secondary",disabled:!$.value||S.value},{default:d(()=>[S.value?(o(),k(a(z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):C("",!0),e[25]||(e[25]=p(" Add Project ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"]),i(se,{show:U.value,title:"Link Package",onClose:e[5]||(e[5]=n=>U.value=!1)},{default:d(()=>[t("div",zt,[t("p",$t,[e[26]||(e[26]=p(" Link a package from this workspace to ",-1)),t("span",Pt,m(P.value),1),e[27]||(e[27]=p(" for local development. ",-1))]),X.value.length===0?(o(),r("div",Ct,[...e[28]||(e[28]=[t("p",{class:"text-zinc-400"}," No other projects in this workspace to link as packages. ",-1)])])):(o(),r("div",jt,[e[30]||(e[30]=t("label",{for:"package-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a package to link ",-1)),Q(t("select",{id:"package-select","onUpdate:modelValue":e[3]||(e[3]=n=>b.value=n),class:"w-full"},[e[29]||(e[29]=t("option",{value:""},"Choose a package...",-1)),(o(!0),r(F,null,V(X.value,n=>(o(),r("option",{key:n.name,value:n.name},m(O(n.name)),9,Lt))),128))],512),[[ee,b.value]]),e[31]||(e[31]=t("p",{class:"text-xs text-zinc-500 mt-2"}," The selected project will be symlinked as a Composer dependency. ",-1))])),t("div",At,[i(a(v),{onClick:e[4]||(e[4]=n=>U.value=!1),variant:"ghost"},{default:d(()=>[...e[32]||(e[32]=[p("Cancel",-1)])]),_:1}),i(a(v),{onClick:ve,variant:"secondary",disabled:!b.value||M.value},{default:d(()=>[M.value?(o(),k(a(z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):(o(),k(a(ae),{key:1,class:"w-4 h-4 mr-2"})),e[33]||(e[33]=p(" Link Package ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"])],64))}});export{Dt as default};
