import{j as R,d as he,k as ge,z as be,s as we,c as o,g as a,a as t,u as s,h as ke,f as c,t as i,p as X,b as f,F as h,e as g,r as v,w as p,o as n,i as T,P as _e,n as W,q as Ce,R as ze,m as Se,B as Ve}from"./app-DCjzOA_Z.js";import{_ as Pe}from"./Heading.vue_vue_type_script_setup_true_lang-BwQHPwFZ.js";import{_ as Te}from"./DnsSettings.vue_vue_type_script_setup_true_lang-jA4ECtxO.js";import{Y as C,c as Z,d as G,k as Q,B as K,$ as ee,I as z}from"./craft-ui-LxbrBGk3.js";import{L as O}from"./loader-circle-Dbdq18o5.js";import{R as De}from"./refresh-cw-4CuCbkPq.js";import{T as te}from"./triangle-alert-D-OmGdw0.js";import{T as Fe}from"./trash-2-C8A-D6Uu.js";import"./circle-alert-Dh9QSmOu.js";const Ue=R("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const se=R("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const L=R("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),$e={class:"mb-8"},je={class:"text-zinc-400 mt-1"},Ee={class:"grid grid-cols-2 gap-8 py-6"},Ae={class:"text-sm text-zinc-500 mt-1"},Ne={class:"relative"},He={key:0,class:"mt-2 text-sm text-red-400"},Ie={key:1,class:"mt-2 text-sm text-amber-400"},Oe={class:"grid grid-cols-2 gap-8 py-6"},Le={class:"grid grid-cols-2 gap-8 py-6"},Re={class:"space-y-4"},Be={key:0,class:"mt-1 text-sm text-red-400"},Ye={class:"grid grid-cols-2 gap-4"},Me={key:0,class:"mt-1 text-sm text-red-400"},qe={key:0,class:"mt-1 text-sm text-red-400"},Je={class:"flex justify-end py-6"},Xe={class:"py-6"},We={key:0,class:"text-zinc-500 text-sm"},Ze={class:"grid grid-cols-2 gap-8 py-6"},Ge={class:"space-y-2"},Qe=["onClick"],Ke={class:"grid grid-cols-2 gap-8 py-6"},et={class:"text-sm text-zinc-500 mt-1"},tt={class:"grid grid-cols-2 gap-8 py-6"},st={class:"flex justify-end py-6"},nt={class:"py-6"},lt={class:"py-6"},ot={class:"flex items-center justify-between mb-6"},at={class:"flex items-center gap-2"},it={key:0,class:"p-4 bg-red-900/20 border border-red-800 rounded-lg mb-4"},rt={class:"flex items-center gap-2 text-red-400"},dt={key:1,class:"space-y-2"},ut={class:"flex items-center gap-4 mb-4 text-sm"},mt={class:"text-lime-400"},ct={key:0,class:"text-amber-400"},vt={key:1,class:"text-red-400"},ft=["onClick"],pt={class:"flex items-center gap-3"},xt={class:"text-white font-medium"},yt={class:"text-sm text-zinc-400 mt-0.5"},ht={class:"flex items-center gap-2"},gt={key:0,class:"px-4 py-3 bg-zinc-900/50 border-t border-zinc-700/50"},bt={class:"space-y-2 text-sm"},wt={class:"text-zinc-500 w-32 flex-shrink-0"},kt={class:"text-zinc-300 font-mono break-all"},_t={key:1,class:"text-xs"},Ct={key:2,class:"text-center py-8 text-zinc-500"},zt={key:0,class:"py-6"},St={class:"grid grid-cols-2 gap-8"},Vt={key:0},Pt={key:1,class:"space-y-4"},Tt={class:"flex items-start gap-3 p-3 bg-red-900/20 rounded-lg"},Dt={class:"text-sm text-red-400/80"},Ft={class:"text-red-300"},Ut={class:"flex gap-3"},Rt=he({__name:"Settings",props:{environment:{},remoteApiUrl:{},editor:{},editorOptions:{}},setup(w){const u=w,B=document.querySelector('meta[name="csrf-token"]')?.content||"",U=we(()=>!u.environment.is_local&&u.remoteApiUrl),r=ge({name:u.environment.name,host:u.environment.host,user:u.environment.user,port:u.environment.port,editor_scheme:u.editor.scheme}),$=v(!1),k=v(null),j=v(!1),Y=v(null),N=v(!0),E=v(!1),b=v([]),S=v(""),A=v("8.4"),M=v(["8.3","8.4","8.5"]),H=v(!1),V=v(""),q=v("test"),P=v(!1),x=v(null),_=v(null),D=v(new Set),ne={ssh:"SSH Connection",cli:"CLI Installation",docker:"Docker Services",api:"API Connectivity",environment_dns:"Environment DNS",local_dns:"Local DNS",config:"Configuration"};function le(d){D.value.has(d)?D.value.delete(d):D.value.add(d)}const F=v(new Set);async function J(){P.value=!0,_.value=null,x.value=null;try{const e=await(await fetch(`/environments/${u.environment.id}/doctor`)).json();e.success?x.value=e:_.value=e.error||"Health check failed"}catch{_.value="Failed to run health check"}finally{P.value=!1}}async function oe(d){F.value.add(d);try{const l=await(await fetch(`/environments/${u.environment.id}/doctor/fix/${d}`,{method:"POST",headers:{"X-CSRF-TOKEN":B,"Content-Type":"application/json"}})).json();l.success?await J():_.value=l.message||"Failed to fix issue"}catch{_.value="Failed to fix issue"}finally{F.value.delete(d)}}async function ae(){if(!(!U.value||!u.remoteApiUrl)){$.value=!0,k.value=null;try{const e=await(await fetch(`${u.remoteApiUrl}/instance-info`)).json();e.success&&e.data?r.name=e.data.name:k.value=e.error||"Failed to load instance info"}catch{k.value="Failed to connect to remote environment"}finally{$.value=!1}}}async function ie(){if(u.remoteApiUrl){j.value=!0,k.value=null;try{const e=await(await fetch(`${u.remoteApiUrl}/instance-info`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.name})})).json();e.success||(k.value=e.error||"Failed to update name")}catch{k.value="Failed to connect to remote environment"}finally{j.value=!1}}}async function re(){N.value=!0;try{const e=await(await fetch(`/environments/${u.environment.id}/config`)).json();e.success&&(Y.value=e.data,b.value=[...e.data.paths||[]],b.value.length===0&&b.value.push(""),S.value=e.data.tld||"test",A.value=e.data.default_php_version||"8.4",q.value=e.data.tld||"test",e.data.available_php_versions?.length&&(M.value=e.data.available_php_versions))}catch(d){console.error("Failed to load config:",d)}finally{N.value=!1}}async function de(){U.value&&await ie(),r.post(`/environments/${u.environment.id}/settings`)}function ue(){b.value.push("")}function me(d){b.value.splice(d,1)}async function ce(){const d=b.value.filter(e=>e.trim()!=="");if(d.length===0){alert("Please add at least one site path");return}E.value=!0;try{const l=await(await fetch(`/environments/${u.environment.id}/config`,{method:"POST",headers:{"X-CSRF-TOKEN":B,"Content-Type":"application/json"},body:JSON.stringify({paths:d,tld:S.value.trim()||"test",default_php_version:A.value})})).json();l.success?(Y.value=l.data,q.value=S.value.trim()||"test"):alert("Failed to save config: "+(l.error||"Unknown error"))}catch{alert("Failed to save config")}finally{E.value=!1}}function ve(){H.value=!0,V.value=""}function fe(){H.value=!1,V.value=""}function pe(){V.value===u.environment.name&&Ce.delete(`/environments/${u.environment.id}`,{onSuccess:()=>{}})}return be(()=>{re(),U.value&&ae()}),(d,e)=>(n(),o(h,null,[a(s(ke),{title:`Settings - ${w.environment.name}`},null,8,["title"]),t("div",null,[t("div",$e,[a(Pe,{title:"Settings"}),t("p",je,"Configure "+i(w.environment.name),1)]),t("form",{onSubmit:X(de,["prevent"])},[t("div",Ee,[t("div",null,[e[11]||(e[11]=t("h3",{class:"text-sm font-medium text-white"},"Environment Name",-1)),t("p",Ae,[e[10]||(e[10]=f(" Display name for this environment. ",-1)),U.value?(n(),o(h,{key:0},[e[8]||(e[8]=t("br",null,null,-1)),e[9]||(e[9]=t("span",{class:"text-xs text-zinc-600"},"Changes will be synced to the remote environment.",-1))],64)):c("",!0)])]),t("div",null,[t("div",Ne,[a(s(C),{modelValue:s(r).name,"onUpdate:modelValue":e[0]||(e[0]=l=>s(r).name=l),type:"text",id:"name",class:"w-full",disabled:$.value},null,8,["modelValue","disabled"]),$.value?(n(),g(s(O),{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-zinc-500"})):c("",!0)]),s(r).errors.name?(n(),o("p",He,i(s(r).errors.name),1)):c("",!0),k.value?(n(),o("p",Ie,i(k.value),1)):c("",!0)])]),e[18]||(e[18]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Oe,[e[12]||(e[12]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Code Editor"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Select your preferred editor for opening files in this environment. ")],-1)),t("div",null,[a(s(ee),{modelValue:s(r).editor_scheme,"onUpdate:modelValue":e[1]||(e[1]=l=>s(r).editor_scheme=l)},{default:p(()=>[a(s(Z),{class:"w-full"},{default:p(()=>[a(s(G),{placeholder:"Select editor"})]),_:1}),a(s(Q),null,{default:p(()=>[(n(!0),o(h,null,T(w.editorOptions,(l,m)=>(n(),g(s(K),{key:m,value:m},{default:p(()=>[f(i(l),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),e[19]||(e[19]=t("hr",{class:"border-zinc-800"},null,-1)),w.environment.is_local?c("",!0):(n(),o(h,{key:0},[t("div",Le,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"SSH Connection"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Host, user, and port for SSH access. ")],-1)),t("div",Re,[t("div",null,[e[13]||(e[13]=t("label",{for:"host",class:"block text-sm font-medium text-zinc-400 mb-1"},"Host",-1)),a(s(C),{modelValue:s(r).host,"onUpdate:modelValue":e[2]||(e[2]=l=>s(r).host=l),type:"text",id:"host",class:"w-full font-mono"},null,8,["modelValue"]),s(r).errors.host?(n(),o("p",Be,i(s(r).errors.host),1)):c("",!0)]),t("div",Ye,[t("div",null,[e[14]||(e[14]=t("label",{for:"user",class:"block text-sm font-medium text-zinc-400 mb-1"},"User",-1)),a(s(C),{modelValue:s(r).user,"onUpdate:modelValue":e[3]||(e[3]=l=>s(r).user=l),type:"text",id:"user",class:"w-full font-mono"},null,8,["modelValue"]),s(r).errors.user?(n(),o("p",Me,i(s(r).errors.user),1)):c("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{for:"port",class:"block text-sm font-medium text-zinc-400 mb-1"},"Port",-1)),a(s(C),{modelValue:s(r).port,"onUpdate:modelValue":e[4]||(e[4]=l=>s(r).port=l),type:"number",id:"port",class:"w-full font-mono"},null,8,["modelValue"]),s(r).errors.port?(n(),o("p",qe,i(s(r).errors.port),1)):c("",!0)])])])]),e[17]||(e[17]=t("hr",{class:"border-zinc-800"},null,-1))],64)),t("div",Je,[a(s(z),{type:"submit",disabled:s(r).processing||j.value,variant:"secondary"},{default:p(()=>[f(i(s(r).processing||j.value?"Saving...":"Save Environment"),1)]),_:1},8,["disabled"])])],32),e[38]||(e[38]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Xe,[e[27]||(e[27]=t("h2",{class:"text-lg font-medium text-white mb-6"},"Orbit Configuration",-1)),N.value?(n(),o("div",We,[a(s(O),{class:"w-4 h-4 inline animate-spin mr-2"}),e[20]||(e[20]=f(" Loading configuration... ",-1))])):(n(),o(h,{key:1},[t("div",Ze,[e[22]||(e[22]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Site Paths"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Directories where your sites are located. ")],-1)),t("div",null,[t("div",Ge,[(n(!0),o(h,null,T(b.value,(l,m)=>(n(),o("div",{key:m,class:"flex items-center gap-2"},[a(s(C),{modelValue:b.value[m],"onUpdate:modelValue":y=>b.value[m]=y,type:"text",placeholder:"/home/user/sites",class:"flex-1 font-mono"},null,8,["modelValue","onUpdate:modelValue"]),t("button",{onClick:y=>me(m),type:"button",class:"text-zinc-500 hover:text-red-400 p-2 transition-colors"},[a(s(Fe),{class:"w-4 h-4"})],8,Qe)]))),128))]),t("button",{onClick:ue,type:"button",class:"mt-2 text-sm text-zinc-400 hover:text-white transition-colors flex items-center gap-1"},[a(s(_e),{class:"w-4 h-4"}),e[21]||(e[21]=f(" Add path ",-1))])])]),e[25]||(e[25]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Ke,[t("div",null,[e[23]||(e[23]=t("h3",{class:"text-sm font-medium text-white"},"TLD",-1)),t("p",et," Top-level domain for local sites. Sites will be accessible at sitename."+i(S.value||"test"),1)]),t("div",null,[a(s(C),{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=l=>S.value=l),type:"text",id:"config-tld",placeholder:"test",class:"w-full font-mono"},null,8,["modelValue"])])]),e[26]||(e[26]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",tt,[e[24]||(e[24]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Default PHP Version"),t("p",{class:"text-sm text-zinc-500 mt-1"},"PHP version used for new sites.")],-1)),t("div",null,[a(s(ee),{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=l=>A.value=l)},{default:p(()=>[a(s(Z),{class:"w-full"},{default:p(()=>[a(s(G),{placeholder:"Select PHP version"})]),_:1}),a(s(Q),null,{default:p(()=>[(n(!0),o(h,null,T(M.value,l=>(n(),g(s(K),{key:l,value:l},{default:p(()=>[f(" PHP "+i(l),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),t("div",st,[a(s(z),{onClick:ce,type:"button",disabled:E.value,variant:"secondary"},{default:p(()=>[f(i(E.value?"Saving...":"Save Configuration"),1)]),_:1},8,["disabled"])])],64))]),e[39]||(e[39]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",nt,[a(Te,{"environment-id":w.environment.id},null,8,["environment-id"])]),e[40]||(e[40]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",lt,[t("div",ot,[t("div",at,[a(s(L),{class:"w-5 h-5 text-zinc-400"}),e[28]||(e[28]=t("h2",{class:"text-lg font-medium text-white"},"Health Check",-1)),x.value?(n(),o("span",{key:0,class:W(["text-xs px-2 py-0.5 rounded-full",x.value.status==="healthy"?"bg-lime-500/10 text-lime-400":x.value.status==="degraded"?"bg-amber-500/10 text-amber-400":"bg-red-500/10 text-red-400"])},i(x.value.status==="healthy"?"All Passed":x.value.status==="degraded"?"Warnings":"Issues Found"),3)):c("",!0)]),a(s(z),{onClick:J,disabled:P.value,variant:"outline"},{default:p(()=>[P.value?(n(),g(s(De),{key:0,class:"w-4 h-4 animate-spin"})):(n(),g(s(L),{key:1,class:"w-4 h-4"})),f(" "+i(P.value?"Running...":"Run Diagnostics"),1)]),_:1},8,["disabled"])]),_.value?(n(),o("div",it,[t("div",rt,[a(s(se),{class:"w-5 h-5"}),t("span",null,i(_.value),1)])])):c("",!0),x.value?(n(),o("div",dt,[t("div",ut,[t("span",mt,i(x.value.summary.passed)+" passed",1),x.value.summary.warnings>0?(n(),o("span",ct,i(x.value.summary.warnings)+" warnings ",1)):c("",!0),x.value.summary.errors>0?(n(),o("span",vt,i(x.value.summary.errors)+" errors ",1)):c("",!0)]),(n(!0),o(h,null,T(x.value.checks,(l,m)=>(n(),o("div",{key:m,class:"border border-zinc-700/50 rounded-lg overflow-hidden"},[t("button",{onClick:y=>le(m),class:"w-full flex items-center justify-between p-3 bg-zinc-800/30 hover:bg-zinc-700/30 transition-colors text-left"},[t("div",pt,[l.status==="ok"?(n(),g(s(Ue),{key:0,class:"w-5 h-5 text-lime-400"})):l.status==="warning"?(n(),g(s(te),{key:1,class:"w-5 h-5 text-amber-400"})):(n(),g(s(se),{key:2,class:"w-5 h-5 text-red-400"})),t("div",null,[t("span",xt,i(ne[m]||m),1),t("p",yt,i(l.message),1)])]),t("div",ht,[l.status==="error"&&l.details?.can_fix?(n(),g(s(z),{key:0,onClick:X(y=>oe(m),["stop"]),disabled:F.value.has(m),variant:"secondary",size:"sm"},{default:p(()=>[F.value.has(m)?(n(),g(s(O),{key:0,class:"w-3 h-3 animate-spin mr-1"})):c("",!0),f(" "+i(F.value.has(m)?"Fixing...":"Fix"),1)]),_:2},1032,["onClick","disabled"])):c("",!0),l.details&&Object.keys(l.details).length>0?(n(),g(s(ze),{key:1,class:W(["w-4 h-4 text-zinc-500 transition-transform",D.value.has(m)?"rotate-180":""])},null,8,["class"])):c("",!0)])],8,ft),D.value.has(m)&&l.details&&Object.keys(l.details).filter(y=>y!=="can_fix").length>0?(n(),o("div",gt,[t("dl",bt,[(n(!0),o(h,null,T(l.details,(y,I)=>Se((n(),o("div",{key:I,class:"flex"},[t("dt",wt,i(I),1),t("dd",kt,[Array.isArray(y)?(n(!0),o(h,{key:0},T(y,(xe,ye)=>(n(),o("span",{key:ye,class:"block"},i(xe),1))),128)):typeof y=="object"&&y!==null?(n(),o("pre",_t,i(JSON.stringify(y,null,2)),1)):(n(),o(h,{key:2},[f(i(y),1)],64))])])),[[Ve,I!=="can_fix"]])),128))])])):c("",!0)]))),128))])):!P.value&&!_.value?(n(),o("div",Ct,[a(s(L),{class:"w-12 h-12 mx-auto mb-3 opacity-50"}),e[29]||(e[29]=t("p",null,"Run diagnostics to check the health of this environment",-1))])):c("",!0)]),e[41]||(e[41]=t("hr",{class:"border-zinc-800"},null,-1)),d.$page.props.multi_environment?(n(),o("div",zt,[e[37]||(e[37]=t("h2",{class:"text-lg font-medium text-red-400 mb-6"},"Danger Zone",-1)),t("div",St,[e[36]||(e[36]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Delete Environment"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Permanently delete this environment. This action cannot be undone. ")],-1)),t("div",null,[H.value?(n(),o("div",Pt,[t("div",Tt,[a(s(te),{class:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),t("div",null,[e[33]||(e[33]=t("p",{class:"text-sm text-red-300 font-medium"},"Are you sure?",-1)),t("p",Dt,[e[31]||(e[31]=f(" Type ",-1)),t("strong",Ft,i(w.environment.name),1),e[32]||(e[32]=f(" to confirm. ",-1))])])]),a(s(C),{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=l=>V.value=l),type:"text",placeholder:"Type environment name",class:"w-full"},null,8,["modelValue"]),t("div",Ut,[a(s(z),{onClick:pe,type:"button",disabled:V.value!==w.environment.name,variant:"destructive"},{default:p(()=>[...e[34]||(e[34]=[f(" Delete ",-1)])]),_:1},8,["disabled"]),a(s(z),{onClick:fe,type:"button",variant:"ghost"},{default:p(()=>[...e[35]||(e[35]=[f(" Cancel ",-1)])]),_:1})])])):(n(),o("div",Vt,[a(s(z),{onClick:ve,type:"button",variant:"destructive"},{default:p(()=>[...e[30]||(e[30]=[f(" Delete Environment ",-1)])]),_:1})]))])])])):c("",!0)])],64))}});export{Rt as default};
