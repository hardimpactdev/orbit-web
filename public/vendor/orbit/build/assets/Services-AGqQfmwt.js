import{I as j,d as he,y as be,e as f,w as m,a as n,c as r,r as p,o as l,g as a,u as t,S as fe,F as C,i as J,f as _,s as F,t as y,J as ze,b as $,P as Se,k as _e,p as $e,m as xe,v as Be,K as Qe,L as Je,M as x,N as Ye,B as Ge,h as Xe,n as se,O as Ze,Q as ye}from"./app-DrCT5KMu.js";import{u as Ce}from"./services-B-weriYw.js";import{_ as le}from"./Modal.vue_vue_type_script_setup_true_lang-BbQgKwbs.js";import{I as P,H as Ke,Y as T,_ as et,c as tt,k as ve,M as st,y as nt}from"./craft-ui-o8I0d7KD.js";import{L as V}from"./loader-circle-Cvve5vTq.js";import{G as Pe}from"./globe-DnZxAMlx.js";import{_ as lt}from"./DnsSettings.vue_vue_type_script_setup_true_lang-DwtyYJDo.js";import{C as at}from"./circle-alert-JIFVkVbD.js";import{E as it}from"./eye-GHbYLuH_.js";import{R as pe}from"./refresh-cw-DcuZkR62.js";import{T as we}from"./trash-2-BkMHF4RJ.js";import{X as ot}from"./x-fiMuQPyW.js";const ge=j("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const ne=j("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const rt=j("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ct=j("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const me=j("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Me=j("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const ut=j("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const dt=j("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ke=j("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const vt=j("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),pt={class:"p-6"},mt={key:0,class:"py-12 text-center"},ft={key:1,class:"py-12 text-center"},gt={key:2,class:"space-y-8"},ht={key:0},bt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},yt={class:"flex items-start justify-between mb-2"},wt={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},kt={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},zt={class:"text-white font-medium mb-1"},St={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},_t=he({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(L,{emit:H}){const u=L,q=H,I=Ce(),A=p(!0),M=p([]),h=p(null),k=F(()=>u.getApiUrl("")),D=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],O=F(()=>{const c={core:[],php:[],database:[],utility:[]};return M.value.forEach(i=>{c[i.category]?c[i.category].push(i):c.utility.push(i)}),c}),U=async()=>{A.value=!0;try{const i=await(await fetch(u.getApiUrl("/services/available"))).json();i.success&&(M.value=i.data||[])}catch(c){console.error("Failed to fetch available services:",c)}finally{A.value=!1}},Y=async c=>{h.value=c;try{const i=await I.enableService(c,k.value);i?.success?(q("serviceEnabled",c),q("close")):alert("Failed to enable service: "+(i?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{h.value=null}},z=c=>{switch(c){case"core":return Pe;case"database":return ne;case"php":return ge;case"utility":return Me;default:return fe}};return be(()=>{u.show&&U()}),(c,i)=>(l(),f(le,{show:L.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:i[0]||(i[0]=v=>c.$emit("close"))},{default:m(()=>[n("div",pt,[A.value?(l(),r("div",mt,[a(t(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),i[1]||(i[1]=n("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):M.value.length===0?(l(),r("div",ft,[a(t(fe),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),i[2]||(i[2]=n("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(l(),r("div",gt,[(l(),r(C,null,J(D,v=>(l(),r(C,{key:v.key},[O.value[v.key].length>0?(l(),r("div",ht,[n("h4",bt,y(v.label),1),n("div",xt,[(l(!0),r(C,null,J(O.value[v.key],g=>(l(),r("div",{key:g.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[n("div",null,[n("div",yt,[n("div",wt,[(l(),f(ze(z(g.category)),{class:"w-5 h-5"}))]),g.required?(l(),r("span",kt," Required ")):_("",!0)]),n("h5",zt,y(g.label),1),n("p",St,y(g.description),1)]),a(t(P),{onClick:ae=>Y(g.name),disabled:h.value!==null,variant:"secondary",class:"w-full justify-center"},{default:m(()=>[h.value===g.name?(l(),r(C,{key:0},[a(t(V),{class:"w-4 h-4 animate-spin mr-2"}),i[3]||(i[3]=$(" Enabling... ",-1))],64)):(l(),r(C,{key:1},[a(t(Se),{class:"w-4 h-4 mr-2"}),i[4]||(i[4]=$(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):_("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),$t={class:"p-6"},Ct={key:0,class:"py-12 text-center"},Pt={key:1,class:"py-12 text-center"},Mt={key:2},Vt=["for"],At={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Ut={key:0,class:"relative"},Ft=["id","onUpdate:modelValue"],Lt=["value"],jt={key:1,class:"flex items-center"},Et={class:"ml-3 text-sm text-zinc-400"},Rt={key:2,class:"relative"},Ht=["id","type","onUpdate:modelValue","placeholder"],Nt=["onClick"],Tt={key:3,class:"text-xs text-zinc-500"},qt={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},It=he({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(L,{emit:H}){const u=L,q=H,I=p(!0),A=p(!1),M=p(null),h=p({}),k=p({}),D=F(()=>u.serviceName==="dns"),O=async()=>{if(u.serviceName){I.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/info`))).json();if(c.success&&c.data){M.value=c.data,h.value={...c.data.config};const i={};Object.entries(c.data.configSchema).forEach(([v,g])=>{g.secret&&(i[v]=!1)}),k.value=i}}catch(z){console.error("Failed to fetch service info:",z)}finally{I.value=!1}}},U=async()=>{if(u.serviceName){A.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":u.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:h.value})})).json();c.success?(q("configUpdated",u.serviceName),q("close")):alert("Failed to update configuration: "+(c.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{A.value=!1}}},Y=z=>{k.value[z]=!k.value[z]};return _e(()=>u.show,z=>{z&&u.serviceName?O():(M.value=null,h.value={})}),be(()=>{u.show&&u.serviceName&&O()}),(z,c)=>(l(),f(le,{show:L.show,title:M.value?`Configure ${M.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:c[1]||(c[1]=i=>z.$emit("close"))},{default:m(()=>[n("div",$t,[I.value?(l(),r("div",Ct,[a(t(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),c[2]||(c[2]=n("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!M.value&&!D.value?(l(),r("div",Pt,[a(t(at),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),c[3]||(c[3]=n("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):D.value?(l(),r("div",Mt,[a(lt,{"environment-id":L.environmentId},null,8,["environment-id"])])):(l(),r("form",{key:3,onSubmit:$e(U,["prevent"]),class:"space-y-6"},[(l(!0),r(C,null,J(M.value?.configSchema??{},(i,v)=>(l(),r("div",{key:v,class:"space-y-1.5"},[n("label",{for:v,class:"block text-sm font-medium text-zinc-300"},[$(y(i.label)+" ",1),i.secret?(l(),r("span",At,"Secret")):_("",!0)],8,Vt),i.enum?(l(),r("div",Ut,[xe(n("select",{id:v,"onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(l(!0),r(C,null,J(i.enum,g=>(l(),r("option",{key:g,value:g},y(g),9,Lt))),128))],8,Ft),[[Be,h.value[v]]]),c[4]||(c[4]=n("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[n("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[n("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):i.type==="boolean"?(l(),r("div",jt,[a(t(Ke),{checked:h.value[v],"onUpdate:checked":g=>h.value[v]=g},null,8,["checked","onUpdate:checked"]),n("span",Et,y(h.value[v]?"Enabled":"Disabled"),1)])):(l(),r("div",Rt,[xe(n("input",{id:v,type:i.secret&&!k.value[v]?"password":i.type==="integer"?"number":"text","onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:i.default?.toString()},null,8,Ht),[[Qe,h.value[v]]]),i.secret?(l(),r("button",{key:0,type:"button",onClick:g=>Y(v),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[k.value[v]?(l(),f(t(ct),{key:0,class:"w-4 h-4"})):(l(),f(t(it),{key:1,class:"w-4 h-4"}))],8,Nt)):_("",!0)])),i.description?(l(),r("p",Tt,y(i.description),1)):_("",!0)]))),128)),n("div",qt,[a(t(P),{type:"button",onClick:c[0]||(c[0]=i=>z.$emit("close")),variant:"outline"},{default:m(()=>[...c[5]||(c[5]=[$(" Cancel ",-1)])]),_:1}),a(t(P),{type:"submit",disabled:A.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:m(()=>[A.value?(l(),f(t(V),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(l(),f(t(dt),{key:1,class:"w-4 h-4 mr-2"})),c[6]||(c[6]=$(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),Dt={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Ot={class:"text-sm text-zinc-500 mt-1"},Wt={class:"flex items-center gap-2"},Bt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Qt={key:1,class:"space-y-6"},Jt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Yt={class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},Gt={class:"flex items-center justify-between"},Xt={class:"text-sm font-medium text-zinc-100"},Zt={class:"divide-y divide-zinc-800/50"},Kt={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50"},es={class:"flex-1 min-w-0"},ts={class:"flex items-center gap-2 flex-wrap"},ss={class:"font-medium text-sm text-zinc-100"},ns={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-zinc-800/80 text-zinc-400 ring-1 ring-inset ring-zinc-700/50"},ls={class:"text-xs text-zinc-500 mt-0.5 truncate"},as={key:0,class:"text-zinc-600/70"},is={key:1,class:"text-zinc-500/70"},os={class:"flex items-center gap-2"},rs={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},cs={key:0,class:"px-4 py-3 bg-red-500/5"},us={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-3 py-2 flex items-center justify-between"},ds=["onClick"],vs={class:"flex flex-col max-h-[70vh]"},ps={class:"flex items-center gap-3 px-6 py-3 border-b border-zinc-800 bg-zinc-900/50"},ms={class:"flex-1 overflow-auto p-4 bg-black"},fs={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap"},gs={class:"p-6"},hs={key:0,class:"py-8 text-center"},bs={class:"grid grid-cols-2 gap-4"},xs={class:"grid grid-cols-2 gap-4"},ys={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},Fs=he({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(L){const H=L,u=Ce(),q=Ze(),I=Je(),A=F(()=>!!q.props.reverb?.enabled),M=p(!1);_e(I,s=>{A.value&&s==="failed"&&!M.value&&(M.value=!0,x.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const h=s=>H.remoteApiUrl?`${H.remoteApiUrl}${s}`:`/api/environments/${H.environment.id}${s}`,k=F(()=>h("")),D=document.querySelector('meta[name="csrf-token"]')?.content||"",O=F(()=>u.services),U=p(!1),Y=F(()=>u.servicesRunning),z=F(()=>u.servicesTotal),c=p(!1),i=p(null),v=p(!1),g=p(!1),ae=p(null),ie=p(!1),N=p(null),W=p(""),X=p(!1),G=p(!1),B=p(null);let E=null;const Z=p(!1),oe=p(!1),K=p(!1),re=p(""),b=p({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),ce={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:Pe,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:fe,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:ne,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:ne,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:ne,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Me,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:vt,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker for production (orbit.ccc)",icon:me,category:"utility",required:!0},"horizon-dev":{name:"Laravel Horizon",description:"Queue worker for development (orbit-web.ccc)",icon:me,category:"utility",required:!0}};function ee(s){return s==="caddy"||s.startsWith("php-")||s==="horizon"||s==="horizon-dev"?"host":"docker"}function Ve(s){if(ce[s])return ce[s];if(s.startsWith("php-")){const e=s.replace("php-","");let o=e;return e.length===2&&!e.includes(".")&&(o=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${o}`,description:"Native PHP-FPM service",icon:ge,category:"php"}}return{name:s,description:"Service",icon:ge,category:"utility"}}const Ae=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],te=F(()=>{const s={core:[],php:[],database:[],utility:[]};for(const[e,o]of Object.entries(O.value)){const d=Ve(e);s[d.category].push({key:e,service:o,meta:d})}return s.php.sort((e,o)=>e.key.localeCompare(o.key)),s}),Ue=F(()=>Y.value===0);function Fe(s){if(!s.startsWith("php-"))return null;const e=s.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const Le=F(()=>{const s=te.value.php.map(({key:e})=>Fe(e)).filter(e=>e!==null);return s.length===0?null:(s.sort((e,o)=>{const[d,w]=e.split(".").map(Number),[S,R]=o.split(".").map(Number);return d!==S?d-S:w-R}),s[s.length-1])});async function je(){const s=Le.value;if(!s){x.error("No PHP services detected");return}re.value=s,oe.value=!0,Z.value=!0;try{const e=await fetch(h(`/php/config/${s}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const o=await e.json();o.success&&o.data?.settings&&(b.value={...b.value,...o.data.settings})}catch(e){x.error(`Error loading PHP settings: ${e}`)}finally{oe.value=!1}}async function Ee(){K.value=!0;try{const s=await fetch(h(`/php/config/${re.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b.value)});if(!s.ok)throw new Error("Failed to save PHP settings");const e=await s.json();e.success?(x.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),Z.value=!1):x.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(s){x.error("Error Saving PHP Settings",{description:String(s)})}finally{K.value=!1}}async function Q(s=!1){s||(U.value=!0);try{await u.fetchServices(k.value)}finally{s||(U.value=!1)}}async function Re(){i.value="stop-all";try{const s=await u.stopAll(k.value);s.success?(x.success("Services Stopping",{description:"All services are being stopped."}),await Q(!0)):x.error("Failed to Stop Services",{description:s.error||"An unknown error occurred."})}catch{x.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{i.value=null}}async function He(){c.value=!0,i.value="restart-all";try{const s=await u.restartAll(k.value);s.success?(x.success("Services Restarting",{description:"All services are being restarted."}),await Q(!0)):x.error("Failed to Restart Services",{description:s.error||"An unknown error occurred."})}catch{x.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{c.value=!1,i.value=null}}async function ue(s,e){const o=ee(s);try{let d;e==="start"?d=await u.startService(s,k.value,o):e==="stop"?d=await u.stopService(s,k.value,o):d=await u.restartService(s,k.value,o),d?.success?d.jobId||await Q(!0):x.error(`Failed to ${e} ${s}: `+(d?.error||"Unknown error"))}catch{x.error(`Failed to ${e} ${s}`)}}async function Ne(s){if(confirm(`Are you sure you want to remove ${s}?`))try{const e=await u.disableService(s,k.value);e?.success?(x.success(`${s} disabled`),await Q(!0)):x.error("Failed to remove service: "+(e?.error||"Unknown error"))}catch{x.error("Failed to remove service")}}function Te(s){ae.value=s,g.value=!0}async function qe(s){N.value=s,ie.value=!0,await de()}async function de(){if(N.value){X.value=!0;try{const e=ee(N.value)==="host"?`/host-services/${N.value}/logs`:`/services/${N.value}/logs`;let o=e;if(B.value){const S=B.value.toISOString();o=`${e}?since=${encodeURIComponent(S)}`}const w=await(await fetch(h(o))).json();if(w.success){const S=w.logs||"No logs available";if(B.value){const R=B.value.toLocaleTimeString();W.value=`--- Logs cleared at ${R} (showing only new entries) ---

${S}`}else W.value=S}else W.value="Failed to fetch logs: "+(w.error||"Unknown error")}catch{W.value="Failed to fetch logs"}finally{X.value=!1}}}function Ie(){ie.value=!1,N.value=null,W.value="",G.value=!1,B.value=null,E&&(clearInterval(E),E=null)}function De(){B.value=new Date,W.value=`--- Logs cleared at ${B.value.toLocaleTimeString()} ---

Waiting for new log entries...`}function Oe(){G.value=!G.value,G.value?E=setInterval(de,3e3):E&&(clearInterval(E),E=null)}function We(s){return s.icon}return A.value&&Ye("orbit",".service.status.changed",s=>{u.handleServiceStatusChanged(s.job_id,s.service,s.status,s.error),s.error?x.error(`Failed to ${s.action} ${s.service}: ${s.error}`):x.success(`${s.service} ${s.action} completed`)}),be(async()=>{u.setActiveEnvironment(H.environment.id),u.isStale&&Q(),u.recoverPendingJobs(k.value)}),Ge(()=>{E&&clearInterval(E)}),(s,e)=>(l(),r(C,null,[a(t(Xe),{title:`Services - ${L.environment.name}`},null,8,["title"]),n("div",null,[n("header",Dt,[n("div",null,[e[15]||(e[15]=n("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Services",-1)),n("p",Ot,[U.value?(l(),r(C,{key:0},[$("Loading services...")],64)):(l(),r(C,{key:1},[$(y(Y.value)+"/"+y(z.value)+" services running",1)],64))])]),n("div",Wt,[a(t(P),{onClick:e[0]||(e[0]=o=>v.value=!0),disabled:U.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:m(()=>[a(t(Se),{class:"w-4 h-4 mr-1.5"}),e[16]||(e[16]=$(" Add Service ",-1))]),_:1},8,["disabled"]),Ue.value?_("",!0):(l(),f(t(P),{key:0,onClick:Re,disabled:U.value||i.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[i.value==="stop-all"?(l(),f(t(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),f(t(ke),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[17]||(e[17]=$(" Stop All ",-1))]),_:1},8,["disabled"])),a(t(P),{onClick:He,disabled:U.value||i.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[c.value?(l(),f(t(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),f(t(pe),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[18]||(e[18]=$(" Restart All ",-1))]),_:1},8,["disabled"])])]),U.value?(l(),r("div",Bt,[a(t(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[19]||(e[19]=n("p",{class:"text-zinc-500"},"Loading services...",-1))])):(l(),r("div",Qt,[(l(),r(C,null,J(Ae,o=>(l(),r(C,{key:o.key},[te.value[o.key].length>0?(l(),r("div",Jt,[n("div",Yt,[n("div",Gt,[n("h2",Xt,y(o.label),1),o.key==="php"?(l(),f(t(P),{key:0,onClick:je,variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-zinc-100",title:"PHP Settings"},{default:m(()=>[a(t(ye),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),n("div",Zt,[(l(!0),r(C,null,J(te.value[o.key],({key:d,service:w,meta:S})=>(l(),r("div",{key:d,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},[n("div",Kt,[(l(),f(ze(We(S)),{class:"h-4 w-4 text-zinc-400"}))]),n("div",es,[n("div",ts,[n("span",ss,y(S.name),1),w.required||S.required?(l(),r("span",ns," Required ")):_("",!0),n("span",{class:se(["px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full ring-1 ring-inset",ee(d)==="docker"?"bg-blue-500/10 text-blue-400 ring-blue-500/20":"bg-lime-500/10 text-lime-400 ring-lime-500/20"])},y(ee(d)),3),n("span",{class:se(["h-2 w-2 rounded-full",w.status==="running"?"bg-lime-400":w.status==="stopped"?"bg-zinc-600":"bg-red-400"])},null,2)]),n("p",ls,[$(y(S.description)+" ",1),S.ports?(l(),r("span",as," Â· ")):_("",!0),S.ports?(l(),r("span",is,y(S.ports),1)):_("",!0)])]),n("div",os,[n("span",{class:se(["px-2.5 py-1 text-xs font-medium rounded-full ring-1 ring-inset",w.status==="running"?"bg-lime-500/15 text-lime-400 ring-lime-500/30":w.status==="stopped"?"bg-zinc-800 text-zinc-400 ring-zinc-700":"bg-red-500/15 text-red-400 ring-red-500/30"])},y(w.status==="running"?"Running":w.status==="stopped"?"Stopped":"Error"),3),n("div",rs,[w.status!=="running"?(l(),f(t(P),{key:0,onClick:R=>ue(d,"start"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Start"},{default:m(()=>[t(u).isServicePending(d)?(l(),f(t(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(t(ut),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):_("",!0),w.status==="running"?(l(),f(t(P),{key:1,onClick:R=>ue(d,"stop"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",title:"Stop"},{default:m(()=>[t(u).isServicePending(d)?(l(),f(t(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(t(ke),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):_("",!0),a(t(P),{onClick:R=>ue(d,"restart"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800",title:"Restart"},{default:m(()=>[t(u).isServicePending(d)?(l(),f(t(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(t(pe),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"]),a(t(nt),null,{default:m(()=>[a(t(et),{"as-child":""},{default:m(()=>[a(t(P),{variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800"},{default:m(()=>[a(t(rt),{class:"w-4 h-4"})]),_:1})]),_:1}),a(t(tt),{align:"end",class:"w-40"},{default:m(()=>[a(t(ve),{onClick:R=>Te(d)},{default:m(()=>[a(t(ye),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=$(" Settings ",-1))]),_:1},8,["onClick"]),a(t(ve),{onClick:R=>qe(d)},{default:m(()=>[a(t(me),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=$(" View Logs ",-1))]),_:1},8,["onClick"]),!w.required&&!S.required?(l(),r(C,{key:0},[a(t(st)),a(t(ve),{onClick:R=>Ne(d),disabled:t(u).isServicePending(d),class:"text-red-400 focus:text-red-400"},{default:m(()=>[a(t(we),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=$(" Remove ",-1))]),_:1},8,["onClick","disabled"])],64)):_("",!0)]),_:2},1024)]),_:2},1024)])])]))),128)),(l(!0),r(C,null,J(te.value[o.key],({key:d})=>(l(),r(C,{key:`error-${d}`},[t(u).getServiceError(d)?(l(),r("div",cs,[n("div",us,[n("span",null,"Error: "+y(t(u).getServiceError(d)),1),n("button",{onClick:w=>t(u).clearServiceError(d),class:"text-red-400 hover:text-white ml-2"},[a(t(ot),{class:"w-3 h-3"})],8,ds)])])):_("",!0)],64))),128))])])):_("",!0)],64))),64))])),a(_t,{show:v.value,"get-api-url":h,"csrf-token":t(D),onClose:e[1]||(e[1]=o=>v.value=!1),onServiceEnabled:e[2]||(e[2]=()=>Q())},null,8,["show","csrf-token"]),a(It,{show:g.value,"service-name":ae.value,"environment-id":L.environment.id,"get-api-url":h,"csrf-token":t(D),onClose:e[3]||(e[3]=o=>g.value=!1),onConfigUpdated:e[4]||(e[4]=()=>Q())},null,8,["show","service-name","environment-id","csrf-token"]),a(le,{show:ie.value,title:`${ce[N.value]?.name||N.value} Logs`,maxWidth:"max-w-4xl",onClose:Ie},{default:m(()=>[n("div",vs,[n("div",ps,[a(t(P),{onClick:de,disabled:X.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:m(()=>[X.value?(l(),f(t(V),{key:0,class:"w-4 h-4 animate-spin"})):(l(),f(t(pe),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),a(t(P),{onClick:De,disabled:X.value,variant:"ghost",size:"icon-sm",title:"Clear logs display"},{default:m(()=>[a(t(we),{class:"w-4 h-4"})]),_:1},8,["disabled"]),n("button",{onClick:Oe,class:se(["text-xs px-2 py-1 rounded-full",G.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},y(G.value?"Auto-refresh ON":"Auto-refresh"),3)]),n("div",ms,[n("pre",fs,y(W.value),1)])])]),_:1},8,["show","title"]),a(le,{show:Z.value,title:`PHP ${re.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=o=>Z.value=!1)},{default:m(()=>[n("div",gs,[oe.value?(l(),r("div",hs,[a(t(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[23]||(e[23]=n("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(l(),r("form",{key:1,onSubmit:$e(Ee,["prevent"]),class:"space-y-6"},[n("div",null,[e[28]||(e[28]=n("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),n("div",bs,[n("div",null,[e[24]||(e[24]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),a(t(T),{modelValue:b.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=o=>b.value.upload_max_filesize=o),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[25]||(e[25]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),a(t(T),{modelValue:b.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value.post_max_size=o),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[26]||(e[26]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),a(t(T),{modelValue:b.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=o=>b.value.memory_limit=o),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[27]||(e[27]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),a(t(T),{modelValue:b.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=o=>b.value.max_execution_time=o),class:"w-full font-mono"},null,8,["modelValue"])])])]),n("div",null,[e[33]||(e[33]=n("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),n("div",xs,[n("div",null,[e[29]||(e[29]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),a(t(T),{modelValue:b.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value.max_children=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[30]||(e[30]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),a(t(T),{modelValue:b.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value.start_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[31]||(e[31]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),a(t(T),{modelValue:b.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=o=>b.value.min_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[32]||(e[32]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),a(t(T),{modelValue:b.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=o=>b.value.max_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),n("div",ys,[a(t(P),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=o=>Z.value=!1)},{default:m(()=>[...e[34]||(e[34]=[$(" Cancel ",-1)])]),_:1}),a(t(P),{type:"submit",variant:"secondary",disabled:K.value},{default:m(()=>[K.value?(l(),f(t(V),{key:0,class:"w-4 h-4 animate-spin"})):_("",!0),$(" "+y(K.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{Fs as default};
