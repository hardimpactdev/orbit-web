import{j as O,d as ve,k as fe,z as pe,s as xe,c as o,g as a,a as t,u as s,h as ye,f as u,t as i,p as X,b as p,F as h,e as g,r as c,w as y,i as F,P as he,o as n,n as W,q as ge,R as be,m as we,B as ke}from"./app-D9UrdW7P.js";import{_ as _e}from"./Heading.vue_vue_type_script_setup_true_lang-DlmZui2S.js";import{_ as Ce}from"./DnsSettings.vue_vue_type_script_setup_true_lang-DX1aOGz3.js";import{Y as C,I as z,c as ze,d as Se,k as Ve,B as Pe,$ as Te}from"./craft-ui-D2B3OI3e.js";import{L}from"./loader-circle-9LaEdU33.js";import{R as De}from"./refresh-cw-eSdnRuMR.js";import{T as Z}from"./triangle-alert-BWoBglZ7.js";import{T as Fe}from"./trash-2-Bgrxf0ei.js";import"./circle-alert-Bzb1T0oO.js";const Ue=O("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const G=O("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const R=O("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),$e={class:"mb-8"},je={class:"text-zinc-400 mt-1"},Ee={class:"grid grid-cols-2 gap-8 py-6"},Ae={class:"text-sm text-zinc-500 mt-1"},Ne={class:"relative"},He={key:0,class:"mt-2 text-sm text-red-400"},Ie={key:1,class:"mt-2 text-sm text-amber-400"},Le={class:"grid grid-cols-2 gap-8 py-6"},Re={class:"space-y-4"},Oe={key:0,class:"mt-1 text-sm text-red-400"},Be={class:"grid grid-cols-2 gap-4"},Ye={key:0,class:"mt-1 text-sm text-red-400"},Me={key:0,class:"mt-1 text-sm text-red-400"},qe={class:"flex justify-end py-6"},Je={class:"py-6"},Xe={key:0,class:"text-zinc-500 text-sm"},We={class:"grid grid-cols-2 gap-8 py-6"},Ze={class:"space-y-2"},Ge=["onClick"],Qe={class:"grid grid-cols-2 gap-8 py-6"},Ke={class:"text-sm text-zinc-500 mt-1"},et={class:"grid grid-cols-2 gap-8 py-6"},tt={class:"flex justify-end py-6"},st={class:"py-6"},nt={class:"py-6"},lt={class:"flex items-center justify-between mb-6"},ot={class:"flex items-center gap-2"},at={key:0,class:"p-4 bg-red-900/20 border border-red-800 rounded-lg mb-4"},it={class:"flex items-center gap-2 text-red-400"},rt={key:1,class:"space-y-2"},dt={class:"flex items-center gap-4 mb-4 text-sm"},ut={class:"text-lime-400"},ct={key:0,class:"text-amber-400"},mt={key:1,class:"text-red-400"},vt=["onClick"],ft={class:"flex items-center gap-3"},pt={class:"text-white font-medium"},xt={class:"text-sm text-zinc-400 mt-0.5"},yt={class:"flex items-center gap-2"},ht={key:0,class:"px-4 py-3 bg-zinc-900/50 border-t border-zinc-700/50"},gt={class:"space-y-2 text-sm"},bt={class:"text-zinc-500 w-32 flex-shrink-0"},wt={class:"text-zinc-300 font-mono break-all"},kt={key:1,class:"text-xs"},_t={key:2,class:"text-center py-8 text-zinc-500"},Ct={key:0,class:"py-6"},zt={class:"grid grid-cols-2 gap-8"},St={key:0},Vt={key:1,class:"space-y-4"},Pt={class:"flex items-start gap-3 p-3 bg-red-900/20 rounded-lg"},Tt={class:"text-sm text-red-400/80"},Dt={class:"text-red-300"},Ft={class:"flex gap-3"},Rt=ve({__name:"Settings",props:{environment:{},remoteApiUrl:{}},setup(_){const m=_,B=document.querySelector('meta[name="csrf-token"]')?.content||"",U=xe(()=>!m.environment.is_local&&m.remoteApiUrl),d=fe({name:m.environment.name,host:m.environment.host,user:m.environment.user,port:m.environment.port}),$=c(!1),w=c(null),j=c(!1),Y=c(null),N=c(!0),E=c(!1),b=c([]),S=c(""),A=c("8.4"),M=c(["8.3","8.4","8.5"]),H=c(!1),V=c(""),q=c("test"),P=c(!1),f=c(null),k=c(null),T=c(new Set),Q={ssh:"SSH Connection",cli:"CLI Installation",docker:"Docker Services",api:"API Connectivity",environment_dns:"Environment DNS",local_dns:"Local DNS",config:"Configuration"};function K(r){T.value.has(r)?T.value.delete(r):T.value.add(r)}const D=c(new Set);async function J(){P.value=!0,k.value=null,f.value=null;try{const e=await(await fetch(`/environments/${m.environment.id}/doctor`)).json();e.success?f.value=e:k.value=e.error||"Health check failed"}catch{k.value="Failed to run health check"}finally{P.value=!1}}async function ee(r){D.value.add(r);try{const l=await(await fetch(`/environments/${m.environment.id}/doctor/fix/${r}`,{method:"POST",headers:{"X-CSRF-TOKEN":B,"Content-Type":"application/json"}})).json();l.success?await J():k.value=l.message||"Failed to fix issue"}catch{k.value="Failed to fix issue"}finally{D.value.delete(r)}}async function te(){if(!(!U.value||!m.remoteApiUrl)){$.value=!0,w.value=null;try{const e=await(await fetch(`${m.remoteApiUrl}/instance-info`)).json();e.success&&e.data?d.name=e.data.name:w.value=e.error||"Failed to load instance info"}catch{w.value="Failed to connect to remote environment"}finally{$.value=!1}}}async function se(){if(m.remoteApiUrl){j.value=!0,w.value=null;try{const e=await(await fetch(`${m.remoteApiUrl}/instance-info`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d.name})})).json();e.success||(w.value=e.error||"Failed to update name")}catch{w.value="Failed to connect to remote environment"}finally{j.value=!1}}}async function ne(){N.value=!0;try{const e=await(await fetch(`/environments/${m.environment.id}/config`)).json();e.success&&(Y.value=e.data,b.value=[...e.data.paths||[]],b.value.length===0&&b.value.push(""),S.value=e.data.tld||"test",A.value=e.data.default_php_version||"8.4",q.value=e.data.tld||"test",e.data.available_php_versions?.length&&(M.value=e.data.available_php_versions))}catch(r){console.error("Failed to load config:",r)}finally{N.value=!1}}async function le(){U.value&&await se(),d.post(`/environments/${m.environment.id}/settings`)}function oe(){b.value.push("")}function ae(r){b.value.splice(r,1)}async function ie(){const r=b.value.filter(e=>e.trim()!=="");if(r.length===0){alert("Please add at least one site path");return}E.value=!0;try{const l=await(await fetch(`/environments/${m.environment.id}/config`,{method:"POST",headers:{"X-CSRF-TOKEN":B,"Content-Type":"application/json"},body:JSON.stringify({paths:r,tld:S.value.trim()||"test",default_php_version:A.value})})).json();l.success?(Y.value=l.data,q.value=S.value.trim()||"test"):alert("Failed to save config: "+(l.error||"Unknown error"))}catch{alert("Failed to save config")}finally{E.value=!1}}function re(){H.value=!0,V.value=""}function de(){H.value=!1,V.value=""}function ue(){V.value===m.environment.name&&ge.delete(`/environments/${m.environment.id}`,{onSuccess:()=>{}})}return pe(()=>{ne(),U.value&&te()}),(r,e)=>(n(),o(h,null,[a(s(ye),{title:`Settings - ${_.environment.name}`},null,8,["title"]),t("div",null,[t("div",$e,[a(_e,{title:"Settings"}),t("p",je,"Configure "+i(_.environment.name),1)]),t("form",{onSubmit:X(le,["prevent"])},[t("div",Ee,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-sm font-medium text-white"},"Environment Name",-1)),t("p",Ae,[e[9]||(e[9]=p(" Display name for this environment. ",-1)),U.value?(n(),o(h,{key:0},[e[7]||(e[7]=t("br",null,null,-1)),e[8]||(e[8]=t("span",{class:"text-xs text-zinc-600"},"Changes will be synced to the remote environment.",-1))],64)):u("",!0)])]),t("div",null,[t("div",Ne,[a(s(C),{modelValue:s(d).name,"onUpdate:modelValue":e[0]||(e[0]=l=>s(d).name=l),type:"text",id:"name",class:"w-full",disabled:$.value},null,8,["modelValue","disabled"]),$.value?(n(),g(s(L),{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-zinc-500"})):u("",!0)]),s(d).errors.name?(n(),o("p",He,i(s(d).errors.name),1)):u("",!0),w.value?(n(),o("p",Ie,i(w.value),1)):u("",!0)])]),e[16]||(e[16]=t("hr",{class:"border-zinc-800"},null,-1)),_.environment.is_local?u("",!0):(n(),o(h,{key:0},[t("div",Le,[e[14]||(e[14]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"SSH Connection"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Host, user, and port for SSH access. ")],-1)),t("div",Re,[t("div",null,[e[11]||(e[11]=t("label",{for:"host",class:"block text-sm font-medium text-zinc-400 mb-1"},"Host",-1)),a(s(C),{modelValue:s(d).host,"onUpdate:modelValue":e[1]||(e[1]=l=>s(d).host=l),type:"text",id:"host",class:"w-full font-mono"},null,8,["modelValue"]),s(d).errors.host?(n(),o("p",Oe,i(s(d).errors.host),1)):u("",!0)]),t("div",Be,[t("div",null,[e[12]||(e[12]=t("label",{for:"user",class:"block text-sm font-medium text-zinc-400 mb-1"},"User",-1)),a(s(C),{modelValue:s(d).user,"onUpdate:modelValue":e[2]||(e[2]=l=>s(d).user=l),type:"text",id:"user",class:"w-full font-mono"},null,8,["modelValue"]),s(d).errors.user?(n(),o("p",Ye,i(s(d).errors.user),1)):u("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{for:"port",class:"block text-sm font-medium text-zinc-400 mb-1"},"Port",-1)),a(s(C),{modelValue:s(d).port,"onUpdate:modelValue":e[3]||(e[3]=l=>s(d).port=l),type:"number",id:"port",class:"w-full font-mono"},null,8,["modelValue"]),s(d).errors.port?(n(),o("p",Me,i(s(d).errors.port),1)):u("",!0)])])])]),e[15]||(e[15]=t("hr",{class:"border-zinc-800"},null,-1))],64)),t("div",qe,[a(s(z),{type:"submit",disabled:s(d).processing||j.value,variant:"secondary"},{default:y(()=>[p(i(s(d).processing||j.value?"Saving...":"Save Environment"),1)]),_:1},8,["disabled"])])],32),e[35]||(e[35]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Je,[e[24]||(e[24]=t("h2",{class:"text-lg font-medium text-white mb-6"},"Orbit Configuration",-1)),N.value?(n(),o("div",Xe,[a(s(L),{class:"w-4 h-4 inline animate-spin mr-2"}),e[17]||(e[17]=p(" Loading configuration... ",-1))])):(n(),o(h,{key:1},[t("div",We,[e[19]||(e[19]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Site Paths"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Directories where your sites are located. ")],-1)),t("div",null,[t("div",Ze,[(n(!0),o(h,null,F(b.value,(l,v)=>(n(),o("div",{key:v,class:"flex items-center gap-2"},[a(s(C),{modelValue:b.value[v],"onUpdate:modelValue":x=>b.value[v]=x,type:"text",placeholder:"/home/user/sites",class:"flex-1 font-mono"},null,8,["modelValue","onUpdate:modelValue"]),t("button",{onClick:x=>ae(v),type:"button",class:"text-zinc-500 hover:text-red-400 p-2 transition-colors"},[a(s(Fe),{class:"w-4 h-4"})],8,Ge)]))),128))]),t("button",{onClick:oe,type:"button",class:"mt-2 text-sm text-zinc-400 hover:text-white transition-colors flex items-center gap-1"},[a(s(he),{class:"w-4 h-4"}),e[18]||(e[18]=p(" Add path ",-1))])])]),e[22]||(e[22]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Qe,[t("div",null,[e[20]||(e[20]=t("h3",{class:"text-sm font-medium text-white"},"TLD",-1)),t("p",Ke," Top-level domain for local sites. Sites will be accessible at sitename."+i(S.value||"test"),1)]),t("div",null,[a(s(C),{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=l=>S.value=l),type:"text",id:"config-tld",placeholder:"test",class:"w-full font-mono"},null,8,["modelValue"])])]),e[23]||(e[23]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",et,[e[21]||(e[21]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Default PHP Version"),t("p",{class:"text-sm text-zinc-500 mt-1"},"PHP version used for new sites.")],-1)),t("div",null,[a(s(Te),{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=l=>A.value=l)},{default:y(()=>[a(s(ze),{class:"w-full"},{default:y(()=>[a(s(Se),{placeholder:"Select PHP version"})]),_:1}),a(s(Ve),null,{default:y(()=>[(n(!0),o(h,null,F(M.value,l=>(n(),g(s(Pe),{key:l,value:l},{default:y(()=>[p(" PHP "+i(l),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),t("div",tt,[a(s(z),{onClick:ie,type:"button",disabled:E.value,variant:"secondary"},{default:y(()=>[p(i(E.value?"Saving...":"Save Configuration"),1)]),_:1},8,["disabled"])])],64))]),e[36]||(e[36]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",st,[a(Ce,{"environment-id":_.environment.id},null,8,["environment-id"])]),e[37]||(e[37]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",nt,[t("div",lt,[t("div",ot,[a(s(R),{class:"w-5 h-5 text-zinc-400"}),e[25]||(e[25]=t("h2",{class:"text-lg font-medium text-white"},"Health Check",-1)),f.value?(n(),o("span",{key:0,class:W(["text-xs px-2 py-0.5 rounded-full",f.value.status==="healthy"?"bg-lime-500/10 text-lime-400":f.value.status==="degraded"?"bg-amber-500/10 text-amber-400":"bg-red-500/10 text-red-400"])},i(f.value.status==="healthy"?"All Passed":f.value.status==="degraded"?"Warnings":"Issues Found"),3)):u("",!0)]),a(s(z),{onClick:J,disabled:P.value,variant:"outline"},{default:y(()=>[P.value?(n(),g(s(De),{key:0,class:"w-4 h-4 animate-spin"})):(n(),g(s(R),{key:1,class:"w-4 h-4"})),p(" "+i(P.value?"Running...":"Run Diagnostics"),1)]),_:1},8,["disabled"])]),k.value?(n(),o("div",at,[t("div",it,[a(s(G),{class:"w-5 h-5"}),t("span",null,i(k.value),1)])])):u("",!0),f.value?(n(),o("div",rt,[t("div",dt,[t("span",ut,i(f.value.summary.passed)+" passed",1),f.value.summary.warnings>0?(n(),o("span",ct,i(f.value.summary.warnings)+" warnings ",1)):u("",!0),f.value.summary.errors>0?(n(),o("span",mt,i(f.value.summary.errors)+" errors ",1)):u("",!0)]),(n(!0),o(h,null,F(f.value.checks,(l,v)=>(n(),o("div",{key:v,class:"border border-zinc-700/50 rounded-lg overflow-hidden"},[t("button",{onClick:x=>K(v),class:"w-full flex items-center justify-between p-3 bg-zinc-800/30 hover:bg-zinc-700/30 transition-colors text-left"},[t("div",ft,[l.status==="ok"?(n(),g(s(Ue),{key:0,class:"w-5 h-5 text-lime-400"})):l.status==="warning"?(n(),g(s(Z),{key:1,class:"w-5 h-5 text-amber-400"})):(n(),g(s(G),{key:2,class:"w-5 h-5 text-red-400"})),t("div",null,[t("span",pt,i(Q[v]||v),1),t("p",xt,i(l.message),1)])]),t("div",yt,[l.status==="error"&&l.details?.can_fix?(n(),g(s(z),{key:0,onClick:X(x=>ee(v),["stop"]),disabled:D.value.has(v),variant:"secondary",size:"sm"},{default:y(()=>[D.value.has(v)?(n(),g(s(L),{key:0,class:"w-3 h-3 animate-spin mr-1"})):u("",!0),p(" "+i(D.value.has(v)?"Fixing...":"Fix"),1)]),_:2},1032,["onClick","disabled"])):u("",!0),l.details&&Object.keys(l.details).length>0?(n(),g(s(be),{key:1,class:W(["w-4 h-4 text-zinc-500 transition-transform",T.value.has(v)?"rotate-180":""])},null,8,["class"])):u("",!0)])],8,vt),T.value.has(v)&&l.details&&Object.keys(l.details).filter(x=>x!=="can_fix").length>0?(n(),o("div",ht,[t("dl",gt,[(n(!0),o(h,null,F(l.details,(x,I)=>we((n(),o("div",{key:I,class:"flex"},[t("dt",bt,i(I),1),t("dd",wt,[Array.isArray(x)?(n(!0),o(h,{key:0},F(x,(ce,me)=>(n(),o("span",{key:me,class:"block"},i(ce),1))),128)):typeof x=="object"&&x!==null?(n(),o("pre",kt,i(JSON.stringify(x,null,2)),1)):(n(),o(h,{key:2},[p(i(x),1)],64))])])),[[ke,I!=="can_fix"]])),128))])])):u("",!0)]))),128))])):!P.value&&!k.value?(n(),o("div",_t,[a(s(R),{class:"w-12 h-12 mx-auto mb-3 opacity-50"}),e[26]||(e[26]=t("p",null,"Run diagnostics to check the health of this environment",-1))])):u("",!0)]),e[38]||(e[38]=t("hr",{class:"border-zinc-800"},null,-1)),r.$page.props.multi_environment?(n(),o("div",Ct,[e[34]||(e[34]=t("h2",{class:"text-lg font-medium text-red-400 mb-6"},"Danger Zone",-1)),t("div",zt,[e[33]||(e[33]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Delete Environment"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Permanently delete this environment. This action cannot be undone. ")],-1)),t("div",null,[H.value?(n(),o("div",Vt,[t("div",Pt,[a(s(Z),{class:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),t("div",null,[e[30]||(e[30]=t("p",{class:"text-sm text-red-300 font-medium"},"Are you sure?",-1)),t("p",Tt,[e[28]||(e[28]=p(" Type ",-1)),t("strong",Dt,i(_.environment.name),1),e[29]||(e[29]=p(" to confirm. ",-1))])])]),a(s(C),{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l),type:"text",placeholder:"Type environment name",class:"w-full"},null,8,["modelValue"]),t("div",Ft,[a(s(z),{onClick:ue,type:"button",disabled:V.value!==_.environment.name,variant:"destructive"},{default:y(()=>[...e[31]||(e[31]=[p(" Delete ",-1)])]),_:1},8,["disabled"]),a(s(z),{onClick:de,type:"button",variant:"ghost"},{default:y(()=>[...e[32]||(e[32]=[p(" Cancel ",-1)])]),_:1})])])):(n(),o("div",St,[a(s(z),{onClick:re,type:"button",variant:"destructive"},{default:y(()=>[...e[27]||(e[27]=[p(" Delete Environment ",-1)])]),_:1})]))])])])):u("",!0)])],64))}});export{Rt as default};
