import{j as le,d as ke,X as fe,z as xe,c as i,g as o,f as U,r as c,u as n,h as he,a as t,w as d,l as B,Y as Z,t as u,b as v,e as k,W as we,P as q,Z as J,F,i as V,o as l,s as K,m as Q,v as ee,U as te,M as h,R as ye,T as ge}from"./app-DCjzOA_Z.js";import{a as b}from"./axios-DBmgdnXZ.js";import{_ as se}from"./Modal.vue_vue_type_script_setup_true_lang-Bho30n21.js";import{_ as _e}from"./EditorIcon.vue_vue_type_script_setup_true_lang-DgrRAbn-.js";import{I as m}from"./craft-ui-LxbrBGk3.js";import{A as H}from"./arrow-left-ab0DyuCb.js";import{L as $}from"./loader-circle-Dbdq18o5.js";import{X as be}from"./x-CsXXWzxp.js";import{P as ae}from"./package-Bz-mHuWX.js";const ne=le("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const $e=le("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),ze={key:0,class:"space-y-6"},Se={class:"flex items-center gap-4"},Ce={class:"flex items-center gap-2"},Pe={class:"text-xl font-semibold text-white"},Le={class:"border border-zinc-800 rounded-xl p-12 text-center"},Ae={key:1,class:"space-y-6"},Ue={class:"flex items-center gap-4"},Fe={class:"border border-zinc-800 rounded-xl p-12 text-center"},We={class:"text-red-400"},Me={key:2,class:"space-y-6"},Ie={class:"flex items-center justify-between"},Te={class:"flex items-center gap-4"},je={class:"flex items-center gap-2"},Be={class:"text-xl font-semibold text-white"},Ve={class:"text-sm text-zinc-400 mt-1"},De={key:0,class:"flex items-center gap-2"},Ee={key:1,class:"flex items-center gap-2"},Ne={class:"border border-zinc-800 rounded-xl px-0.5 pt-4 pb-0.5"},Re={class:"border border-zinc-700/50 rounded-lg overflow-hidden"},qe={key:0,class:"p-8 text-center"},He={key:1,class:"divide-y divide-zinc-700/50"},Oe={class:"flex items-center justify-between px-4 py-3 hover:bg-zinc-700/30"},Xe={class:"flex items-center gap-3"},Ye=["onClick"],Ge={class:"font-medium text-white"},Ze={class:"ml-2 text-xs text-zinc-500 font-mono"},Je={class:"flex items-center gap-2"},Ke={key:0,class:"px-4 pb-3 pl-12 border-t border-zinc-700/30"},Qe={class:"pt-3"},et={class:"flex items-center gap-2 mb-2"},tt={key:0,class:"py-2 text-center"},st={key:1,class:"py-2"},at={key:2,class:"space-y-1"},nt={class:"flex items-center gap-2"},lt={class:"text-sm text-zinc-300 font-mono"},ot=["onClick","disabled"],it={class:"border border-zinc-800 rounded-xl p-4"},rt={class:"space-y-2 text-sm"},dt={class:"flex items-center gap-2"},ct={class:"font-mono text-zinc-300"},ut={class:"flex items-center gap-2"},vt={class:"font-mono text-zinc-300"},mt={key:0,class:"text-xs px-1.5 py-0.5 rounded bg-lime-400/10 text-lime-400"},pt={class:"flex items-center gap-2"},kt={key:0,class:"text-xs px-1.5 py-0.5 rounded bg-lime-400/10 text-lime-400"},ft={key:1,class:"text-zinc-400"},xt={class:"p-6"},ht={key:0,class:"text-center py-6"},wt={key:1,class:"text-center py-6"},yt={key:2},gt=["value"],_t={class:"flex justify-end gap-3 mt-6"},bt={class:"p-6"},$t={class:"text-zinc-400 mb-4"},zt={class:"text-white font-medium"},St={key:0,class:"text-center py-6"},Ct={key:1},Pt=["value"],Lt={class:"flex justify-end gap-3 mt-6"},Vt=ke({layout:fe,__name:"Show",props:{environment:{},workspaceName:{},editor:{},remoteApiUrl:{}},setup(f){const x=f,w=s=>x.remoteApiUrl?`${x.remoteApiUrl}${s}`:`/api/environments/${x.environment.id}${s}`,r=c(null),D=c(!0),C=c(null),P=c(!1),z=c(""),W=c(!1),M=c(null);async function oe(){D.value=!0,C.value=null;try{const{data:s}=await b.get(w(`/workspaces/${x.workspaceName}`));s.success&&s.data?r.value=s.data:C.value=s.error||"Workspace not found"}catch(s){if(te.isCancel(s))return;console.error("Failed to load workspace:",s),C.value="Failed to load workspace"}finally{D.value=!1}}const I=c([]),E=c(!1),y=c(new Set),L=c({}),g=c(new Set),A=c(!1),S=c(null),_=c(""),T=c(!1),j=c(null),O=K(()=>{if(!r.value)return[];const s=new Set(r.value.sites.map(e=>e.name));return I.value.filter(e=>!s.has(e.name))}),N=async()=>{if(P.value=!0,I.value.length===0){E.value=!0;try{const{data:s}=await b.get(w("/sites"));s.success&&s.data?.sites&&(I.value=s.data.sites)}catch(s){if(te.isCancel(s))return;console.error("Failed to load sites:",s)}finally{E.value=!1}}},ie=()=>{if(!r.value)return;const s=x.environment.user,e=x.environment.host,p=`${r.value.path}/${r.value.name}.code-workspace`,G=`${x.editor.scheme}://vscode-remote/ssh-remote+${s}@${e}${p}?windowId=_blank`;window.open(G,"_blank")},re=()=>{if(!r.value)return;const s=x.environment.user,e=x.environment.host,a=`ssh://${s}@${e}`;window.open(a,"_self")},de=async()=>{if(!z.value||!r.value)return;const s=z.value;W.value=!0;try{const{data:e}=await b.post(w(`/workspaces/${r.value.name}/sites`),{site:s},{});e.success&&e.workspace?(r.value=e.workspace,h.success(`Site "${s}" added to workspace`)):h.error("Failed to add site",{description:e.error||"Unknown error"}),P.value=!1,z.value=""}catch{}finally{W.value=!1}},ce=async s=>{if(r.value){M.value=s;try{const{data:e}=await b.delete(w(`/workspaces/${r.value.name}/sites/${s}`),{});e.success&&e.workspace?(r.value=e.workspace,h.success(`Site "${s}" removed from workspace`)):h.error("Failed to remove site",{description:e.error||"Unknown error"})}catch{}finally{M.value=null}}},X=s=>I.value.find(a=>a.name===s)?.display_name||s,ue=s=>{y.value.has(s)?y.value.delete(s):(y.value.add(s),L.value[s]||R(s)),y.value=new Set(y.value)},R=async s=>{g.value.add(s),g.value=new Set(g.value);try{const{data:e}=await b.get(w(`/packages/${s}/linked`),{});e.success&&(L.value[s]=e.linked_packages||[])}catch{}finally{g.value.delete(s),g.value=new Set(g.value)}},Y=K(()=>!S.value||!r.value?[]:r.value.sites.filter(s=>s.name!==S.value)),ve=s=>{S.value=s,_.value="",A.value=!0},me=async()=>{if(!_.value||!S.value)return;const s=_.value,e=S.value;T.value=!0;try{const{data:a}=await b.post(w(`/packages/${e}/link`),{package:s},{});a.success?(h.success(`Package "${s}" linked to "${e}"`),await R(e)):h.error("Failed to link package",{description:a.error||"Unknown error"}),A.value=!1,_.value=""}catch{}finally{T.value=!1}},pe=async(s,e)=>{j.value=`${s}:${e}`;try{const{data:a}=await b.delete(w(`/packages/${s}/unlink/${encodeURIComponent(e)}`),{});a.success?(h.success(`Package "${e}" unlinked from "${s}"`),await R(s)):h.error("Failed to unlink package",{description:a.error||"Unknown error"})}catch{}finally{j.value=null}};return xe(()=>{oe()}),(s,e)=>(l(),i(F,null,[o(n(he),{title:`${r.value?.name||f.workspaceName} - Workspaces`},null,8,["title"]),D.value?(l(),i("div",ze,[t("div",Se,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:d(()=>[o(n(H),{class:"w-5 h-5"})]),_:1},8,["href"]),t("div",null,[t("div",Ce,[o(n(Z),{class:"w-5 h-5 text-lime-400"}),t("h1",Pe,u(f.workspaceName),1)])])]),t("div",Le,[o(n($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-4"}),e[6]||(e[6]=t("p",{class:"text-zinc-400"},"Loading workspace...",-1))])])):C.value?(l(),i("div",Ae,[t("div",Ue,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:d(()=>[o(n(H),{class:"w-5 h-5"})]),_:1},8,["href"]),e[7]||(e[7]=t("div",null,[t("h1",{class:"text-xl font-semibold text-white"},"Workspace Not Found")],-1))]),t("div",Fe,[t("p",We,u(C.value),1),o(n(m),{"as-child":"",variant:"outline",class:"mt-4"},{default:d(()=>[o(n(B),{href:`/environments/${f.environment.id}/workspaces`},{default:d(()=>[...e[8]||(e[8]=[v(" Back to Workspaces ",-1)])]),_:1},8,["href"])]),_:1})])])):r.value?(l(),i("div",Me,[t("div",Ie,[t("div",Te,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:d(()=>[o(n(H),{class:"w-5 h-5"})]),_:1},8,["href"]),t("div",null,[t("div",je,[o(n(Z),{class:"w-5 h-5 text-lime-400"}),t("h1",Be,u(r.value.name),1)]),t("p",Ve,u(r.value.site_count)+" site"+u(r.value.site_count!==1?"s":""),1)])]),s.$page.props.multi_environment?(l(),i("div",De,[o(n(m),{onClick:re,variant:"outline",title:"Open in Terminal"},{default:d(()=>[o(n(we),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=v(" SSH ",-1))]),_:1}),r.value.has_workspace_file?(l(),k(n(m),{key:0,onClick:ie,variant:"outline"},{default:d(()=>[o(_e,{editor:f.editor.scheme,class:"w-4 h-4 mr-2"},null,8,["editor"]),v(" Open in "+u(f.editor.name),1)]),_:1})):U("",!0),o(n(m),{onClick:N,variant:"secondary"},{default:d(()=>[o(n(q),{class:"w-4 h-4 mr-2"}),e[10]||(e[10]=v(" Add Site ",-1))]),_:1})])):(l(),i("div",Ee,[o(n(m),{onClick:N,variant:"secondary"},{default:d(()=>[o(n(q),{class:"w-4 h-4 mr-2"}),e[11]||(e[11]=v(" Add Site ",-1))]),_:1})]))]),t("div",Ne,[e[16]||(e[16]=t("div",{class:"px-4 mb-4"},[t("h2",{class:"text-sm font-medium text-zinc-400 uppercase tracking-wider"},"Sites")],-1)),t("div",Re,[r.value.sites.length===0?(l(),i("div",qe,[o(n(J),{class:"w-10 h-10 mx-auto text-muted-foreground mb-3"}),e[13]||(e[13]=t("p",{class:"text-muted-foreground mb-4"},"No sites in this workspace yet.",-1)),o(n(m),{onClick:N,variant:"secondary"},{default:d(()=>[o(n(q),{class:"w-4 h-4 mr-2"}),e[12]||(e[12]=v(" Add Your First Site ",-1))]),_:1})])):(l(),i("div",He,[(l(!0),i(F,null,V(r.value.sites,a=>(l(),i("div",{key:a.name,class:"bg-zinc-800/30"},[t("div",Oe,[t("div",Xe,[t("button",{onClick:p=>ue(a.name),class:"p-0.5 rounded hover:bg-white/10 text-zinc-400"},[y.value.has(a.name)?(l(),k(n(ye),{key:0,class:"w-4 h-4"})):(l(),k(n(ge),{key:1,class:"w-4 h-4"}))],8,Ye),o(n(J),{class:"w-4 h-4 text-lime-400"}),t("div",null,[t("span",Ge,u(X(a.name)),1),t("span",Ze,u(a.name),1)])]),t("div",Je,[o(n(m),{onClick:p=>ve(a.name),variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-lime-400",title:"Link a package"},{default:d(()=>[o(n(ne),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"]),o(n(m),{onClick:p=>ce(a.name),variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-red-400",disabled:M.value===a.name},{default:d(()=>[M.value===a.name?(l(),k(n($),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),k(n(be),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])])]),y.value.has(a.name)?(l(),i("div",Ke,[t("div",Qe,[t("div",et,[o(n(ae),{class:"w-3.5 h-3.5 text-zinc-500"}),e[14]||(e[14]=t("span",{class:"text-xs text-zinc-500 uppercase tracking-wider"},"Linked Packages",-1))]),g.value.has(a.name)?(l(),i("div",tt,[o(n($),{class:"w-4 h-4 animate-spin text-zinc-500 mx-auto"})])):!L.value[a.name]||L.value[a.name].length===0?(l(),i("div",st,[...e[15]||(e[15]=[t("p",{class:"text-xs text-zinc-500"},"No packages linked.",-1)])])):(l(),i("div",at,[(l(!0),i(F,null,V(L.value[a.name],p=>(l(),i("div",{key:p.name,class:"flex items-center justify-between py-1.5 px-2 rounded bg-zinc-700/30"},[t("div",nt,[o(n(ae),{class:"w-3.5 h-3.5 text-amber-400"}),t("span",lt,u(p.name),1)]),t("button",{onClick:G=>pe(a.name,p.name),class:"p-1 rounded hover:bg-zinc-600 text-zinc-400 hover:text-red-400",disabled:j.value===`${a.name}:${p.name}`,title:"Unlink package"},[j.value===`${a.name}:${p.name}`?(l(),k(n($),{key:0,class:"w-3 h-3 animate-spin"})):(l(),k(n($e),{key:1,class:"w-3 h-3"}))],8,ot)]))),128))]))])])):U("",!0)]))),128))]))])]),t("div",it,[e[20]||(e[20]=t("h2",{class:"text-sm font-medium text-zinc-400 uppercase tracking-wider mb-3"}," Workspace Info ",-1)),t("div",rt,[t("div",dt,[e[17]||(e[17]=t("span",{class:"text-zinc-500"},"Path:",-1)),t("span",ct,u(r.value.path),1)]),t("div",ut,[e[18]||(e[18]=t("span",{class:"text-zinc-500"},"Workspace file:",-1)),t("span",vt,u(r.value.name)+".code-workspace",1),r.value.has_workspace_file?(l(),i("span",mt," Ready ")):U("",!0)]),t("div",pt,[e[19]||(e[19]=t("span",{class:"text-zinc-500"},"CLAUDE.md:",-1)),r.value.has_claude_md?(l(),i("span",kt," Present ")):(l(),i("span",ft,"Not found"))])])])])):U("",!0),o(se,{show:P.value,title:"Add Site to Workspace",onClose:e[2]||(e[2]=a=>P.value=!1)},{default:d(()=>[t("div",xt,[E.value?(l(),i("div",ht,[o(n($),{class:"w-6 h-6 mx-auto text-zinc-400 animate-spin mb-2"}),e[21]||(e[21]=t("p",{class:"text-zinc-400"},"Loading sites...",-1))])):O.value.length===0?(l(),i("div",wt,[...e[22]||(e[22]=[t("p",{class:"text-zinc-400"},"All sites are already in this workspace.",-1)])])):(l(),i("div",yt,[e[24]||(e[24]=t("label",{for:"site-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a site ",-1)),Q(t("select",{id:"site-select","onUpdate:modelValue":e[0]||(e[0]=a=>z.value=a),class:"w-full"},[e[23]||(e[23]=t("option",{value:""},"Choose a site...",-1)),(l(!0),i(F,null,V(O.value,a=>(l(),i("option",{key:a.name,value:a.name},u(a.display_name||a.name),9,gt))),128))],512),[[ee,z.value]])])),t("div",_t,[o(n(m),{onClick:e[1]||(e[1]=a=>P.value=!1),variant:"ghost"},{default:d(()=>[...e[25]||(e[25]=[v("Cancel",-1)])]),_:1}),o(n(m),{onClick:de,variant:"secondary",disabled:!z.value||W.value},{default:d(()=>[W.value?(l(),k(n($),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):U("",!0),e[26]||(e[26]=v(" Add Site ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"]),o(se,{show:A.value,title:"Link Package",onClose:e[5]||(e[5]=a=>A.value=!1)},{default:d(()=>[t("div",bt,[t("p",$t,[e[27]||(e[27]=v(" Link a package from this workspace to ",-1)),t("span",zt,u(S.value),1),e[28]||(e[28]=v(" for local development. ",-1))]),Y.value.length===0?(l(),i("div",St,[...e[29]||(e[29]=[t("p",{class:"text-zinc-400"}," No other sites in this workspace to link as packages. ",-1)])])):(l(),i("div",Ct,[e[31]||(e[31]=t("label",{for:"package-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a package to link ",-1)),Q(t("select",{id:"package-select","onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),class:"w-full"},[e[30]||(e[30]=t("option",{value:""},"Choose a package...",-1)),(l(!0),i(F,null,V(Y.value,a=>(l(),i("option",{key:a.name,value:a.name},u(X(a.name)),9,Pt))),128))],512),[[ee,_.value]]),e[32]||(e[32]=t("p",{class:"text-xs text-zinc-500 mt-2"}," The selected site will be symlinked as a Composer dependency. ",-1))])),t("div",Lt,[o(n(m),{onClick:e[4]||(e[4]=a=>A.value=!1),variant:"ghost"},{default:d(()=>[...e[33]||(e[33]=[v("Cancel",-1)])]),_:1}),o(n(m),{onClick:me,variant:"secondary",disabled:!_.value||T.value},{default:d(()=>[T.value?(l(),k(n($),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):(l(),k(n(ne),{key:1,class:"w-4 h-4 mr-2"})),e[34]||(e[34]=v(" Link Package ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"])],64))}});export{Vt as default};
