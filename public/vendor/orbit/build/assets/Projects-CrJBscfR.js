import{c as ie,d as we,K as ze,D as V,x as f,m as je,p as te,a as i,h as l,b as a,u as o,i as Pe,g as w,t as d,w as p,l as Ce,e as g,P as $e,r as u,L as De,F as N,j as se,o as n,f as c,s as Se,M as Fe,n as Le,N as Ae,T as Ve,E as Ne}from"./app-B9x7YZpu.js";import{a as R}from"./axios-CuURMwPl.js";import{_ as Re}from"./Modal.vue_vue_type_script_setup_true_lang-JtiZ9cDD.js";import{I as h,e as Ue,X as Ie}from"./craft-ui-CaWVxHTa.js";import{C as ne}from"./circle-alert-DUDXhcwq.js";import{L as z}from"./loader-circle-Cx9CfdV2.js";import{F as M}from"./folder-open-DucOw6Q4.js";import{G as ae}from"./globe-BNW_dHMY.js";import{T as oe}from"./trash-2-C8HupC45.js";import{P as Te}from"./package-DsKwOuKk.js";import{R as Ee}from"./refresh-cw-BtgbN3DG.js";const He=ie("clock-3",[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Me=ie("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),Be={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},qe={class:"text-sm text-zinc-500 mt-1"},Oe={class:"flex items-center gap-2"},Ge={key:0,class:"mb-6 p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg flex items-start gap-3"},Xe={class:"text-zinc-400 text-sm mt-1"},Ke={key:0},Qe={key:1},We={key:1,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Ye={key:2,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Je={key:3,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Ze={class:"flex items-center gap-3 min-w-0"},et={class:"min-w-0"},tt={class:"font-medium text-sm text-zinc-100 truncate"},st={key:0,class:"text-xs text-zinc-500 truncate"},nt={class:"text-sm"},at={key:0,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-lime-500/15 text-lime-400"},ot={key:1,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-red-500/15 text-red-400"},it={key:2,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-red-500/15 text-red-400"},rt={key:3,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-red-500/15 text-red-400"},lt={key:4,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-amber-500/15 text-amber-400"},ct={key:5,class:"text-zinc-500/50"},dt={key:0,class:"text-sm text-zinc-500 font-mono"},ut={key:1,class:"flex items-center gap-2"},pt=["value","onChange","disabled"],mt=["value"],ft={class:"flex items-center justify-end gap-1"},gt={key:0,class:"text-xs text-lime-400"},vt={key:1,class:"text-xs text-red-400"},xt={key:2,class:"text-xs text-zinc-500"},ht={class:"flex items-center gap-0.5 opacity-60 hover:opacity-100 transition-opacity"},bt={class:"flex items-center justify-between mt-4 px-1"},_t={class:"flex items-center gap-4 text-xs text-zinc-500"},kt={class:"flex items-center gap-1.5"},yt={class:"flex items-center gap-1.5"},wt={class:"flex items-center gap-1.5 text-xs"},zt={key:0,class:"inline-flex items-center gap-1.5 text-lime-400"},jt={key:1,class:"inline-flex items-center gap-1.5 text-amber-400"},Pt={class:"p-6"},Ct={class:"text-zinc-300 mb-4"},$t={class:"text-white"},Dt={class:"flex items-center gap-3 mb-6"},St={key:0,class:"mb-4 p-3 bg-red-400/10 border border-red-400/20 rounded-lg"},Ft={class:"text-red-400 text-sm"},Lt={class:"flex justify-end gap-3"},qt=we({__name:"Projects",props:{environment:{},editor:{},remoteApiUrl:{}},setup(j){const m=j,U=s=>m.remoteApiUrl?`${m.remoteApiUrl}${s}`:`/api/environments/${m.environment.id}${s}`,re=Se(),B=u([]),le=["queued","creating_repo","cloning","setting_up","installing_composer","installing_npm","building","finalizing"],I=u(!0),ce=u("test"),D=u("8.4"),q=u(["8.3","8.4","8.5"]),T=u(null),O=te(()=>{const s=new Map(B.value.map(e=>[e.name,e]));for(const[e,t]of E.value)s.has(e)||s.set(e,{id:0,name:e,path:`~/projects/${e}`,has_public_folder:!1,php_version:D.value,status:t.status});return Array.from(s.values()).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))}),{provisioningProjects:E,deletingProjects:G,isConnected:X,connectionError:K,projectReadyCount:de,projectDeletedCount:ue,isConfigured:Q,trackProject:pe,getProjectStatus:me,trackDeletion:fe,getDeletionStatus:W,markDeletionComplete:ge,markDeletionFailed:Y}=ze(),J=te(()=>{const s=re.props.flash;return s?.provisioning?s.provisioning:new URLSearchParams(window.location.search).get("provisioning")}),Z={queued:"Queued...",provisioning:"Initializing...",validating_package:"Validating package...",creating_project:"Creating project...",forking:"Forking repository...",creating_repo:"Creating repository...",cloning:"Cloning...",setting_up:"Setting up...",installing_composer:"Installing Composer...",installing_npm:"Installing dependencies...",building:"Building assets...",finalizing:"Finalizing...",ready:"Ready",failed:"Failed"},ve={deleting:"Deleting...",removing_files:"Removing files...",deleted:"Deleted",delete_failed:"Delete failed"};function S(s){return s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}function v(s){const e=S(s),t=W(e);return t?t.status!=="delete_failed":!1}function x(s){const e=S(s);return W(e)?.status??null}function ee(s){const e=s.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),t=me(e);return t||(s.status&&le.includes(s.status)?{slug:s.name,status:s.status,error:s.error_message??null,projectId:s.id}:null)}function b(s){const e=ee(s);return e?e.status!=="ready"&&e.status!=="failed":!1}function _(s){const e=ee(s);return e?.status==="ready"?null:e?.status??null}function H(s,e){const t=s||"Unknown error";if(t.includes("Connection error"))f.error("Connection Error",{description:"Could not connect to the environment. Check if Orbit is running."});else{const r=e.charAt(0).toUpperCase()+e.slice(1)+" Failed";f.error(r,{description:t})}}async function k(s=!1){s||(I.value=!0);try{const{data:e}=await R.get(U("/projects"));e.success&&e.data?(B.value=e.data.projects||[],ce.value=e.data.tld||"test",D.value=e.data.default_php_version||"8.4",e.data.available_php_versions?.length&&(q.value=e.data.available_php_versions)):!e.success&&!s&&H(e.error,"load projects")}catch(e){if(Fe.isCancel(e))return;console.error("Failed to load projects:",e)}finally{s||(I.value=!1)}}function xe(s){const e=`https://${s}`;window.open(e,"_blank")}function he(s){let e;if(m.environment.is_local)e=`${m.editor.scheme}://file${s}`;else{const t=`${m.environment.user}@${m.environment.host}`;e=`${m.editor.scheme}://vscode-remote/ssh-remote+${t}${s}?windowId=_blank`}window.open(e,"_blank")}async function be(s,e){if(s.domain){T.value=s.name;try{const t=encodeURIComponent(s.name),{data:r}=await R.post(`/projects/${t}/php`,{version:e});r.success?(f.success("PHP Version Changed",{description:`Now using PHP ${e} for this project.`}),await k(!0)):H(r.error,"change PHP version")}catch{}finally{T.value=null}}}const P=u(!1),C=u(null),$=u(!1),F=u(null),L=u(!0);function _e(s){C.value=s,F.value=null,L.value=!0,P.value=!0}async function ke(){if(!C.value)return;const s=C.value.name,e=S(s);X.value||f.warning("Real-time updates unavailable",{description:"Deletion will proceed but you may need to refresh the page to see updated status."}),P.value=!1,fe(e),C.value=null,$.value=!1,F.value=null;const t=!L.value;try{const r=m.remoteApiUrl?`/projects/${e}`:U(`/projects/${e}`),{data:y}=await R.delete(r,{params:{keep_db:t?"1":"0"}});y.success?(ge(e),await k(!0)):Y(e,y.error||"Failed to delete project")}catch(r){console.error("Failed to delete project:",r),Y(e,"An error occurred while deleting the project")}}const A=u(null);async function ye(s){A.value=s.name;const e=S(s.name);try{const{data:t}=await R.post(U(`/projects/${e}/rebuild`),{});t.success?(f.success("Project Rebuilt",{description:`"${s.name}" has been rebuilt successfully.`}),await k(!0)):H(t.error,"rebuild project")}catch{}finally{A.value=null}}return V(de,()=>{for(const[s,e]of E.value)if(e.status==="ready"){f.success("Project Created",{description:`"${s}" has been created successfully.`});break}setTimeout(()=>{k(!0)},500)}),V(ue,()=>{for(const[s,e]of G.value)if(e.status==="deleted"){f.success("Project Deleted",{description:`"${s}" has been removed.`});break}setTimeout(()=>{k(!0)},500)}),V(()=>[...E.value.values()],(s,e)=>{for(const t of s){const r=e?.find(y=>y.slug===t.slug);t.status==="failed"&&r?.status!=="failed"&&f.error(`Failed to create project "${t.slug}"`,{description:t.error||"Unknown error occurred"})}},{deep:!0}),V(()=>[...G.value.values()],(s,e)=>{for(const t of s){const r=e?.find(y=>y.slug===t.slug);t.status==="delete_failed"&&r?.status!=="delete_failed"&&f.error(`Failed to delete project "${t.slug}"`,{description:t.error||"Unknown error occurred"})}},{deep:!0}),je(()=>{J.value&&pe(J.value),k()}),(s,e)=>(n(),i(N,null,[l(o(Pe),{title:`Projects - ${j.environment.name}`},null,8,["title"]),a("div",null,[a("header",Be,[a("div",null,[e[3]||(e[3]=a("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Projects",-1)),a("p",qe,"Projects in "+d(j.environment.name),1)]),a("div",Oe,[l(o(h),{"as-child":"",size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:p(()=>[l(o(Ce),{href:`/environments/${j.environment.id}/projects/create`},{default:p(()=>[l(o($e),{class:"w-4 h-4 mr-1.5"}),e[4]||(e[4]=g(" New Project ",-1))]),_:1},8,["href"])]),_:1})])]),o(K)||!o(Q)?(n(),i("div",Ge,[l(o(ne),{class:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),a("div",null,[e[5]||(e[5]=a("p",{class:"text-amber-400 font-medium text-sm"},"Real-time updates unavailable",-1)),a("p",Xe,[o(Q)?(n(),i("span",Qe," Could not connect to WebSocket: "+d(o(K))+". Status updates for provisioning and deletion will not appear automatically. ",1)):(n(),i("span",Ke," Reverb is not configured for this environment. Status updates for provisioning and deletion will not appear automatically. "))])])])):w("",!0),I.value?(n(),i("div",We,[l(o(z),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[6]||(e[6]=a("p",{class:"text-zinc-500"},"Loading projects...",-1))])):O.value.length===0?(n(),i("div",Ye,[l(o(M),{class:"w-12 h-12 mx-auto text-zinc-600 mb-3"}),e[7]||(e[7]=a("h3",{class:"text-lg font-medium text-zinc-100 mb-2"},"No projects found",-1)),e[8]||(e[8]=a("p",{class:"text-zinc-400"},"Add project directories in the environment configuration.",-1))])):(n(),i("div",Je,[e[11]||(e[11]=De('<div class="grid grid-cols-[1fr_100px_140px_160px] items-center gap-4 px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"><span class="text-xs font-medium text-zinc-500 uppercase tracking-wide">Project</span><span class="text-xs font-medium text-zinc-500 uppercase tracking-wide">Status</span><span class="text-xs font-medium text-zinc-500 uppercase tracking-wide">PHP</span><span class="text-xs font-medium text-zinc-500 uppercase tracking-wide text-right">Actions</span></div>',1)),a("div",null,[(n(!0),i(N,null,se(O.value,t=>(n(),i("div",{key:t.name,class:Le(["grid grid-cols-[1fr_100px_140px_160px] items-center gap-4 px-4 py-3 border-b border-zinc-800/50 last:border-b-0 transition-colors hover:bg-zinc-800/30",{"opacity-50":v(t.name),"bg-zinc-800/20":b(t),"bg-lime-500/5":x(t.name)==="deleted","bg-red-500/5":v(t.name)&&x(t.name)!=="deleted"}])},[a("div",Ze,[x(t.name)==="deleted"?(n(),c(o(Ae),{key:0,class:"w-4 h-4 shrink-0 text-lime-400"})):v(t.name)?(n(),c(o(z),{key:1,class:"w-4 h-4 shrink-0 text-red-400 animate-spin"})):b(t)?(n(),c(o(z),{key:2,class:"w-4 h-4 shrink-0 text-amber-400 animate-spin"})):_(t)==="queued"?(n(),c(o(He),{key:3,class:"w-4 h-4 shrink-0 text-blue-400"})):_(t)==="failed"||x(t.name)==="delete_failed"?(n(),c(o(ne),{key:4,class:"w-4 h-4 shrink-0 text-red-400"})):t.project_type==="laravel-package"?(n(),c(o(Te),{key:5,class:"w-4 h-4 shrink-0 text-purple-400"})):t.project_type==="cli"?(n(),c(o(Ve),{key:6,class:"w-4 h-4 shrink-0 text-amber-400"})):t.has_public_folder?(n(),c(o(ae),{key:7,class:"w-4 h-4 shrink-0 text-lime-400"})):(n(),c(o(M),{key:8,class:"w-4 h-4 shrink-0 text-zinc-500"})),a("div",et,[a("p",tt,d(t.display_name||t.name),1),t.github_repo&&!b(t)&&!v(t.name)?(n(),i("p",st,d(t.github_repo),1)):w("",!0)])]),a("div",nt,[x(t.name)==="deleted"?(n(),i("span",at," Deleted ")):x(t.name)==="delete_failed"?(n(),i("span",ot," Failed ")):v(t.name)?(n(),i("span",it,d(ve[x(t.name)]),1)):_(t)==="failed"?(n(),i("span",rt," Failed ")):_(t)?(n(),i("span",lt,d(Z[_(t)]),1)):(n(),i("span",ct,"â€”"))]),a("div",null,[b(t)||v(t.name)?(n(),i("div",dt,d(t.php_version||D.value),1)):T.value===t.name?(n(),i("div",ut,[l(o(z),{class:"w-4 h-4 text-zinc-400 animate-spin"}),e[9]||(e[9]=a("span",{class:"text-sm text-zinc-500"},"...",-1))])):(n(),i("select",{key:2,value:t.php_version||D.value,onChange:r=>be(t,r.target.value),class:"h-8 w-[110px] text-xs py-1 pl-2 pr-7 font-mono bg-zinc-800/50 border border-zinc-700 rounded-md text-zinc-100 hover:bg-zinc-800",disabled:!t.has_public_folder},[(n(!0),i(N,null,se(q.value,r=>(n(),i("option",{key:r,value:r}," PHP "+d(r),9,mt))),128))],40,pt))]),a("div",ft,[x(t.name)==="deleted"?(n(),i("div",gt," Deleted ")):v(t.name)?(n(),i("div",vt," Deleting... ")):b(t)?(n(),i("div",xt,d(Z[_(t)??"queued"]),1)):(n(),i(N,{key:3},[t.has_public_folder&&t.domain?(n(),c(o(h),{key:0,onClick:r=>xe(t.domain),variant:"outline",size:"sm",class:"h-8 px-3 bg-transparent border-zinc-700 text-zinc-300 hover:bg-zinc-800"},{default:p(()=>[l(o(Ne),{class:"w-3.5 h-3.5 mr-1.5"}),e[10]||(e[10]=g(" Open ",-1))]),_:1},8,["onClick"])):w("",!0),a("div",ht,[s.$page.props.multi_environment?(n(),c(o(h),{key:0,onClick:r=>he(t.path),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800",title:`Open in ${j.editor.name}`},{default:p(()=>[l(o(Me),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick","title"])):w("",!0),t.has_public_folder&&!b(t)&&!v(t.name)?(n(),c(o(h),{key:1,onClick:r=>ye(t),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-amber-400 hover:bg-zinc-800",disabled:A.value===t.name,title:"Rebuild project"},{default:p(()=>[A.value===t.name?(n(),c(o(z),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),c(o(Ee),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):w("",!0),l(o(h),{onClick:r=>_e(t),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-red-500/10",title:"Delete project"},{default:p(()=>[l(o(oe),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"])])],64))])],2))),128))])])),a("div",bt,[a("div",_t,[a("div",kt,[l(o(ae),{class:"h-3.5 w-3.5 text-lime-400"}),e[12]||(e[12]=a("span",null,"Has public folder",-1))]),a("div",yt,[l(o(M),{class:"h-3.5 w-3.5"}),e[13]||(e[13]=a("span",null,"No public folder",-1))])]),a("div",wt,[o(X)?(n(),i("span",zt,[...e[14]||(e[14]=[a("span",{class:"w-2 h-2 rounded-full bg-lime-400"},null,-1),g(" Live updates ",-1)])])):(n(),i("span",jt,[...e[15]||(e[15]=[a("span",{class:"w-2 h-2 rounded-full bg-amber-400"},null,-1),g(" No live updates ",-1)])]))])]),l(Re,{show:P.value,title:"Delete Project",onClose:e[2]||(e[2]=t=>P.value=!1)},{default:p(()=>[a("div",Pt,[a("p",Ct,[e[16]||(e[16]=g(" Are you sure you want to delete ",-1)),a("strong",$t,d(C.value?.name),1),e[17]||(e[17]=g("? ",-1))]),e[20]||(e[20]=a("p",{class:"text-zinc-400 text-sm mb-4"},"This will:",-1)),e[21]||(e[21]=a("ul",{class:"text-zinc-400 text-sm mb-4 list-disc list-inside space-y-1"},[a("li",null,"Remove the site directory from the server")],-1)),a("div",Dt,[l(o(Ue),{id:"delete-database",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=t=>L.value=t),class:"border-zinc-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary data-[state=checked]:text-primary-foreground"},null,8,["modelValue"]),l(o(Ie),{for:"delete-database",class:"text-zinc-300 text-sm cursor-pointer"},{default:p(()=>[...e[18]||(e[18]=[g(" Also delete the database ",-1)])]),_:1})]),e[22]||(e[22]=a("p",{class:"text-red-400 text-sm mb-6"},"This action cannot be undone.",-1)),F.value?(n(),i("div",St,[a("p",Ft,d(F.value),1)])):w("",!0),a("div",Lt,[l(o(h),{onClick:e[1]||(e[1]=t=>P.value=!1),variant:"outline",disabled:$.value},{default:p(()=>[...e[19]||(e[19]=[g(" Cancel ",-1)])]),_:1},8,["disabled"]),l(o(h),{onClick:ke,variant:"destructive",disabled:$.value},{default:p(()=>[$.value?(n(),c(o(z),{key:0,class:"w-4 h-4 animate-spin"})):(n(),c(o(oe),{key:1,class:"w-4 h-4"})),g(" "+d($.value?"Deleting...":"Delete Project"),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"])])],64))}});export{qt as default};
