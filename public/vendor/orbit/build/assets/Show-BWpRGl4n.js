import{I as le,d as ke,Z as fe,y as xe,c as r,g as o,f as C,r as d,u as n,h as he,a as t,w as u,l as B,_ as X,t as v,b as m,e as p,Y as we,P as Z,$ as J,F,i as V,o as l,s as K,m as Q,v as ee,U as te,M as h,R as ye,T as ge}from"./app-BZLVASEU.js";import{a as b}from"./axios-4k9TOXX-.js";import{_ as se}from"./Modal.vue_vue_type_script_setup_true_lang-zgz_8DMb.js";import{_ as _e}from"./EditorIcon.vue_vue_type_script_setup_true_lang-CMAmOsCm.js";import{I as k}from"./craft-ui-DfllBy1J.js";import{A as R}from"./arrow-left-CAJdYlSp.js";import{L as $}from"./loader-circle-C5yW0TaK.js";import{X as be}from"./x-e8qLUX40.js";import{P as ae}from"./package-BLiz-zse.js";const ne=le("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);const $e=le("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]),ze={key:0,class:"space-y-6"},Se={class:"flex items-center gap-4"},Ce={class:"flex items-center gap-2"},Pe={class:"text-xl font-semibold text-white"},Le={class:"border border-zinc-800 rounded-xl p-12 text-center"},Ae={key:1,class:"space-y-6"},Ue={class:"flex items-center gap-4"},Fe={class:"border border-zinc-800 rounded-xl p-12 text-center"},Ie={class:"text-red-400"},Me={key:2,class:"space-y-6"},We={class:"flex items-center justify-between"},Te={class:"flex items-center gap-4"},je={class:"flex items-center gap-2"},Be={class:"text-xl font-semibold text-white"},Ve={class:"text-sm text-zinc-400 mt-1"},De={class:"flex items-center gap-2"},Ee={class:"border border-zinc-800 rounded-xl px-0.5 pt-4 pb-0.5"},Ne={class:"border border-zinc-700/50 rounded-lg overflow-hidden"},Re={key:0,class:"p-8 text-center"},qe={key:1,class:"divide-y divide-zinc-700/50"},He={class:"flex items-center justify-between px-4 py-3 hover:bg-zinc-700/30"},Oe={class:"flex items-center gap-3"},Ye=["onClick"],Ge={class:"font-medium text-white"},Xe={class:"ml-2 text-xs text-zinc-500 font-mono"},Ze={class:"flex items-center gap-2"},Je={key:0,class:"px-4 pb-3 pl-12 border-t border-zinc-700/30"},Ke={class:"pt-3"},Qe={class:"flex items-center gap-2 mb-2"},et={key:0,class:"py-2 text-center"},tt={key:1,class:"py-2"},st={key:2,class:"space-y-1"},at={class:"flex items-center gap-2"},nt={class:"text-sm text-zinc-300 font-mono"},lt=["onClick","disabled"],ot={class:"border border-zinc-800 rounded-xl p-4"},it={class:"space-y-2 text-sm"},rt={class:"flex items-center gap-2"},ct={class:"font-mono text-zinc-300"},dt={class:"flex items-center gap-2"},ut={class:"font-mono text-zinc-300"},vt={key:0,class:"text-xs px-1.5 py-0.5 rounded bg-lime-400/10 text-lime-400"},mt={class:"flex items-center gap-2"},pt={key:0,class:"text-xs px-1.5 py-0.5 rounded bg-lime-400/10 text-lime-400"},kt={key:1,class:"text-zinc-400"},ft={class:"p-6"},xt={key:0,class:"text-center py-6"},ht={key:1,class:"text-center py-6"},wt={key:2},yt=["value"],gt={class:"flex justify-end gap-3 mt-6"},_t={class:"p-6"},bt={class:"text-zinc-400 mb-4"},$t={class:"text-white font-medium"},zt={key:0,class:"text-center py-6"},St={key:1},Ct=["value"],Pt={class:"flex justify-end gap-3 mt-6"},Bt=ke({layout:fe,__name:"Show",props:{environment:{},workspaceName:{},editor:{},remoteApiUrl:{}},setup(f){const c=f,w=s=>c.remoteApiUrl?`${c.remoteApiUrl}${s}`:`/api/environments/${c.environment.id}${s}`,i=d(null),D=d(!0),P=d(null),L=d(!1),z=d(""),I=d(!1),M=d(null);async function oe(){D.value=!0,P.value=null;try{const{data:s}=await b.get(w(`/workspaces/${c.workspaceName}`));s.success&&s.data?i.value=s.data:P.value=s.error||"Workspace not found"}catch(s){if(te.isCancel(s))return;console.error("Failed to load workspace:",s),P.value="Failed to load workspace"}finally{D.value=!1}}const W=d([]),E=d(!1),y=d(new Set),A=d({}),g=d(new Set),U=d(!1),S=d(null),_=d(""),T=d(!1),j=d(null),q=K(()=>{if(!i.value)return[];const s=new Set(i.value.sites.map(e=>e.name));return W.value.filter(e=>!s.has(e.name))}),H=async()=>{if(L.value=!0,W.value.length===0){E.value=!0;try{const{data:s}=await b.get(w("/sites"));s.success&&s.data?.sites&&(W.value=s.data.sites)}catch(s){if(te.isCancel(s))return;console.error("Failed to load sites:",s)}finally{E.value=!1}}},ie=()=>{if(!i.value)return;const e=`${i.value.path}/${i.value.name}.code-workspace`;let a;if(c.environment.external_access||!c.environment.is_local){const x=c.environment.user,G=c.environment.external_access&&c.environment.external_host?c.environment.external_host:c.environment.host;a=`${c.editor.scheme}://vscode-remote/ssh-remote+${x}@${G}${e}?windowId=_blank`}else a=`${c.editor.scheme}://file${e}`;window.open(a,"_blank")},re=()=>{if(!i.value)return;const s=c.environment.user,e=c.environment.external_access&&c.environment.external_host?c.environment.external_host:c.environment.host,a=`ssh://${s}@${e}${i.value.path}`;window.open(a,"_self")},ce=async()=>{if(!z.value||!i.value)return;const s=z.value;I.value=!0;try{const{data:e}=await b.post(w(`/workspaces/${i.value.name}/sites`),{site:s},{});e.success&&e.workspace?(i.value=e.workspace,h.success(`Site "${s}" added to workspace`)):h.error("Failed to add site",{description:e.error||"Unknown error"}),L.value=!1,z.value=""}catch{}finally{I.value=!1}},de=async s=>{if(i.value){M.value=s;try{const{data:e}=await b.delete(w(`/workspaces/${i.value.name}/sites/${s}`),{});e.success&&e.workspace?(i.value=e.workspace,h.success(`Site "${s}" removed from workspace`)):h.error("Failed to remove site",{description:e.error||"Unknown error"})}catch{}finally{M.value=null}}},O=s=>W.value.find(a=>a.name===s)?.display_name||s,ue=s=>{y.value.has(s)?y.value.delete(s):(y.value.add(s),A.value[s]||N(s)),y.value=new Set(y.value)},N=async s=>{g.value.add(s),g.value=new Set(g.value);try{const{data:e}=await b.get(w(`/packages/${s}/linked`),{});e.success&&(A.value[s]=e.linked_packages||[])}catch{}finally{g.value.delete(s),g.value=new Set(g.value)}},Y=K(()=>!S.value||!i.value?[]:i.value.sites.filter(s=>s.name!==S.value)),ve=s=>{S.value=s,_.value="",U.value=!0},me=async()=>{if(!_.value||!S.value)return;const s=_.value,e=S.value;T.value=!0;try{const{data:a}=await b.post(w(`/packages/${e}/link`),{package:s},{});a.success?(h.success(`Package "${s}" linked to "${e}"`),await N(e)):h.error("Failed to link package",{description:a.error||"Unknown error"}),U.value=!1,_.value=""}catch{}finally{T.value=!1}},pe=async(s,e)=>{j.value=`${s}:${e}`;try{const{data:a}=await b.delete(w(`/packages/${s}/unlink/${encodeURIComponent(e)}`),{});a.success?(h.success(`Package "${e}" unlinked from "${s}"`),await N(s)):h.error("Failed to unlink package",{description:a.error||"Unknown error"})}catch{}finally{j.value=null}};return xe(()=>{oe()}),(s,e)=>(l(),r(F,null,[o(n(he),{title:`${i.value?.name||f.workspaceName} - Workspaces`},null,8,["title"]),D.value?(l(),r("div",ze,[t("div",Se,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:u(()=>[o(n(R),{class:"w-5 h-5"})]),_:1},8,["href"]),t("div",null,[t("div",Ce,[o(n(X),{class:"w-5 h-5 text-lime-400"}),t("h1",Pe,v(f.workspaceName),1)])])]),t("div",Le,[o(n($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-4"}),e[6]||(e[6]=t("p",{class:"text-zinc-400"},"Loading workspace...",-1))])])):P.value?(l(),r("div",Ae,[t("div",Ue,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:u(()=>[o(n(R),{class:"w-5 h-5"})]),_:1},8,["href"]),e[7]||(e[7]=t("div",null,[t("h1",{class:"text-xl font-semibold text-white"},"Workspace Not Found")],-1))]),t("div",Fe,[t("p",Ie,v(P.value),1),o(n(k),{"as-child":"",variant:"outline",class:"mt-4"},{default:u(()=>[o(n(B),{href:`/environments/${f.environment.id}/workspaces`},{default:u(()=>[...e[8]||(e[8]=[m(" Back to Workspaces ",-1)])]),_:1},8,["href"])]),_:1})])])):i.value?(l(),r("div",Me,[t("div",We,[t("div",Te,[o(n(B),{href:`/environments/${f.environment.id}/workspaces`,class:"p-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-white"},{default:u(()=>[o(n(R),{class:"w-5 h-5"})]),_:1},8,["href"]),t("div",null,[t("div",je,[o(n(X),{class:"w-5 h-5 text-lime-400"}),t("h1",Be,v(i.value.name),1)]),t("p",Ve,v(i.value.site_count)+" site"+v(i.value.site_count!==1?"s":""),1)])]),t("div",De,[f.environment.external_access?(l(),p(n(k),{key:0,onClick:re,variant:"outline",title:"Open in Terminal"},{default:u(()=>[o(n(we),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=m(" SSH ",-1))]),_:1})):C("",!0),i.value.has_workspace_file?(l(),p(n(k),{key:1,onClick:ie,variant:"outline"},{default:u(()=>[o(_e,{editor:f.editor.scheme,class:"w-4 h-4 mr-2"},null,8,["editor"]),m(" Open in "+v(f.editor.name),1)]),_:1})):C("",!0),o(n(k),{onClick:H,variant:"secondary"},{default:u(()=>[o(n(Z),{class:"w-4 h-4 mr-2"}),e[10]||(e[10]=m(" Add Site ",-1))]),_:1})])]),t("div",Ee,[e[15]||(e[15]=t("div",{class:"px-4 mb-4"},[t("h2",{class:"text-sm font-medium text-zinc-400 uppercase tracking-wider"},"Sites")],-1)),t("div",Ne,[i.value.sites.length===0?(l(),r("div",Re,[o(n(J),{class:"w-10 h-10 mx-auto text-muted-foreground mb-3"}),e[12]||(e[12]=t("p",{class:"text-muted-foreground mb-4"},"No sites in this workspace yet.",-1)),o(n(k),{onClick:H,variant:"secondary"},{default:u(()=>[o(n(Z),{class:"w-4 h-4 mr-2"}),e[11]||(e[11]=m(" Add Your First Site ",-1))]),_:1})])):(l(),r("div",qe,[(l(!0),r(F,null,V(i.value.sites,a=>(l(),r("div",{key:a.name,class:"bg-zinc-800/30"},[t("div",He,[t("div",Oe,[t("button",{onClick:x=>ue(a.name),class:"p-0.5 rounded hover:bg-white/10 text-zinc-400"},[y.value.has(a.name)?(l(),p(n(ye),{key:0,class:"w-4 h-4"})):(l(),p(n(ge),{key:1,class:"w-4 h-4"}))],8,Ye),o(n(J),{class:"w-4 h-4 text-lime-400"}),t("div",null,[t("span",Ge,v(O(a.name)),1),t("span",Xe,v(a.name),1)])]),t("div",Ze,[o(n(k),{onClick:x=>ve(a.name),variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-lime-400",title:"Link a package"},{default:u(()=>[o(n(ne),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"]),o(n(k),{onClick:x=>de(a.name),variant:"ghost",size:"sm",class:"text-muted-foreground hover:text-red-400",disabled:M.value===a.name},{default:u(()=>[M.value===a.name?(l(),p(n($),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),p(n(be),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])])]),y.value.has(a.name)?(l(),r("div",Je,[t("div",Ke,[t("div",Qe,[o(n(ae),{class:"w-3.5 h-3.5 text-zinc-500"}),e[13]||(e[13]=t("span",{class:"text-xs text-zinc-500 uppercase tracking-wider"},"Linked Packages",-1))]),g.value.has(a.name)?(l(),r("div",et,[o(n($),{class:"w-4 h-4 animate-spin text-zinc-500 mx-auto"})])):!A.value[a.name]||A.value[a.name].length===0?(l(),r("div",tt,[...e[14]||(e[14]=[t("p",{class:"text-xs text-zinc-500"},"No packages linked.",-1)])])):(l(),r("div",st,[(l(!0),r(F,null,V(A.value[a.name],x=>(l(),r("div",{key:x.name,class:"flex items-center justify-between py-1.5 px-2 rounded bg-zinc-700/30"},[t("div",at,[o(n(ae),{class:"w-3.5 h-3.5 text-amber-400"}),t("span",nt,v(x.name),1)]),t("button",{onClick:G=>pe(a.name,x.name),class:"p-1 rounded hover:bg-zinc-600 text-zinc-400 hover:text-red-400",disabled:j.value===`${a.name}:${x.name}`,title:"Unlink package"},[j.value===`${a.name}:${x.name}`?(l(),p(n($),{key:0,class:"w-3 h-3 animate-spin"})):(l(),p(n($e),{key:1,class:"w-3 h-3"}))],8,lt)]))),128))]))])])):C("",!0)]))),128))]))])]),t("div",ot,[e[19]||(e[19]=t("h2",{class:"text-sm font-medium text-zinc-400 uppercase tracking-wider mb-3"}," Workspace Info ",-1)),t("div",it,[t("div",rt,[e[16]||(e[16]=t("span",{class:"text-zinc-500"},"Path:",-1)),t("span",ct,v(i.value.path),1)]),t("div",dt,[e[17]||(e[17]=t("span",{class:"text-zinc-500"},"Workspace file:",-1)),t("span",ut,v(i.value.name)+".code-workspace",1),i.value.has_workspace_file?(l(),r("span",vt," Ready ")):C("",!0)]),t("div",mt,[e[18]||(e[18]=t("span",{class:"text-zinc-500"},"CLAUDE.md:",-1)),i.value.has_claude_md?(l(),r("span",pt," Present ")):(l(),r("span",kt,"Not found"))])])])])):C("",!0),o(se,{show:L.value,title:"Add Site to Workspace",onClose:e[2]||(e[2]=a=>L.value=!1)},{default:u(()=>[t("div",ft,[E.value?(l(),r("div",xt,[o(n($),{class:"w-6 h-6 mx-auto text-zinc-400 animate-spin mb-2"}),e[20]||(e[20]=t("p",{class:"text-zinc-400"},"Loading sites...",-1))])):q.value.length===0?(l(),r("div",ht,[...e[21]||(e[21]=[t("p",{class:"text-zinc-400"},"All sites are already in this workspace.",-1)])])):(l(),r("div",wt,[e[23]||(e[23]=t("label",{for:"site-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a site ",-1)),Q(t("select",{id:"site-select","onUpdate:modelValue":e[0]||(e[0]=a=>z.value=a),class:"w-full"},[e[22]||(e[22]=t("option",{value:""},"Choose a site...",-1)),(l(!0),r(F,null,V(q.value,a=>(l(),r("option",{key:a.name,value:a.name},v(a.display_name||a.name),9,yt))),128))],512),[[ee,z.value]])])),t("div",gt,[o(n(k),{onClick:e[1]||(e[1]=a=>L.value=!1),variant:"ghost"},{default:u(()=>[...e[24]||(e[24]=[m("Cancel",-1)])]),_:1}),o(n(k),{onClick:ce,variant:"secondary",disabled:!z.value||I.value},{default:u(()=>[I.value?(l(),p(n($),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):C("",!0),e[25]||(e[25]=m(" Add Site ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"]),o(se,{show:U.value,title:"Link Package",onClose:e[5]||(e[5]=a=>U.value=!1)},{default:u(()=>[t("div",_t,[t("p",bt,[e[26]||(e[26]=m(" Link a package from this workspace to ",-1)),t("span",$t,v(S.value),1),e[27]||(e[27]=m(" for local development. ",-1))]),Y.value.length===0?(l(),r("div",zt,[...e[28]||(e[28]=[t("p",{class:"text-zinc-400"}," No other sites in this workspace to link as packages. ",-1)])])):(l(),r("div",St,[e[30]||(e[30]=t("label",{for:"package-select",class:"block text-sm font-medium text-zinc-300 mb-2"}," Select a package to link ",-1)),Q(t("select",{id:"package-select","onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),class:"w-full"},[e[29]||(e[29]=t("option",{value:""},"Choose a package...",-1)),(l(!0),r(F,null,V(Y.value,a=>(l(),r("option",{key:a.name,value:a.name},v(O(a.name)),9,Ct))),128))],512),[[ee,_.value]]),e[31]||(e[31]=t("p",{class:"text-xs text-zinc-500 mt-2"}," The selected site will be symlinked as a Composer dependency. ",-1))])),t("div",Pt,[o(n(k),{onClick:e[4]||(e[4]=a=>U.value=!1),variant:"ghost"},{default:u(()=>[...e[32]||(e[32]=[m("Cancel",-1)])]),_:1}),o(n(k),{onClick:me,variant:"secondary",disabled:!_.value||T.value},{default:u(()=>[T.value?(l(),p(n($),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):(l(),p(n(ne),{key:1,class:"w-4 h-4 mr-2"})),e[33]||(e[33]=m(" Link Package ",-1))]),_:1},8,["disabled"])])])]),_:1},8,["show"])],64))}});export{Bt as default};
