import{j as L,d as me,z as fe,e as v,w as h,a,c as u,r as m,o as l,g as c,u as s,S as ve,F as P,i as Y,f as z,s as A,t as y,J as ke,b as _,P as Se,x as ze,p as _e,m as he,v as Be,K as Je,L as Qe,M as b,N as Ye,D as Ge,h as Xe,n as Q,O as Ze,Q as ge}from"./app-DCjzOA_Z.js";import{u as $e}from"./services-CBPKovjs.js";import{_ as Ke}from"./Heading.vue_vue_type_script_setup_true_lang-BwQHPwFZ.js";import{_ as se}from"./Modal.vue_vue_type_script_setup_true_lang-Bho30n21.js";import{I as S,H as et,Y as T,D as be}from"./craft-ui-LxbrBGk3.js";import{L as $}from"./loader-circle-Dbdq18o5.js";import{G as Ce}from"./globe-Rnh2-q8B.js";import{_ as tt}from"./DnsSettings.vue_vue_type_script_setup_true_lang-jA4ECtxO.js";import{C as st}from"./circle-alert-Dh9QSmOu.js";import{E as at}from"./eye-6man2BrV.js";import{R as de}from"./refresh-cw-4CuCbkPq.js";import{T as lt}from"./trash-2-C8A-D6Uu.js";import{X as nt}from"./x-CsXXWzxp.js";const pe=L("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const te=L("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const it=L("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const xe=L("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Pe=L("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const ye=L("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const ot=L("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const we=L("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const rt=L("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),ct={class:"p-6"},ut={key:0,class:"py-12 text-center"},dt={key:1,class:"py-12 text-center"},vt={key:2,class:"space-y-8"},pt={key:0},mt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ht={class:"flex items-start justify-between mb-2"},gt={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},bt={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},xt={class:"text-white font-medium mb-1"},yt={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},wt=me({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(j,{emit:E}){const i=j,I=E,D=$e(),V=m(!0),C=m([]),g=m(null),k=A(()=>i.getApiUrl("")),W=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],O=A(()=>{const r={core:[],php:[],database:[],utility:[]};return C.value.forEach(n=>{r[n.category]?r[n.category].push(n):r.utility.push(n)}),r}),M=async()=>{V.value=!0;try{const n=await(await fetch(i.getApiUrl("/services/available"))).json();n.success&&(C.value=n.data||[])}catch(r){console.error("Failed to fetch available services:",r)}finally{V.value=!1}},B=async r=>{g.value=r;try{const n=await D.enableService(r,k.value);n?.success?(I("serviceEnabled",r),I("close")):alert("Failed to enable service: "+(n?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{g.value=null}},w=r=>{switch(r){case"core":return Ce;case"database":return te;case"php":return pe;case"utility":return Pe;default:return ve}};return fe(()=>{i.show&&M()}),(r,n)=>(l(),v(se,{show:j.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:n[0]||(n[0]=p=>r.$emit("close"))},{default:h(()=>[a("div",ct,[V.value?(l(),u("div",ut,[c(s($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),n[1]||(n[1]=a("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):C.value.length===0?(l(),u("div",dt,[c(s(ve),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),n[2]||(n[2]=a("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(l(),u("div",vt,[(l(),u(P,null,Y(W,p=>(l(),u(P,{key:p.key},[O.value[p.key].length>0?(l(),u("div",pt,[a("h4",mt,y(p.label),1),a("div",ft,[(l(!0),u(P,null,Y(O.value[p.key],f=>(l(),u("div",{key:f.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[a("div",null,[a("div",ht,[a("div",gt,[(l(),v(ke(w(f.category)),{class:"w-5 h-5"}))]),f.required?(l(),u("span",bt," Required ")):z("",!0)]),a("h5",xt,y(f.label),1),a("p",yt,y(f.description),1)]),c(s(S),{onClick:ae=>B(f.name),disabled:g.value!==null,variant:"secondary",class:"w-full justify-center"},{default:h(()=>[g.value===f.name?(l(),u(P,{key:0},[c(s($),{class:"w-4 h-4 animate-spin mr-2"}),n[3]||(n[3]=_(" Enabling... ",-1))],64)):(l(),u(P,{key:1},[c(s(Se),{class:"w-4 h-4 mr-2"}),n[4]||(n[4]=_(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):z("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),kt={class:"p-6"},St={key:0,class:"py-12 text-center"},zt={key:1,class:"py-12 text-center"},_t={key:2},$t=["for"],Ct={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Pt={key:0,class:"relative"},Mt=["id","onUpdate:modelValue"],At=["value"],Vt={key:1,class:"flex items-center"},Ut={class:"ml-3 text-sm text-zinc-400"},Ft={key:2,class:"relative"},jt=["id","type","onUpdate:modelValue","placeholder"],Rt=["onClick"],Lt={key:3,class:"text-xs text-zinc-500"},Et={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},Ht=me({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(j,{emit:E}){const i=j,I=E,D=m(!0),V=m(!1),C=m(null),g=m({}),k=m({}),W=A(()=>i.serviceName==="dns"),O=async()=>{if(i.serviceName){D.value=!0;try{const r=await(await fetch(i.getApiUrl(`/services/${i.serviceName}/info`))).json();if(r.success&&r.data){C.value=r.data,g.value={...r.data.config};const n={};Object.entries(r.data.configSchema).forEach(([p,f])=>{f.secret&&(n[p]=!1)}),k.value=n}}catch(w){console.error("Failed to fetch service info:",w)}finally{D.value=!1}}},M=async()=>{if(i.serviceName){V.value=!0;try{const r=await(await fetch(i.getApiUrl(`/services/${i.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":i.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:g.value})})).json();r.success?(I("configUpdated",i.serviceName),I("close")):alert("Failed to update configuration: "+(r.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{V.value=!1}}},B=w=>{k.value[w]=!k.value[w]};return ze(()=>i.show,w=>{w&&i.serviceName?O():(C.value=null,g.value={})}),fe(()=>{i.show&&i.serviceName&&O()}),(w,r)=>(l(),v(se,{show:j.show,title:C.value?`Configure ${C.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:r[1]||(r[1]=n=>w.$emit("close"))},{default:h(()=>[a("div",kt,[D.value?(l(),u("div",St,[c(s($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),r[2]||(r[2]=a("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!C.value&&!W.value?(l(),u("div",zt,[c(s(st),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),r[3]||(r[3]=a("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):W.value?(l(),u("div",_t,[c(tt,{"environment-id":j.environmentId},null,8,["environment-id"])])):(l(),u("form",{key:3,onSubmit:_e(M,["prevent"]),class:"space-y-6"},[(l(!0),u(P,null,Y(C.value?.configSchema??{},(n,p)=>(l(),u("div",{key:p,class:"space-y-1.5"},[a("label",{for:p,class:"block text-sm font-medium text-zinc-300"},[_(y(n.label)+" ",1),n.secret?(l(),u("span",Ct,"Secret")):z("",!0)],8,$t),n.enum?(l(),u("div",Pt,[he(a("select",{id:p,"onUpdate:modelValue":f=>g.value[p]=f,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(l(!0),u(P,null,Y(n.enum,f=>(l(),u("option",{key:f,value:f},y(f),9,At))),128))],8,Mt),[[Be,g.value[p]]]),r[4]||(r[4]=a("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[a("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[a("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):n.type==="boolean"?(l(),u("div",Vt,[c(s(et),{checked:g.value[p],"onUpdate:checked":f=>g.value[p]=f},null,8,["checked","onUpdate:checked"]),a("span",Ut,y(g.value[p]?"Enabled":"Disabled"),1)])):(l(),u("div",Ft,[he(a("input",{id:p,type:n.secret&&!k.value[p]?"password":n.type==="integer"?"number":"text","onUpdate:modelValue":f=>g.value[p]=f,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:n.default?.toString()},null,8,jt),[[Je,g.value[p]]]),n.secret?(l(),u("button",{key:0,type:"button",onClick:f=>B(p),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[k.value[p]?(l(),v(s(it),{key:0,class:"w-4 h-4"})):(l(),v(s(at),{key:1,class:"w-4 h-4"}))],8,Rt)):z("",!0)])),n.description?(l(),u("p",Lt,y(n.description),1)):z("",!0)]))),128)),a("div",Et,[c(s(S),{type:"button",onClick:r[0]||(r[0]=n=>w.$emit("close")),variant:"outline"},{default:h(()=>[...r[5]||(r[5]=[_(" Cancel ",-1)])]),_:1}),c(s(S),{type:"submit",disabled:V.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:h(()=>[V.value?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(l(),v(s(ot),{key:1,class:"w-4 h-4 mr-2"})),r[6]||(r[6]=_(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),Nt={class:"mb-8 flex items-start justify-between"},qt={class:"text-zinc-400 mt-1"},Tt={class:"flex items-center gap-2"},It={key:0,class:"border border-zinc-800 rounded-lg p-8 text-center"},Dt={key:1,class:"space-y-6"},Wt={key:0,class:"border border-zinc-600/40 rounded-xl px-0.5 pt-4 pb-0.5 bg-zinc-800/40"},Ot={class:"px-4 mb-4 flex items-center justify-between"},Bt={class:"text-sm font-medium text-white"},Jt={class:"border border-zinc-600/50 rounded-lg overflow-hidden divide-y divide-zinc-600/40"},Qt={class:"flex items-center gap-4"},Yt={class:"flex items-center gap-2"},Gt={class:"font-medium text-white"},Xt={class:"text-sm text-zinc-400"},Zt={key:0,class:"text-zinc-600"},Kt={key:1,class:"font-mono text-xs"},es={class:"flex items-center gap-2"},ts={class:"flex items-center gap-1 ml-2"},ss={key:0,class:"px-4 pb-3 -mt-2"},as={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-2 py-1 flex items-center justify-between"},ls=["onClick"],ns={class:"flex flex-col max-h-[70vh]"},is={class:"flex items-center gap-3 px-6 py-3 border-b border-zinc-800 bg-zinc-900/50"},os={class:"flex-1 overflow-auto p-4 bg-black"},rs={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap"},cs={class:"p-6"},us={key:0,class:"py-8 text-center"},ds={class:"grid grid-cols-2 gap-4"},vs={class:"grid grid-cols-2 gap-4"},ps={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},Cs=me({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(j){const E=j,i=$e(),I=Ze(),D=Qe(),V=A(()=>!!I.props.reverb?.enabled),C=m(!1);ze(D,t=>{V.value&&t==="failed"&&!C.value&&(C.value=!0,b.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const g=t=>E.remoteApiUrl?`${E.remoteApiUrl}${t}`:`/api/environments/${E.environment.id}${t}`,k=A(()=>g("")),W=document.querySelector('meta[name="csrf-token"]')?.content||"",O=A(()=>i.services),M=m(!1),B=A(()=>i.servicesRunning),w=A(()=>i.servicesTotal),r=m(!1),n=m(null),p=m(!1),f=m(!1),ae=m(null),le=m(!1),H=m(null),G=m(""),K=m(!1),J=m(!1);let R=null;const X=m(!1),ne=m(!1),Z=m(!1),ie=m(""),x=m({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),oe={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:Ce,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:ve,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:te,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:te,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:te,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Pe,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:rt,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker management for Redis",icon:xe,category:"utility",required:!0}};function ee(t){return t==="caddy"||t.startsWith("php-")||t==="horizon"?"host":"docker"}function Me(t){if(oe[t])return oe[t];if(t.startsWith("php-")){const e=t.replace("php-","");let o=e;return e.length===2&&!e.includes(".")&&(o=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${o}`,description:"Native PHP-FPM service",icon:pe,category:"php"}}return{name:t,description:"Service",icon:pe,category:"utility"}}const Ae=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],re=A(()=>{const t={core:[],php:[],database:[],utility:[]};for(const[e,o]of Object.entries(O.value)){const d=Me(e);t[d.category].push({key:e,service:o,meta:d})}return t.php.sort((e,o)=>e.key.localeCompare(o.key)),t}),Ve=A(()=>B.value===w.value&&w.value>0),Ue=A(()=>B.value===0);function Fe(t){if(!t.startsWith("php-"))return null;const e=t.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const je=A(()=>{const t=re.value.php.map(({key:e})=>Fe(e)).filter(e=>e!==null);return t.length===0?null:(t.sort((e,o)=>{const[d,U]=e.split(".").map(Number),[F,q]=o.split(".").map(Number);return d!==F?d-F:U-q}),t[t.length-1])});async function Re(){const t=je.value;if(!t){b.error("No PHP services detected");return}ie.value=t,ne.value=!0,X.value=!0;try{const e=await fetch(g(`/php/config/${t}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const o=await e.json();o.success&&o.data?.settings&&(x.value={...x.value,...o.data.settings})}catch(e){b.error(`Error loading PHP settings: ${e}`)}finally{ne.value=!1}}async function Le(){Z.value=!0;try{const t=await fetch(g(`/php/config/${ie.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x.value)});if(!t.ok)throw new Error("Failed to save PHP settings");const e=await t.json();e.success?(b.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),X.value=!1):b.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(t){b.error("Error Saving PHP Settings",{description:String(t)})}finally{Z.value=!1}}async function N(t=!1){t||(M.value=!0);try{await i.fetchServices(k.value)}finally{t||(M.value=!1)}}async function Ee(){n.value="start-all";try{const t=await i.startAll(k.value);t.success?(b.success("Services Starting",{description:"All services are being started."}),await N(!0)):b.error("Failed to Start Services",{description:t.error||"An unknown error occurred."})}catch{b.error("Failed to Start Services",{description:"Could not connect to the server."})}finally{n.value=null}}async function He(){n.value="stop-all";try{const t=await i.stopAll(k.value);t.success?(b.success("Services Stopping",{description:"All services are being stopped."}),await N(!0)):b.error("Failed to Stop Services",{description:t.error||"An unknown error occurred."})}catch{b.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{n.value=null}}async function Ne(){r.value=!0,n.value="restart-all";try{const t=await i.restartAll(k.value);t.success?(b.success("Services Restarting",{description:"All services are being restarted."}),await N(!0)):b.error("Failed to Restart Services",{description:t.error||"An unknown error occurred."})}catch{b.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{r.value=!1,n.value=null}}async function ce(t,e){const o=ee(t);try{let d;e==="start"?d=await i.startService(t,k.value,o):e==="stop"?d=await i.stopService(t,k.value,o):d=await i.restartService(t,k.value,o),d?.success?d.jobId||await N(!0):b.error(`Failed to ${e} ${t}: `+(d?.error||"Unknown error"))}catch{b.error(`Failed to ${e} ${t}`)}}async function qe(t){if(confirm(`Are you sure you want to remove ${t}?`))try{const e=await i.disableService(t,k.value);e?.success?(b.success(`${t} disabled`),await N(!0)):b.error("Failed to remove service: "+(e?.error||"Unknown error"))}catch{b.error("Failed to remove service")}}function Te(t){ae.value=t,f.value=!0}async function Ie(t){H.value=t,le.value=!0,await ue()}async function ue(){if(H.value){K.value=!0;try{const e=ee(H.value)==="host"?`/host-services/${H.value}/logs`:`/services/${H.value}/logs`,d=await(await fetch(g(e))).json();d.success?G.value=d.logs||"No logs available":G.value="Failed to fetch logs: "+(d.error||"Unknown error")}catch{G.value="Failed to fetch logs"}finally{K.value=!1}}}function De(){le.value=!1,H.value=null,G.value="",J.value=!1,R&&(clearInterval(R),R=null)}function We(){J.value=!J.value,J.value?R=setInterval(ue,3e3):R&&(clearInterval(R),R=null)}function Oe(t){return t.icon}return V.value&&Ye("orbit",".service.status.changed",t=>{i.handleServiceStatusChanged(t.job_id,t.service,t.status,t.error),t.error?b.error(`Failed to ${t.action} ${t.service}: ${t.error}`):b.success(`${t.service} ${t.action} completed`)}),fe(async()=>{i.setActiveEnvironment(E.environment.id),i.isStale&&N(),i.recoverPendingJobs(k.value)}),Ge(()=>{R&&clearInterval(R)}),(t,e)=>(l(),u(P,null,[c(s(Xe),{title:`Services - ${j.environment.name}`},null,8,["title"]),a("div",null,[a("div",Nt,[a("div",null,[c(Ke,{title:"Services"}),a("p",qt,[M.value?(l(),u(P,{key:0},[_("Loading services...")],64)):(l(),u(P,{key:1},[_(y(B.value)+"/"+y(w.value)+" services running",1)],64))])]),a("div",Tt,[c(s(S),{onClick:e[0]||(e[0]=o=>p.value=!0),disabled:M.value,size:"sm"},{default:h(()=>[c(s(Se),{class:"w-4 h-4"}),e[15]||(e[15]=_(" Add Service ",-1))]),_:1},8,["disabled"]),e[19]||(e[19]=a("div",{class:"w-px h-5 bg-zinc-700 mx-1"},null,-1)),Ve.value?z("",!0):(l(),v(s(S),{key:0,onClick:Ee,disabled:M.value||n.value!==null,variant:"outline",size:"sm"},{default:h(()=>[n.value==="start-all"?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(ye),{key:1,class:"w-4 h-4"})),e[16]||(e[16]=_(" Start All ",-1))]),_:1},8,["disabled"])),Ue.value?z("",!0):(l(),v(s(S),{key:1,onClick:He,disabled:M.value||n.value!==null,variant:"outline",size:"sm"},{default:h(()=>[n.value==="stop-all"?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(we),{key:1,class:"w-4 h-4"})),e[17]||(e[17]=_(" Stop All ",-1))]),_:1},8,["disabled"])),c(s(S),{onClick:Ne,disabled:M.value||n.value!==null,variant:"outline",size:"sm"},{default:h(()=>[r.value?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(de),{key:1,class:"w-4 h-4"})),e[18]||(e[18]=_(" Restart All ",-1))]),_:1},8,["disabled"])])]),M.value?(l(),u("div",It,[c(s($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[20]||(e[20]=a("p",{class:"text-zinc-500"},"Loading services...",-1))])):(l(),u("div",Dt,[(l(),u(P,null,Y(Ae,o=>(l(),u(P,{key:o.key},[re.value[o.key].length>0?(l(),u("div",Wt,[a("div",Ot,[a("h3",Bt,y(o.label),1),o.key==="php"?(l(),v(s(S),{key:0,onClick:Re,variant:"ghost",size:"icon-sm",title:"PHP Settings"},{default:h(()=>[c(s(ge),{class:"w-4 h-4"})]),_:1})):z("",!0)]),a("div",Jt,[(l(!0),u(P,null,Y(re.value[o.key],({key:d,service:U,meta:F})=>(l(),u("div",{key:d,class:"p-4 flex items-center justify-between bg-zinc-700/30 group"},[a("div",Qt,[a("div",{class:Q(["w-10 h-10 rounded-lg flex items-center justify-center",U.status==="running"?"bg-lime-500/10":"bg-zinc-700/50"])},[(l(),v(ke(Oe(F)),{class:Q(["w-5 h-5",U.status==="running"?"text-lime-400":"text-zinc-500"])},null,8,["class"]))],2),a("div",null,[a("div",Yt,[a("span",Gt,y(F.name),1),U.required||F.required?(l(),v(s(be),{key:0,variant:"secondary",class:"text-[10px] font-bold uppercase tracking-tight"},{default:h(()=>[...e[21]||(e[21]=[_(" Required ",-1)])]),_:1})):z("",!0),c(s(be),{class:Q(["text-[10px] font-bold uppercase tracking-tight",ee(d)==="host"?"bg-blue-500/10 text-blue-400 border-blue-500/20":"bg-purple-500/10 text-purple-400 border-purple-500/20"])},{default:h(()=>[_(y(ee(d)==="host"?"Host":"Docker"),1)]),_:2},1032,["class"]),a("span",{class:Q(["w-2 h-2 rounded-full",U.status==="running"?"bg-lime-400":"bg-zinc-600"])},null,2)]),a("div",Xt,[_(y(F.description)+" ",1),F.ports?(l(),u("span",Zt," Â· ")):z("",!0),F.ports?(l(),u("span",Kt,y(F.ports),1)):z("",!0)])])]),a("div",es,[a("span",{class:Q(["text-xs px-2 py-1 rounded-full capitalize",U.status==="running"?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400"])},y(U.status),3),a("div",ts,[U.status!=="running"?(l(),v(s(S),{key:0,onClick:q=>ce(d,"start"),disabled:s(i).isServicePending(d),variant:"ghost",size:"icon-sm",class:"text-zinc-400 hover:text-lime-400",title:"Start"},{default:h(()=>[s(i).isServicePending(d)?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(ye),{key:1,class:"w-4 h-4"}))]),_:2},1032,["onClick","disabled"])):z("",!0),U.status==="running"?(l(),v(s(S),{key:1,onClick:q=>ce(d,"stop"),disabled:s(i).isServicePending(d),variant:"ghost",size:"icon-sm",class:"text-zinc-400 hover:text-red-400",title:"Stop"},{default:h(()=>[s(i).isServicePending(d)?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(we),{key:1,class:"w-4 h-4"}))]),_:2},1032,["onClick","disabled"])):z("",!0),c(s(S),{onClick:q=>ce(d,"restart"),disabled:s(i).isServicePending(d),variant:"ghost",size:"icon-sm",title:"Restart"},{default:h(()=>[s(i).isServicePending(d)?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(de),{key:1,class:"w-4 h-4"}))]),_:2},1032,["onClick","disabled"]),c(s(S),{onClick:q=>Te(d),variant:"ghost",size:"icon-sm",title:"Configure"},{default:h(()=>[c(s(ge),{class:"w-4 h-4"})]),_:1},8,["onClick"]),c(s(S),{onClick:q=>Ie(d),variant:"ghost",size:"icon-sm",title:"View Logs"},{default:h(()=>[c(s(xe),{class:"w-4 h-4"})]),_:1},8,["onClick"]),!U.required&&!F.required?(l(),v(s(S),{key:2,onClick:q=>qe(d),disabled:s(i).isServicePending(d),variant:"ghost",size:"icon-sm",class:"text-zinc-400 hover:text-red-400",title:"Remove Service"},{default:h(()=>[s(i).isServicePending(d)?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(lt),{key:1,class:"w-4 h-4"}))]),_:2},1032,["onClick","disabled"])):z("",!0)])]),s(i).getServiceError(d)?(l(),u("div",ss,[a("div",as,[a("span",null,"Error: "+y(s(i).getServiceError(d)),1),a("button",{onClick:q=>s(i).clearServiceError(d),class:"text-red-400 hover:text-white"},[c(s(nt),{class:"w-3 h-3"})],8,ls)])])):z("",!0)]))),128))])])):z("",!0)],64))),64))])),c(wt,{show:p.value,"get-api-url":g,"csrf-token":s(W),onClose:e[1]||(e[1]=o=>p.value=!1),onServiceEnabled:e[2]||(e[2]=()=>N())},null,8,["show","csrf-token"]),c(Ht,{show:f.value,"service-name":ae.value,"environment-id":j.environment.id,"get-api-url":g,"csrf-token":s(W),onClose:e[3]||(e[3]=o=>f.value=!1),onConfigUpdated:e[4]||(e[4]=()=>N())},null,8,["show","service-name","environment-id","csrf-token"]),c(se,{show:le.value,title:`${oe[H.value]?.name||H.value} Logs`,maxWidth:"max-w-4xl",onClose:De},{default:h(()=>[a("div",ns,[a("div",is,[c(s(S),{onClick:ue,disabled:K.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:h(()=>[K.value?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):(l(),v(s(de),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),a("button",{onClick:We,class:Q(["text-xs px-2 py-1 rounded-full",J.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},y(J.value?"Auto-refresh ON":"Auto-refresh"),3)]),a("div",os,[a("pre",rs,y(G.value),1)])])]),_:1},8,["show","title"]),c(se,{show:X.value,title:`PHP ${ie.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=o=>X.value=!1)},{default:h(()=>[a("div",cs,[ne.value?(l(),u("div",us,[c(s($),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[22]||(e[22]=a("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(l(),u("form",{key:1,onSubmit:_e(Le,["prevent"]),class:"space-y-6"},[a("div",null,[e[27]||(e[27]=a("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),a("div",ds,[a("div",null,[e[23]||(e[23]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),c(s(T),{modelValue:x.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=o=>x.value.upload_max_filesize=o),class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),c(s(T),{modelValue:x.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=o=>x.value.post_max_size=o),class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[25]||(e[25]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),c(s(T),{modelValue:x.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=o=>x.value.memory_limit=o),class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[26]||(e[26]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),c(s(T),{modelValue:x.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=o=>x.value.max_execution_time=o),class:"w-full font-mono"},null,8,["modelValue"])])])]),a("div",null,[e[32]||(e[32]=a("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),a("div",vs,[a("div",null,[e[28]||(e[28]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),c(s(T),{modelValue:x.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=o=>x.value.max_children=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[29]||(e[29]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),c(s(T),{modelValue:x.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=o=>x.value.start_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[30]||(e[30]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),c(s(T),{modelValue:x.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=o=>x.value.min_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),a("div",null,[e[31]||(e[31]=a("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),c(s(T),{modelValue:x.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=o=>x.value.max_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),a("div",ps,[c(s(S),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=o=>X.value=!1)},{default:h(()=>[...e[33]||(e[33]=[_(" Cancel ",-1)])]),_:1}),c(s(S),{type:"submit",variant:"secondary",disabled:Z.value},{default:h(()=>[Z.value?(l(),v(s($),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),_(" "+y(Z.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{Cs as default};
