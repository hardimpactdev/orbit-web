import{d as j,y as B,c as f,g as a,a as d,u as s,h as V,e as c,f as p,w as o,l as C,b as n,o as r,F as _,i as F,t as u,r as D,S as U,q}from"./app-tToT6ueT.js";import{_ as P}from"./Heading.vue_vue_type_script_setup_true_lang-DQGJ3FkC.js";import{I as x,a as G,q as L,b as g,j as H,A as h,D as M,G as W,U as I}from"./craft-ui-CwAcXYkJ.js";import{L as J}from"./loader-circle-B_at1Az3.js";import{C as X}from"./circle-alert-CUbzWhZQ.js";import{E as K}from"./eye-BranpEfh.js";import{P as O}from"./pencil-3wL4culP.js";import{T as Q}from"./trash-2-RvpwNsBo.js";const R={class:"flex justify-between items-center mb-8"},Z={class:"flex items-center"},tt={class:"font-medium text-foreground"},et={key:0,class:"inline-flex items-center text-sm text-blue-400"},st={key:1,class:"inline-flex items-center text-sm text-red-400"},at={key:2,class:"inline-flex items-center text-sm text-lime-400"},ot={class:"flex items-center justify-end gap-1"},mt=j({__name:"Index",props:{environments:{},hasLocalEnvironment:{type:Boolean}},setup(v){const T=v,m=D(new Map),E=D(new Set),A=async l=>{try{const e=await(await fetch(`/environments/${l}/config`)).json();if(e.success&&e.data){const i=e.data.tld||"test";m.value.set(l,i),N()}}catch(t){console.error(`Failed to load TLD for environment ${l}:`,t)}},N=()=>{const l=new Map;m.value.forEach(e=>{l.set(e,(l.get(e)||0)+1)});const t=new Set;l.forEach((e,i)=>{e>1&&t.add(i)}),E.value=t},y=l=>m.value.get(l),b=l=>{const t=m.value.get(l);return t?E.value.has(t):!1},S=l=>{const t=m.value.get(l);if(!t)return 0;let e=0;return m.value.forEach(i=>{i===t&&e++}),e},z=l=>{confirm("Are you sure you want to delete this environment?")&&q.delete(`/environments/${l.id}`)},Y=l=>{if(!l)return"Never";const t=new Date(l),i=new Date().getTime()-t.getTime(),w=Math.floor(i/6e4),k=Math.floor(i/36e5),$=Math.floor(i/864e5);return w<1?"Just now":w<60?`${w} minute${w!==1?"s":""} ago`:k<24?`${k} hour${k!==1?"s":""} ago`:$<30?`${$} day${$!==1?"s":""} ago`:t.toLocaleDateString()};return B(()=>{T.environments.forEach(l=>A(l.id))}),(l,t)=>(r(),f(_,null,[a(s(V),{title:"Environments"}),d("div",null,[d("div",R,[a(P,{title:"Environments"}),l.$page.props.multi_environment?(r(),c(s(x),{key:0,"as-child":""},{default:o(()=>[a(s(C),{href:"/environments/create"},{default:o(()=>[...t[0]||(t[0]=[n(" Add environment ",-1)])]),_:1})]),_:1})):p("",!0)]),a(s(I),null,{default:o(()=>[a(s(G),null,{default:o(()=>[a(s(L),null,{default:o(()=>[a(s(g),null,{default:o(()=>[...t[1]||(t[1]=[n("Name",-1)])]),_:1}),a(s(g),null,{default:o(()=>[...t[2]||(t[2]=[n("Host",-1)])]),_:1}),a(s(g),null,{default:o(()=>[...t[3]||(t[3]=[n("Status",-1)])]),_:1}),a(s(g),null,{default:o(()=>[...t[4]||(t[4]=[n("Last connected",-1)])]),_:1}),a(s(g),{class:"text-right"},{default:o(()=>[...t[5]||(t[5]=[n("Actions",-1)])]),_:1})]),_:1})]),_:1}),a(s(H),null,{default:o(()=>[(r(!0),f(_,null,F(v.environments,e=>(r(),c(s(L),{key:e.id},{default:o(()=>[a(s(h),{class:"whitespace-nowrap"},{default:o(()=>[d("div",Z,[d("span",tt,u(e.name),1),y(e.id)?(r(),c(s(M),{key:0,class:"ml-2 font-mono",variant:b(e.id)?"destructive":"secondary",title:b(e.id)?`Warning: ${S(e.id)} environments use .${y(e.id)} - this may cause DNS conflicts`:""},{default:o(()=>[n(" ."+u(y(e.id)),1)]),_:2},1032,["variant","title"])):p("",!0),e.is_local?(r(),c(s(M),{key:1,class:"ml-2 bg-lime-400/10 text-lime-300 border-lime-400/20"},{default:o(()=>[...t[6]||(t[6]=[n(" Local ",-1)])]),_:1})):p("",!0)])]),_:2},1024),a(s(h),{class:"whitespace-nowrap text-muted-foreground"},{default:o(()=>[e.is_local?(r(),f(_,{key:0},[n("localhost")],64)):(r(),f(_,{key:1},[n(u(e.user)+"@"+u(e.host)+":"+u(e.port),1)],64))]),_:2},1024),a(s(h),{class:"whitespace-nowrap"},{default:o(()=>[e.status==="provisioning"?(r(),f("span",et,[a(s(J),{class:"w-3.5 h-3.5 mr-2 animate-spin"}),n(" Provisioning ("+u(e.provisioning_step??0)+"/"+u(e.provisioning_total_steps??14)+") ",1)])):e.status==="error"?(r(),f("span",st,[a(s(X),{class:"w-3.5 h-3.5 mr-2"}),t[7]||(t[7]=n(" Error ",-1))])):(r(),f("span",at,[...t[8]||(t[8]=[d("span",{class:"w-2 h-2 rounded-full bg-lime-400 mr-2"},null,-1),n(" Active ",-1)])]))]),_:2},1024),a(s(h),{class:"whitespace-nowrap text-muted-foreground"},{default:o(()=>[n(u(Y(e.last_connected_at)),1)]),_:2},1024),a(s(h),{class:"whitespace-nowrap text-right"},{default:o(()=>[d("div",ot,[a(s(x),{"as-child":"",variant:"ghost",size:"icon-sm"},{default:o(()=>[a(s(C),{href:`/environments/${e.id}`,title:"View"},{default:o(()=>[a(s(K),{class:"w-4 h-4"})]),_:1},8,["href"])]),_:2},1024),l.$page.props.multi_environment?(r(),c(s(x),{key:0,"as-child":"",variant:"ghost",size:"icon-sm"},{default:o(()=>[a(s(C),{href:`/environments/${e.id}/edit`,title:"Edit"},{default:o(()=>[a(s(O),{class:"w-4 h-4"})]),_:1},8,["href"])]),_:2},1024)):p("",!0),l.$page.props.multi_environment?(r(),c(s(x),{key:1,onClick:i=>z(e),variant:"ghost",size:"icon-sm",class:"text-muted-foreground hover:text-red-400",title:"Delete"},{default:o(()=>[a(s(Q),{class:"w-4 h-4"})]),_:1},8,["onClick"])):p("",!0)])]),_:2},1024)]),_:2},1024))),128)),v.environments.length===0?(r(),c(s(W),{key:0,colspan:5},{default:o(()=>[a(s(U),{class:"w-12 h-12 mx-auto text-zinc-600 mb-4"}),t[9]||(t[9]=d("p",{class:"text-zinc-400 mb-2"},"No environments configured yet",-1)),t[10]||(t[10]=d("p",{class:"text-sm text-zinc-500"}," Add a local or external environment to get started ",-1))]),_:1})):p("",!0)]),_:1})]),_:1})])],64))}});export{mt as default};
