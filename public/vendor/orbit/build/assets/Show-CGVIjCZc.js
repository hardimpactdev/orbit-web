import{j as Q,d as ze,z as Ce,r as m,q as Pe,D as $e,c as d,g as n,a as s,u as t,h as Se,f as g,e as k,t as c,w as o,b as r,s as Ve,F as v,n as F,I as Le,o as i,i as Y,l as Ue,P as Ae,T as Ie,E as He,U as M,M as z}from"./app-D9UrdW7P.js";import{u as Te}from"./services-CtZuGzJ-.js";import{a as w}from"./axios-C-GjRQfx.js";import{D as ae,I as h,Y as le,c as oe,d as ie,k as re,B,$ as de,a as Ye,q as N,b as O,j as De,A as b,G as je,U as Ee}from"./craft-ui-D2B3OI3e.js";import{T as Re}from"./triangle-alert-BWoBglZ7.js";import{L as Z}from"./loader-circle-9LaEdU33.js";import{R as Fe}from"./refresh-cw-eSdnRuMR.js";import{C as Me}from"./code-DHPZAd3M.js";import{Z as Be}from"./zap-CE_9bihA.js";import{X as Ne}from"./x-BFhOWayW.js";import{T as Oe}from"./trash-2-Bgrxf0ei.js";const We=Q("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const qe=Q("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const Ge=Q("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Xe={class:"flex justify-between items-start mb-8"},Ze={class:"flex items-center gap-3"},Qe={class:"text-2xl font-bold text-foreground"},Je={class:"text-muted-foreground mt-1"},Ke={class:"border border-zinc-800 rounded-lg mb-6"},et={class:"p-5"},tt={class:"flex items-center"},st={class:"text-zinc-300 text-sm"},nt={class:"border border-zinc-800 rounded-lg mb-6"},at={class:"p-5"},lt={class:"flex items-center text-lime-400"},ot={class:"text-zinc-500 mt-1 text-sm"},it={class:"flex items-center text-yellow-400 mb-3"},rt={key:1,class:"text-zinc-500 text-sm"},dt={class:"border border-zinc-800 rounded-xl px-0.5 pt-4 pb-0.5 mb-6"},ct={class:"flex justify-between items-center mb-4 px-4"},ut={key:0,class:"border border-zinc-700/50 rounded-lg overflow-hidden space-y-px"},mt={key:0,class:"p-5 text-zinc-500 text-sm bg-zinc-800/30"},vt={class:"p-5 bg-zinc-800/30"},ft={class:"mt-1 text-sm text-zinc-300 font-mono"},xt={key:0,class:"text-zinc-500"},pt={class:"p-5 bg-zinc-800/30 flex space-x-8"},ht={class:"ml-2 text-sm text-zinc-300 font-mono"},gt={class:"ml-2 text-sm text-zinc-300 font-mono"},kt={key:1,class:"space-y-4 px-4 pb-4"},yt={class:"space-y-2"},wt=["onClick"],bt={class:"mt-1 text-xs text-zinc-500"},_t={class:"flex gap-3 pt-2"},zt={class:"border border-zinc-800 rounded-xl px-0.5 pt-4 pb-0.5 mb-6"},Ct={class:"flex justify-between items-center mb-4 px-4"},Pt={class:"text-sm text-zinc-500"},$t={class:"border border-zinc-700/50 rounded-lg overflow-hidden space-y-px"},St={key:0,class:"p-5 text-center text-zinc-500 bg-zinc-800/30"},Vt={class:"flex items-center"},Lt={class:"font-medium text-white text-sm"},Ut={class:"text-xs text-zinc-500"},At={class:"font-mono"},It={key:0,class:"p-5 text-zinc-500 text-sm bg-zinc-800/30"},Ht={class:"border border-zinc-800 rounded-xl px-0.5 pt-4 pb-0.5 mb-6"},Tt={class:"flex justify-between items-center mb-4 px-4"},Yt={class:"flex items-center gap-2"},Dt=["onClick"],jt={key:1,class:"w-4 flex-shrink-0"},Et={class:"font-medium text-white"},Rt={class:"flex items-center gap-1"},Ft=["onClick"],Mt={class:"flex items-center justify-end gap-2"},Bt={class:"flex items-center"},Nt={class:"font-medium text-zinc-300"},Ot={class:"flex items-center justify-end gap-2"},ns=ze({__name:"Show",props:{environment:{},installation:{},editor:{},remoteApiUrl:{}},setup(f){const p=f,_=a=>p.remoteApiUrl?`${p.remoteApiUrl}${a}`:`/api/environments/${p.environment.id}${a}`,C=m(null),P=m("idle"),D=m("Connection not tested"),$=Te(),V=m(!0),j=m(!1),W=m([]),q=m(!0),S=m({}),L=m(new Set),x=m(null),G=m(!0),U=m(!1),E=m(!1),y=m([]),A=m(""),R=m("8.4"),I=m(!1),ce=Ve(()=>x.value?.tld||"test"),X={dns:"53","php-83":"-","php-84":"-",caddy:"80, 443",postgres:"5432",redis:"6379",mailpit:"1025, 8025"},ue={dns:"DNS Server","php-83":"PHP 8.3 (FrankenPHP)","php-84":"PHP 8.4 (FrankenPHP)",caddy:"Web Server",postgres:"PostgreSQL Database",redis:"Redis Cache",mailpit:"Mail Catcher"};async function J(){P.value="testing",D.value="Testing connection...";try{const{data:a}=await w.post(`/api/environments/${p.environment.id}/test-connection`,{},{signal:C.value?.signal});P.value=a.success?"success":"error",D.value=a.message}catch(a){if(M.isCancel(a))return;P.value="error",D.value="Connection failed"}}async function K(){V.value=!0;try{await $.fetchServices(_(""))}catch(a){console.error("Failed to load services status:",a)}finally{V.value=!1}}async function H(){q.value=!0;try{const{data:a}=await w.get(_("/sites"),{signal:C.value?.signal});a.success&&a.data&&(W.value=a.data.sites||[])}catch(a){if(M.isCancel(a))return}finally{q.value=!1}}async function ee(){try{const{data:a}=await w.get(_("/worktrees"),{signal:C.value?.signal});if(a.success&&a.data?.worktrees){const e={};for(const l of a.data.worktrees)e[l.site]||(e[l.site]=[]),e[l.site].push(l);S.value=e}}catch(a){if(M.isCancel(a))return}}async function me(){G.value=!0;try{const{data:a}=await w.get(_("/config"),{signal:C.value?.signal});a.success&&(x.value=a.data)}catch(a){if(M.isCancel(a))return}finally{G.value=!1}}async function ve(){j.value=!0;try{const a=await $.restartAll(_(""));a.success?(z.success("Services restarted successfully"),await K()):z.error("Failed to restart services",{description:a.error||"Unknown error"})}catch{z.error("Failed to restart services")}finally{j.value=!1}}async function fe(a,e){try{const{data:l}=await w.post(_(`/php/${a}`),{version:e});l.success&&await H()}catch{}}async function xe(a){try{const{data:e}=await w.post(_(`/php/${a}/reset`),{});e.success&&await H()}catch{}}function te(a,e){const l=`${e?"https":"http"}://${a}`;window.open(l,"_blank")}function se(a){if(!a){z.error("No path available for this site");return}let e;if(p.environment.is_local)e=`${p.editor.scheme}://file${a}`;else{const l=`${p.environment.user}@${p.environment.host}`;e=`${p.editor.scheme}://vscode-remote/ssh-remote+${l}${a}?windowId=_blank`}window.open(e,"_blank")}async function pe(a,e){if(confirm(`Remove worktree "${e}" from ${a}? This will remove the subdomain routing.`))try{const{data:l}=await w.delete(_(`/worktrees/${a}/${e}`));l.success&&(await ee(),await H())}catch{}}async function he(){I.value=!0;try{const{data:a}=await w.post("/cli/install",{});a.success?window.location.reload():z.error("Failed to install CLI",{description:a.error||"Unknown error"})}catch{}finally{I.value=!1}}function ge(a){L.value.has(a)?L.value.delete(a):L.value.add(a)}function ke(){x.value&&(y.value=[...x.value.paths||[]],y.value.length===0&&y.value.push(""),A.value=x.value.tld||"test",R.value=x.value.default_php_version||"8.4"),U.value=!0}function ye(){U.value=!1}function we(){y.value.push("")}function be(a){y.value.splice(a,1)}async function _e(){const a=y.value.filter(e=>e.trim()!=="");if(a.length===0){z.error("Validation Error",{description:"Please add at least one site path"});return}E.value=!0;try{const{data:e}=await w.post(`/environments/${p.environment.id}/config`,{paths:a,tld:A.value.trim()||"test",default_php_version:R.value});e.success?(x.value=e.data,U.value=!1,z.success("Configuration saved"),await H()):z.error("Failed to save config",{description:e.error||"Unknown error"})}catch{}finally{E.value=!1}}let ne=null;return Ce(()=>{C.value=new AbortController,ne=Pe.on("before",()=>{C.value?.abort()}),$.setActiveEnvironment(p.environment.id),J(),p.installation.installed&&(me(),K(),H(),ee())}),$e(()=>{ne?.(),C.value?.abort()}),(a,e)=>(i(),d(v,null,[n(t(Se),{title:f.environment.name},null,8,["title"]),s("div",null,[s("div",Xe,[s("div",null,[s("div",Ze,[s("h2",Qe,c(f.environment.name),1),x.value?(i(),k(t(ae),{key:0,variant:"secondary",class:"font-mono"},{default:o(()=>[r("."+c(ce.value),1)]),_:1})):g("",!0)]),s("p",Je,[f.environment.is_local?(i(),d(v,{key:0},[r("Local machine")],64)):(i(),d(v,{key:1},[r(c(f.environment.user)+"@"+c(f.environment.host)+":"+c(f.environment.port),1)],64))])]),n(t(h),{onClick:J,variant:"secondary"},{default:o(()=>[...e[2]||(e[2]=[r("Test Connection",-1)])]),_:1})]),s("div",Ke,[s("div",et,[s("div",tt,[s("span",{class:F(["w-2.5 h-2.5 rounded-full mr-3",{"bg-zinc-600":P.value==="idle","bg-yellow-400 animate-pulse":P.value==="testing","bg-lime-400":P.value==="success","bg-red-400":P.value==="error"}])},null,2),s("span",st,c(D.value),1)])])]),s("div",nt,[s("div",at,[e[4]||(e[4]=s("h3",{class:"text-sm font-medium text-white mb-4"},"Orbit Installation",-1)),f.installation.installed?(i(),d(v,{key:0},[s("div",lt,[n(t(Le),{class:"w-4 h-4 mr-2"}),r(" Installed at "+c(f.installation.path),1)]),s("p",ot,"Version: "+c(f.installation.version),1)],64)):(i(),d(v,{key:1},[s("div",it,[n(t(Re),{class:"w-4 h-4 mr-2"}),e[3]||(e[3]=r(" Orbit CLI not found ",-1))]),f.environment.is_local?(i(),k(t(h),{key:0,onClick:he,disabled:I.value,variant:"secondary"},{default:o(()=>[I.value?(i(),k(t(Z),{key:0,class:"w-4 h-4 animate-spin"})):(i(),k(t(We),{key:1,class:"w-4 h-4"})),r(" "+c(I.value?"Installing...":"Install Orbit CLI"),1)]),_:1},8,["disabled"])):(i(),d("p",rt," Install orbit on this environment to manage sites. "))],64))])]),f.installation.installed?(i(),d(v,{key:0},[s("div",dt,[s("div",ct,[e[5]||(e[5]=s("h3",{class:"text-sm font-medium text-white"},"Configuration",-1)),U.value?g("",!0):(i(),d("button",{key:0,onClick:ke,class:"text-sm text-zinc-400 hover:text-white transition-colors"}," Edit "))]),U.value?(i(),d("div",kt,[s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-zinc-400 mb-2"},"Site Paths",-1)),s("div",yt,[(i(!0),d(v,null,Y(y.value,(l,u)=>(i(),d("div",{key:u,class:"flex items-center space-x-2"},[n(t(le),{modelValue:y.value[u],"onUpdate:modelValue":T=>y.value[u]=T,type:"text",placeholder:"/home/user/sites",class:"flex-1 font-mono"},null,8,["modelValue","onUpdate:modelValue"]),s("button",{onClick:T=>be(u),class:"text-zinc-500 hover:text-red-400 p-2 transition-colors"},[n(t(Oe),{class:"w-4 h-4"})],8,wt)]))),128))]),s("button",{onClick:we,class:"mt-2 text-sm text-zinc-400 hover:text-white transition-colors"}," + Add path ")]),s("div",null,[e[10]||(e[10]=s("label",{for:"config-tld",class:"block text-sm font-medium text-zinc-400 mb-1"},"TLD",-1)),n(t(le),{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=l=>A.value=l),type:"text",id:"config-tld",placeholder:"test",class:"w-full max-w-xs font-mono"},null,8,["modelValue"]),s("p",bt," Sites will be accessible at sitename."+c(A.value||"test"),1)]),s("div",null,[e[13]||(e[13]=s("label",{for:"config-php",class:"block text-sm font-medium text-zinc-400 mb-1"},"Default PHP Version",-1)),n(t(de),{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=l=>R.value=l)},{default:o(()=>[n(t(oe),{class:"w-full max-w-xs"},{default:o(()=>[n(t(ie),{placeholder:"Select PHP version"})]),_:1}),n(t(re),null,{default:o(()=>[n(t(B),{value:"8.3"},{default:o(()=>[...e[11]||(e[11]=[r("PHP 8.3",-1)])]),_:1}),n(t(B),{value:"8.4"},{default:o(()=>[...e[12]||(e[12]=[r("PHP 8.4",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",_t,[n(t(h),{onClick:_e,disabled:E.value,variant:"secondary"},{default:o(()=>[r(c(E.value?"Saving...":"Save changes"),1)]),_:1},8,["disabled"]),n(t(h),{onClick:ye,variant:"ghost"},{default:o(()=>[...e[14]||(e[14]=[r("Cancel",-1)])]),_:1})])])):(i(),d("div",ut,[G.value?(i(),d("div",mt," Loading configuration... ")):x.value?(i(),d(v,{key:1},[s("div",vt,[e[6]||(e[6]=s("span",{class:"text-sm font-medium text-zinc-400"},"Site Paths:",-1)),s("div",ft,[(i(!0),d(v,null,Y(x.value.paths,l=>(i(),d("div",{key:l},c(l),1))),128)),x.value.paths?.length?g("",!0):(i(),d("div",xt," No paths configured "))])]),s("div",pt,[s("div",null,[e[7]||(e[7]=s("span",{class:"text-sm font-medium text-zinc-400"},"TLD:",-1)),s("span",ht,c(x.value.tld||"test"),1)]),s("div",null,[e[8]||(e[8]=s("span",{class:"text-sm font-medium text-zinc-400"},"Default PHP:",-1)),s("span",gt,c(x.value.default_php_version||"8.4"),1)])])],64)):g("",!0)]))]),s("div",zt,[s("div",Ct,[s("div",null,[e[15]||(e[15]=s("h3",{class:"text-sm font-medium text-white"},"Services",-1)),s("p",Pt,[V.value?(i(),d(v,{key:0},[r("Loading...")],64)):(i(),d(v,{key:1},[r(c(t($).servicesRunning)+"/"+c(t($).servicesTotal)+" running",1)],64))])]),n(t(h),{onClick:ve,disabled:V.value||j.value,variant:"outline",size:"sm"},{default:o(()=>[r(c(j.value?"Restarting...":"Restart All"),1)]),_:1},8,["disabled"])]),s("div",$t,[V.value?(i(),d("div",St,[n(t(Z),{class:"h-5 w-5 mx-auto mb-2 text-zinc-600 animate-spin"}),e[16]||(e[16]=r(" Loading services... ",-1))])):(i(),d(v,{key:1},[(i(!0),d(v,null,Y(t($).services,(l,u)=>(i(),d("div",{key:u,class:"p-5 flex items-center justify-between bg-zinc-800/30"},[s("div",Vt,[s("span",{class:F(["w-2 h-2 rounded-full mr-3",l.status==="running"?"bg-lime-400":"bg-red-400"])},null,2),s("div",null,[s("div",Lt,c(ue[u]||u),1),s("div",Ut,[r(c(u)+" ",1),X[u]&&X[u]!=="-"?(i(),d(v,{key:0},[e[17]||(e[17]=s("span",{class:"text-zinc-600"}," Â· ",-1)),s("span",At,c(X[u]),1)],64)):g("",!0)])])]),s("span",{class:F(["text-xs capitalize",l.status==="running"?"text-lime-400":"text-red-400"])},c(l.status||"unknown"),3)]))),128)),t($).servicesTotal===0?(i(),d("div",It," No services found ")):g("",!0)],64))])]),s("div",Ht,[s("div",Tt,[e[19]||(e[19]=s("h3",{class:"text-sm font-medium text-white"},"Sites",-1)),n(t(h),{"as-child":"",variant:"secondary",size:"sm"},{default:o(()=>[n(t(Ue),{href:`/environments/${f.environment.id}/sites/create`},{default:o(()=>[n(t(Ae),{class:"w-3.5 h-3.5"}),e[18]||(e[18]=r(" New Site ",-1))]),_:1},8,["href"])]),_:1})]),n(t(Ee),null,{default:o(()=>[n(t(Ye),null,{default:o(()=>[n(t(N),null,{default:o(()=>[n(t(O),{class:"w-64"},{default:o(()=>[...e[20]||(e[20]=[r("Site",-1)])]),_:1}),n(t(O),{class:"w-32"},{default:o(()=>[...e[21]||(e[21]=[r("PHP",-1)])]),_:1}),n(t(O),null,{default:o(()=>[...e[22]||(e[22]=[r("Path",-1)])]),_:1}),n(t(O),{class:"text-right w-48"},{default:o(()=>[...e[23]||(e[23]=[r("Actions",-1)])]),_:1})]),_:1})]),_:1}),n(t(De),null,{default:o(()=>[q.value?(i(),k(t(N),{key:0},{default:o(()=>[n(t(b),{colspan:"4",class:"text-center py-8 text-muted-foreground"},{default:o(()=>[n(t(Z),{class:"h-5 w-5 mx-auto mb-2 text-zinc-600 animate-spin"}),e[24]||(e[24]=r(" Loading sites... ",-1))]),_:1})]),_:1})):W.value.length===0?(i(),k(t(je),{key:1,colspan:4},{default:o(()=>[...e[25]||(e[25]=[r(" No sites configured. ",-1)])]),_:1})):(i(!0),d(v,{key:2},Y(W.value,l=>(i(),d(v,{key:l.name},[n(t(N),null,{default:o(()=>[n(t(b),{class:"w-64"},{default:o(()=>[s("div",Yt,[S.value[l.name]?.length?(i(),d("button",{key:0,onClick:u=>ge(l.name),class:"text-zinc-500 hover:text-white transition-colors flex-shrink-0"},[n(t(Ie),{class:F(["w-4 h-4 transform transition-transform",{"rotate-90":L.value.has(l.name)}])},null,8,["class"])],8,Dt)):(i(),d("span",jt)),l.secure?(i(),k(t(Ge),{key:2,class:"w-4 h-4 text-lime-400 flex-shrink-0"})):(i(),k(t(qe),{key:3,class:"w-4 h-4 text-zinc-600 flex-shrink-0"})),s("span",Et,c(l.domain),1),S.value[l.name]?.length?(i(),k(t(ae),{key:4,variant:"secondary",class:"flex-shrink-0"},{default:o(()=>[r(c(S.value[l.name].length),1)]),_:2},1024)):g("",!0)])]),_:2},1024),n(t(b),{class:"w-32"},{default:o(()=>[s("div",Rt,[n(t(de),{"model-value":l.php_version||"8.4","onUpdate:modelValue":u=>fe(l.name,String(u))},{default:o(()=>[n(t(oe),{class:"h-7 text-xs px-2",size:"sm"},{default:o(()=>[n(t(ie))]),_:1}),n(t(re),null,{default:o(()=>[n(t(B),{value:"8.3"},{default:o(()=>[...e[26]||(e[26]=[r("PHP 8.3",-1)])]),_:1}),n(t(B),{value:"8.4"},{default:o(()=>[...e[27]||(e[27]=[r("PHP 8.4",-1)])]),_:1})]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),l.has_custom_php?(i(),d("button",{key:0,onClick:u=>xe(l.name),class:"text-zinc-500 hover:text-red-400 transition-colors",title:"Reset to default"},[n(t(Fe),{class:"w-3.5 h-3.5"})],8,Ft)):g("",!0)])]),_:2},1024),n(t(b),{class:"text-muted-foreground text-sm font-mono"},{default:o(()=>[r(c(l.path),1)]),_:2},1024),n(t(b),{class:"text-right"},{default:o(()=>[s("div",Mt,[n(t(h),{onClick:u=>te(l.domain,l.secure??!1),variant:"secondary",size:"sm"},{default:o(()=>[n(t(He),{class:"w-3.5 h-3.5"}),e[28]||(e[28]=r(" Open ",-1))]),_:1},8,["onClick"]),n(t(h),{onClick:u=>se(l.path||""),variant:"outline",size:"sm"},{default:o(()=>[n(t(Me),{class:"w-3.5 h-3.5"}),r(" "+c(f.editor.name),1)]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024),L.value.has(l.name)&&S.value[l.name]?.length?(i(!0),d(v,{key:0},Y(S.value[l.name],u=>(i(),k(t(N),{key:`${l.name}-${u.name}`},{default:o(()=>[n(t(b),{class:"pl-12"},{default:o(()=>[s("div",Bt,[n(t(Be),{class:"w-4 h-4 mr-2 text-blue-400"}),s("span",Nt,c(u.domain),1)])]),_:2},1024),n(t(b),{class:"text-muted-foreground text-xs font-mono"},{default:o(()=>[r(c(u.branch||"-"),1)]),_:2},1024),n(t(b),{class:"text-muted-foreground text-xs truncate max-w-xs font-mono",title:u.path},{default:o(()=>[r(c(u.path),1)]),_:2},1032,["title"]),n(t(b),{class:"text-right"},{default:o(()=>[s("div",Ot,[n(t(h),{onClick:T=>te(u.domain,u.secure??!0),variant:"ghost",size:"sm"},{default:o(()=>[...e[29]||(e[29]=[r(" Open ",-1)])]),_:1},8,["onClick"]),n(t(h),{onClick:T=>se(u.path),variant:"ghost",size:"sm"},{default:o(()=>[r(c(f.editor.name),1)]),_:1},8,["onClick"]),n(t(h),{onClick:T=>pe(l.name,u.name),variant:"ghost",size:"icon-sm",class:"text-zinc-500 hover:text-red-400",title:"Unlink worktree"},{default:o(()=>[n(t(Ne),{class:"w-4 h-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)):g("",!0)],64))),128))]),_:1})]),_:1})])],64)):g("",!0)])],64))}});export{ns as default};
