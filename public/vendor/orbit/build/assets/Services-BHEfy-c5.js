import{I as j,d as he,y as be,e as f,w as m,a as n,c as r,r as p,o as l,g as i,u as s,S as fe,F as C,i as J,f as _,s as L,t as w,J as ze,b as $,P as Se,k as _e,p as $e,m as xe,v as Qe,K as Je,L as Ye,M as y,N as Ge,B as Xe,h as Ze,n as se,O as Ke,Q as ye}from"./app-D43GO3N8.js";import{u as Ce}from"./services-Dy8OEhPs.js";import{_ as le}from"./Modal.vue_vue_type_script_setup_true_lang-BEdX_4uh.js";import{I as P,H as et,Y as N,_ as tt,c as st,k as ve,M as nt,y as lt}from"./craft-ui-aQagzPT3.js";import{L as V}from"./loader-circle-BVZ-cAKz.js";import{G as Pe}from"./globe-Bp34UGZ0.js";import{_ as at}from"./DnsSettings.vue_vue_type_script_setup_true_lang-DHt0DWE3.js";import{C as it}from"./circle-alert-C5cD6nuC.js";import{E as ot}from"./eye-C6i0wwix.js";import{R as pe}from"./refresh-cw-vEUiR2_Z.js";import{T as we}from"./trash-2-DAy_P5tK.js";import{X as rt}from"./x-CcrxcTcI.js";const ge=j("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const ne=j("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const ct=j("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ut=j("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const me=j("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Me=j("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const dt=j("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const vt=j("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ke=j("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const pt=j("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),mt={class:"p-6"},ft={key:0,class:"py-12 text-center"},gt={key:1,class:"py-12 text-center"},ht={key:2,class:"space-y-8"},bt={key:0},xt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},yt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},wt={class:"flex items-start justify-between mb-2"},kt={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},zt={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},St={class:"text-white font-medium mb-1"},_t={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},$t=he({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(F,{emit:H}){const u=F,q=H,I=Ce(),A=p(!0),M=p([]),h=p(null),k=L(()=>u.getApiUrl("")),D=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],O=L(()=>{const c={core:[],php:[],database:[],utility:[]};return M.value.forEach(o=>{c[o.category]?c[o.category].push(o):c.utility.push(o)}),c}),U=async()=>{A.value=!0;try{const o=await(await fetch(u.getApiUrl("/services/available"))).json();o.success&&(M.value=o.data||[])}catch(c){console.error("Failed to fetch available services:",c)}finally{A.value=!1}},Y=async c=>{h.value=c;try{const o=await I.enableService(c,k.value);o?.success?(q("serviceEnabled",c),q("close")):alert("Failed to enable service: "+(o?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{h.value=null}},z=c=>{switch(c){case"core":return Pe;case"database":return ne;case"php":return ge;case"utility":return Me;default:return fe}};return be(()=>{u.show&&U()}),(c,o)=>(l(),f(le,{show:F.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:o[0]||(o[0]=v=>c.$emit("close"))},{default:m(()=>[n("div",mt,[A.value?(l(),r("div",ft,[i(s(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),o[1]||(o[1]=n("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):M.value.length===0?(l(),r("div",gt,[i(s(fe),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),o[2]||(o[2]=n("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(l(),r("div",ht,[(l(),r(C,null,J(D,v=>(l(),r(C,{key:v.key},[O.value[v.key].length>0?(l(),r("div",bt,[n("h4",xt,w(v.label),1),n("div",yt,[(l(!0),r(C,null,J(O.value[v.key],g=>(l(),r("div",{key:g.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[n("div",null,[n("div",wt,[n("div",kt,[(l(),f(ze(z(g.category)),{class:"w-5 h-5"}))]),g.required?(l(),r("span",zt," Required ")):_("",!0)]),n("h5",St,w(g.label),1),n("p",_t,w(g.description),1)]),i(s(P),{onClick:ae=>Y(g.name),disabled:h.value!==null,variant:"secondary",class:"w-full justify-center"},{default:m(()=>[h.value===g.name?(l(),r(C,{key:0},[i(s(V),{class:"w-4 h-4 animate-spin mr-2"}),o[3]||(o[3]=$(" Enabling... ",-1))],64)):(l(),r(C,{key:1},[i(s(Se),{class:"w-4 h-4 mr-2"}),o[4]||(o[4]=$(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):_("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),Ct={class:"p-6"},Pt={key:0,class:"py-12 text-center"},Mt={key:1,class:"py-12 text-center"},Vt={key:2},At=["for"],Ut={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Lt={key:0,class:"relative"},Ft=["id","onUpdate:modelValue"],jt=["value"],Et={key:1,class:"flex items-center"},Rt={class:"ml-3 text-sm text-zinc-400"},Ht={key:2,class:"relative"},Tt=["id","type","onUpdate:modelValue","placeholder"],Nt=["onClick"],qt={key:3,class:"text-xs text-zinc-500"},It={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},Dt=he({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(F,{emit:H}){const u=F,q=H,I=p(!0),A=p(!1),M=p(null),h=p({}),k=p({}),D=L(()=>u.serviceName==="dns"),O=async()=>{if(u.serviceName){I.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/info`))).json();if(c.success&&c.data){M.value=c.data,h.value={...c.data.config};const o={};Object.entries(c.data.configSchema).forEach(([v,g])=>{g.secret&&(o[v]=!1)}),k.value=o}}catch(z){console.error("Failed to fetch service info:",z)}finally{I.value=!1}}},U=async()=>{if(u.serviceName){A.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":u.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:h.value})})).json();c.success?(q("configUpdated",u.serviceName),q("close")):alert("Failed to update configuration: "+(c.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{A.value=!1}}},Y=z=>{k.value[z]=!k.value[z]};return _e(()=>u.show,z=>{z&&u.serviceName?O():(M.value=null,h.value={})}),be(()=>{u.show&&u.serviceName&&O()}),(z,c)=>(l(),f(le,{show:F.show,title:M.value?`Configure ${M.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:c[1]||(c[1]=o=>z.$emit("close"))},{default:m(()=>[n("div",Ct,[I.value?(l(),r("div",Pt,[i(s(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),c[2]||(c[2]=n("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!M.value&&!D.value?(l(),r("div",Mt,[i(s(it),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),c[3]||(c[3]=n("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):D.value?(l(),r("div",Vt,[i(at,{"environment-id":F.environmentId},null,8,["environment-id"])])):(l(),r("form",{key:3,onSubmit:$e(U,["prevent"]),class:"space-y-6"},[(l(!0),r(C,null,J(M.value?.configSchema??{},(o,v)=>(l(),r("div",{key:v,class:"space-y-1.5"},[n("label",{for:v,class:"block text-sm font-medium text-zinc-300"},[$(w(o.label)+" ",1),o.secret?(l(),r("span",Ut,"Secret")):_("",!0)],8,At),o.enum?(l(),r("div",Lt,[xe(n("select",{id:v,"onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(l(!0),r(C,null,J(o.enum,g=>(l(),r("option",{key:g,value:g},w(g),9,jt))),128))],8,Ft),[[Qe,h.value[v]]]),c[4]||(c[4]=n("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[n("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[n("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):o.type==="boolean"?(l(),r("div",Et,[i(s(et),{checked:h.value[v],"onUpdate:checked":g=>h.value[v]=g},null,8,["checked","onUpdate:checked"]),n("span",Rt,w(h.value[v]?"Enabled":"Disabled"),1)])):(l(),r("div",Ht,[xe(n("input",{id:v,type:o.secret&&!k.value[v]?"password":o.type==="integer"?"number":"text","onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:o.default?.toString()},null,8,Tt),[[Je,h.value[v]]]),o.secret?(l(),r("button",{key:0,type:"button",onClick:g=>Y(v),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[k.value[v]?(l(),f(s(ut),{key:0,class:"w-4 h-4"})):(l(),f(s(ot),{key:1,class:"w-4 h-4"}))],8,Nt)):_("",!0)])),o.description?(l(),r("p",qt,w(o.description),1)):_("",!0)]))),128)),n("div",It,[i(s(P),{type:"button",onClick:c[0]||(c[0]=o=>z.$emit("close")),variant:"outline"},{default:m(()=>[...c[5]||(c[5]=[$(" Cancel ",-1)])]),_:1}),i(s(P),{type:"submit",disabled:A.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:m(()=>[A.value?(l(),f(s(V),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(l(),f(s(vt),{key:1,class:"w-4 h-4 mr-2"})),c[6]||(c[6]=$(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),Ot={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Wt={class:"text-sm text-zinc-500 mt-1"},Bt={class:"flex items-center gap-2"},Qt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Jt={key:1,class:"space-y-6"},Yt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Gt={class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},Xt={class:"flex items-center justify-between"},Zt={class:"text-sm font-medium text-zinc-100"},Kt={class:"divide-y divide-zinc-800/50"},es={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50"},ts={class:"flex-1 min-w-0"},ss={class:"flex items-center gap-2 flex-wrap"},ns={class:"font-medium text-sm text-zinc-100"},ls={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-zinc-800/80 text-zinc-400 ring-1 ring-inset ring-zinc-700/50"},as={class:"text-xs text-zinc-500 mt-0.5 truncate"},is={key:0,class:"text-zinc-600/70"},os={key:1,class:"text-zinc-500/70"},rs={class:"flex items-center gap-2"},cs={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},us={key:0,class:"px-4 py-3 bg-red-500/5"},ds={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-3 py-2 flex items-center justify-between"},vs=["onClick"],ps={class:"flex flex-col h-[70vh]"},ms={class:"flex items-center gap-3 px-4 py-3 border-b border-zinc-800 bg-zinc-900/50"},fs={class:"flex-1 overflow-auto bg-black"},gs={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap p-4"},hs={class:"p-6"},bs={key:0,class:"py-8 text-center"},xs={class:"grid grid-cols-2 gap-4"},ys={class:"grid grid-cols-2 gap-4"},ws={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},Fs=he({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(F){const H=F,u=Ce(),q=Ke(),I=Ye(),A=L(()=>!!q.props.reverb?.enabled),M=p(!1);_e(I,t=>{A.value&&t==="failed"&&!M.value&&(M.value=!0,y.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const h=t=>H.remoteApiUrl?`${H.remoteApiUrl}${t}`:`/api/environments/${H.environment.id}${t}`,k=L(()=>h("")),D=document.querySelector('meta[name="csrf-token"]')?.content||"",O=L(()=>u.services),U=p(!1),Y=L(()=>u.servicesRunning),z=L(()=>u.servicesTotal),c=p(!1),o=p(null),v=p(!1),g=p(!1),ae=p(null),ie=p(!1),T=p(null),W=p(""),X=p(!1),G=p(!1),B=p(null);let E=null;const Z=p(!1),oe=p(!1),K=p(!1),re=p(""),b=p({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),ce={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:Pe,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:fe,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:ne,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:ne,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:ne,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Me,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:pt,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker for production (orbit.ccc)",icon:me,category:"utility",required:!0},"horizon-dev":{name:"Laravel Horizon",description:"Queue worker for development (orbit-web.ccc)",icon:me,category:"utility",required:!0}};function ee(t){return t==="caddy"||t.startsWith("php-")||t==="horizon"||t==="horizon-dev"?"host":"docker"}function Ve(t){if(ce[t])return ce[t];if(t.startsWith("php-")){const e=t.replace("php-","");let a=e;return e.length===2&&!e.includes(".")&&(a=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${a}`,description:"Native PHP-FPM service",icon:ge,category:"php"}}return{name:t,description:"Service",icon:ge,category:"utility"}}const Ae=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],te=L(()=>{const t={core:[],php:[],database:[],utility:[]};for(const[e,a]of Object.entries(O.value)){const d=Ve(e);t[d.category].push({key:e,service:a,meta:d})}return t.php.sort((e,a)=>e.key.localeCompare(a.key)),t}),Ue=L(()=>Y.value===0);function Le(t){if(!t.startsWith("php-"))return null;const e=t.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const Fe=L(()=>{const t=te.value.php.map(({key:e})=>Le(e)).filter(e=>e!==null);return t.length===0?null:(t.sort((e,a)=>{const[d,x]=e.split(".").map(Number),[S,R]=a.split(".").map(Number);return d!==S?d-S:x-R}),t[t.length-1])});async function je(){const t=Fe.value;if(!t){y.error("No PHP services detected");return}re.value=t,oe.value=!0,Z.value=!0;try{const e=await fetch(h(`/php/config/${t}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const a=await e.json();a.success&&a.data?.settings&&(b.value={...b.value,...a.data.settings})}catch(e){y.error(`Error loading PHP settings: ${e}`)}finally{oe.value=!1}}async function Ee(){K.value=!0;try{const t=await fetch(h(`/php/config/${re.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b.value)});if(!t.ok)throw new Error("Failed to save PHP settings");const e=await t.json();e.success?(y.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),Z.value=!1):y.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(t){y.error("Error Saving PHP Settings",{description:String(t)})}finally{K.value=!1}}async function Q(t=!1){t||(U.value=!0);try{await u.fetchServices(k.value)}finally{t||(U.value=!1)}}async function Re(){o.value="stop-all";try{const t=await u.stopAll(k.value);t.success?(y.success("Services Stopping",{description:"All services are being stopped."}),await Q(!0)):y.error("Failed to Stop Services",{description:t.error||"An unknown error occurred."})}catch{y.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{o.value=null}}async function He(){c.value=!0,o.value="restart-all";try{const t=await u.restartAll(k.value);t.success?(y.success("Services Restarting",{description:"All services are being restarted."}),await Q(!0)):y.error("Failed to Restart Services",{description:t.error||"An unknown error occurred."})}catch{y.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{c.value=!1,o.value=null}}async function ue(t,e){const a=ee(t);try{let d;e==="start"?d=await u.startService(t,k.value,a):e==="stop"?d=await u.stopService(t,k.value,a):d=await u.restartService(t,k.value,a),d?.success?d.jobId||await Q(!0):y.error(`Failed to ${e} ${t}: `+(d?.error||"Unknown error"))}catch{y.error(`Failed to ${e} ${t}`)}}async function Te(t){if(confirm(`Are you sure you want to remove ${t}?`))try{const e=await u.disableService(t,k.value);e?.success?(y.success(`${t} disabled`),await Q(!0)):y.error("Failed to remove service: "+(e?.error||"Unknown error"))}catch{y.error("Failed to remove service")}}function Ne(t){ae.value=t,g.value=!0}async function qe(t){T.value=t,ie.value=!0,await de()}function Ie(t){return t.replace(/(\d{4}-\d{2}-\d{2})T(\d{2}):(\d{2}):\d{2}\.\d+Z/g,(e,a,d,x)=>`${a} ${d}:${x}`)}async function de(){if(T.value){X.value=!0;try{const e=ee(T.value)==="host"?`/host-services/${T.value}/logs`:`/services/${T.value}/logs`;let a=e;if(B.value){const S=B.value.toISOString();a=`${e}?since=${encodeURIComponent(S)}`}const x=await(await fetch(h(a))).json();if(x.success){const S=Ie(x.logs||"No logs available");if(B.value){const R=B.value.toLocaleTimeString();W.value=`--- Logs cleared at ${R} (showing only new entries) ---

${S}`}else W.value=S}else W.value="Failed to fetch logs: "+(x.error||"Unknown error")}catch{W.value="Failed to fetch logs"}finally{X.value=!1}}}function De(){ie.value=!1,T.value=null,W.value="",G.value=!1,B.value=null,E&&(clearInterval(E),E=null)}function Oe(){B.value=new Date,W.value=`--- Logs cleared at ${B.value.toLocaleTimeString()} ---

Waiting for new log entries...`}function We(){G.value=!G.value,G.value?E=setInterval(de,3e3):E&&(clearInterval(E),E=null)}function Be(t){return t.icon}return A.value&&Ge("orbit",".service.status.changed",t=>{u.handleServiceStatusChanged(t.job_id,t.service,t.status,t.error),t.error?y.error(`Failed to ${t.action} ${t.service}: ${t.error}`):y.success(`${t.service} ${t.action} completed`)}),be(async()=>{u.setActiveEnvironment(H.environment.id),u.isStale&&Q(),u.recoverPendingJobs(k.value)}),Xe(()=>{E&&clearInterval(E)}),(t,e)=>(l(),r(C,null,[i(s(Ze),{title:`Services - ${F.environment.name}`},null,8,["title"]),n("div",null,[n("header",Ot,[n("div",null,[e[15]||(e[15]=n("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Services",-1)),n("p",Wt,[U.value?(l(),r(C,{key:0},[$("Loading services...")],64)):(l(),r(C,{key:1},[$(w(Y.value)+"/"+w(z.value)+" services running",1)],64))])]),n("div",Bt,[i(s(P),{onClick:e[0]||(e[0]=a=>v.value=!0),disabled:U.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:m(()=>[i(s(Se),{class:"w-4 h-4 mr-1.5"}),e[16]||(e[16]=$(" Add Service ",-1))]),_:1},8,["disabled"]),Ue.value?_("",!0):(l(),f(s(P),{key:0,onClick:Re,disabled:U.value||o.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[o.value==="stop-all"?(l(),f(s(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),f(s(ke),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[17]||(e[17]=$(" Stop All ",-1))]),_:1},8,["disabled"])),i(s(P),{onClick:He,disabled:U.value||o.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[c.value?(l(),f(s(V),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),f(s(pe),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[18]||(e[18]=$(" Restart All ",-1))]),_:1},8,["disabled"])])]),U.value?(l(),r("div",Qt,[i(s(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[19]||(e[19]=n("p",{class:"text-zinc-500"},"Loading services...",-1))])):(l(),r("div",Jt,[(l(),r(C,null,J(Ae,a=>(l(),r(C,{key:a.key},[te.value[a.key].length>0?(l(),r("div",Yt,[n("div",Gt,[n("div",Xt,[n("h2",Zt,w(a.label),1),a.key==="php"?(l(),f(s(P),{key:0,onClick:je,variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-zinc-100",title:"PHP Settings"},{default:m(()=>[i(s(ye),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),n("div",Kt,[(l(!0),r(C,null,J(te.value[a.key],({key:d,service:x,meta:S})=>(l(),r("div",{key:d,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},[n("div",es,[(l(),f(ze(Be(S)),{class:"h-4 w-4 text-zinc-400"}))]),n("div",ts,[n("div",ss,[n("span",ns,w(S.name),1),x.required||S.required?(l(),r("span",ls," Required ")):_("",!0),n("span",{class:se(["px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full ring-1 ring-inset",ee(d)==="docker"?"bg-blue-500/10 text-blue-400 ring-blue-500/20":"bg-lime-500/10 text-lime-400 ring-lime-500/20"])},w(ee(d)),3),n("span",{class:se(["h-2 w-2 rounded-full",x.status==="running"?"bg-lime-400":x.status==="stopped"?"bg-zinc-600":"bg-red-400"])},null,2)]),n("p",as,[$(w(S.description)+" ",1),S.ports?(l(),r("span",is," Â· ")):_("",!0),S.ports?(l(),r("span",os,w(S.ports),1)):_("",!0)])]),n("div",rs,[n("span",{class:se(["px-2.5 py-1 text-xs font-medium rounded-full ring-1 ring-inset",x.status==="running"?"bg-lime-500/15 text-lime-400 ring-lime-500/30":x.status==="stopped"?"bg-zinc-800 text-zinc-400 ring-zinc-700":"bg-red-500/15 text-red-400 ring-red-500/30"])},w(x.status==="running"?"Running":x.status==="stopped"?"Stopped":"Error"),3),n("div",cs,[x.status!=="running"?(l(),f(s(P),{key:0,onClick:R=>ue(d,"start"),disabled:s(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Start"},{default:m(()=>[s(u).isServicePending(d)?(l(),f(s(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(s(dt),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):_("",!0),x.status==="running"?(l(),f(s(P),{key:1,onClick:R=>ue(d,"stop"),disabled:s(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",title:"Stop"},{default:m(()=>[s(u).isServicePending(d)?(l(),f(s(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(s(ke),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):_("",!0),i(s(P),{onClick:R=>ue(d,"restart"),disabled:s(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800",title:"Restart"},{default:m(()=>[s(u).isServicePending(d)?(l(),f(s(V),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),f(s(pe),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"]),i(s(lt),null,{default:m(()=>[i(s(tt),{"as-child":""},{default:m(()=>[i(s(P),{variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800"},{default:m(()=>[i(s(ct),{class:"w-4 h-4"})]),_:1})]),_:1}),i(s(st),{align:"end",class:"w-40"},{default:m(()=>[i(s(ve),{onClick:R=>Ne(d)},{default:m(()=>[i(s(ye),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=$(" Settings ",-1))]),_:1},8,["onClick"]),i(s(ve),{onClick:R=>qe(d)},{default:m(()=>[i(s(me),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=$(" View Logs ",-1))]),_:1},8,["onClick"]),!x.required&&!S.required?(l(),r(C,{key:0},[i(s(nt)),i(s(ve),{onClick:R=>Te(d),disabled:s(u).isServicePending(d),class:"text-red-400 focus:text-red-400"},{default:m(()=>[i(s(we),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=$(" Remove ",-1))]),_:1},8,["onClick","disabled"])],64)):_("",!0)]),_:2},1024)]),_:2},1024)])])]))),128)),(l(!0),r(C,null,J(te.value[a.key],({key:d})=>(l(),r(C,{key:`error-${d}`},[s(u).getServiceError(d)?(l(),r("div",us,[n("div",ds,[n("span",null,"Error: "+w(s(u).getServiceError(d)),1),n("button",{onClick:x=>s(u).clearServiceError(d),class:"text-red-400 hover:text-white ml-2"},[i(s(rt),{class:"w-3 h-3"})],8,vs)])])):_("",!0)],64))),128))])])):_("",!0)],64))),64))])),i($t,{show:v.value,"get-api-url":h,"csrf-token":s(D),onClose:e[1]||(e[1]=a=>v.value=!1),onServiceEnabled:e[2]||(e[2]=()=>Q())},null,8,["show","csrf-token"]),i(Dt,{show:g.value,"service-name":ae.value,"environment-id":F.environment.id,"get-api-url":h,"csrf-token":s(D),onClose:e[3]||(e[3]=a=>g.value=!1),onConfigUpdated:e[4]||(e[4]=()=>Q())},null,8,["show","service-name","environment-id","csrf-token"]),i(le,{show:ie.value,title:`${ce[T.value]?.name||T.value} Logs`,maxWidth:"max-w-4xl",noPadding:"",onClose:De},{default:m(()=>[n("div",ps,[n("div",ms,[i(s(P),{onClick:de,disabled:X.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:m(()=>[X.value?(l(),f(s(V),{key:0,class:"w-4 h-4 animate-spin"})):(l(),f(s(pe),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),i(s(P),{onClick:Oe,disabled:X.value,variant:"ghost",size:"icon-sm",title:"Clear logs display"},{default:m(()=>[i(s(we),{class:"w-4 h-4"})]),_:1},8,["disabled"]),n("button",{onClick:We,class:se(["text-xs px-2 py-1 rounded-full",G.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},w(G.value?"Auto-refresh ON":"Auto-refresh"),3)]),n("div",fs,[n("pre",gs,w(W.value),1)])])]),_:1},8,["show","title"]),i(le,{show:Z.value,title:`PHP ${re.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=a=>Z.value=!1)},{default:m(()=>[n("div",hs,[oe.value?(l(),r("div",bs,[i(s(V),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[23]||(e[23]=n("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(l(),r("form",{key:1,onSubmit:$e(Ee,["prevent"]),class:"space-y-6"},[n("div",null,[e[28]||(e[28]=n("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),n("div",xs,[n("div",null,[e[24]||(e[24]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),i(s(N),{modelValue:b.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value.upload_max_filesize=a),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[25]||(e[25]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),i(s(N),{modelValue:b.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value.post_max_size=a),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[26]||(e[26]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),i(s(N),{modelValue:b.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value.memory_limit=a),class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[27]||(e[27]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),i(s(N),{modelValue:b.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=a=>b.value.max_execution_time=a),class:"w-full font-mono"},null,8,["modelValue"])])])]),n("div",null,[e[33]||(e[33]=n("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),n("div",ys,[n("div",null,[e[29]||(e[29]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),i(s(N),{modelValue:b.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=a=>b.value.max_children=a),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[30]||(e[30]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),i(s(N),{modelValue:b.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value.start_servers=a),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[31]||(e[31]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),i(s(N),{modelValue:b.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=a=>b.value.min_spare_servers=a),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),n("div",null,[e[32]||(e[32]=n("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),i(s(N),{modelValue:b.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=a=>b.value.max_spare_servers=a),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),n("div",ws,[i(s(P),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=a=>Z.value=!1)},{default:m(()=>[...e[34]||(e[34]=[$(" Cancel ",-1)])]),_:1}),i(s(P),{type:"submit",variant:"secondary",disabled:K.value},{default:m(()=>[K.value?(l(),f(s(V),{key:0,class:"w-4 h-4 animate-spin"})):_("",!0),$(" "+w(K.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{Fs as default};
