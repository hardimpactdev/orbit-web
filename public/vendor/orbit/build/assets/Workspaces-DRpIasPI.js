import{d as q,X as E,z as G,c as i,g as s,a as r,u as t,h as O,w as n,l as x,b as m,P as A,r as h,Y as T,o as l,F as _,i as j,e as y,t as k,f as g,Z as S,W as X,U as Z,M as F}from"./app-DCjzOA_Z.js";import{a as N}from"./axios-DBmgdnXZ.js";import{_ as H}from"./Heading.vue_vue_type_script_setup_true_lang-BwQHPwFZ.js";import{_ as J}from"./Modal.vue_vue_type_script_setup_true_lang-Bho30n21.js";import{_ as K}from"./EditorIcon.vue_vue_type_script_setup_true_lang-DgrRAbn-.js";import{I as f,a as Q,q as Y,b as z,j as R,A as C,U as ee}from"./craft-ui-LxbrBGk3.js";import{L as D}from"./loader-circle-Dbdq18o5.js";import{T as te}from"./trash-2-C8A-D6Uu.js";const se={class:"space-y-6"},ne={class:"flex items-center justify-between"},ae={key:0,class:"border border-zinc-800 rounded-xl p-12 text-center"},oe={key:1,class:"border border-zinc-800 rounded-xl p-12 text-center"},le={key:2},re={class:"font-medium text-white"},ie={class:"flex items-center gap-2"},de={class:"text-zinc-400"},ue={key:0,class:"flex -space-x-1"},ce=["title"],me={key:0,class:"w-6 h-6 rounded-full bg-zinc-700 border border-zinc-600 flex items-center justify-center text-xs text-zinc-400"},fe={class:"flex items-center justify-end gap-2"},ve={class:"p-6"},pe={class:"text-zinc-400 mb-6"},he={class:"flex justify-end gap-3"},ze=q({layout:E,__name:"Workspaces",props:{environment:{},editor:{},remoteApiUrl:{}},setup(d){const u=d,W=o=>u.remoteApiUrl?`${u.remoteApiUrl}${o}`:`/api/environments/${u.environment.id}${o}`,$=h([]),b=h(!0);async function U(){b.value=!0;try{const{data:o}=await N.get(W("/workspaces"));o.success&&o.data?.workspaces&&($.value=o.data.workspaces)}catch(o){if(Z.isCancel(o))return;console.error("Failed to load workspaces:",o)}finally{b.value=!1}}G(()=>{U()});const w=h(null),v=h(!1),p=h(null),B=o=>{const e=u.environment.user,a=u.environment.host,P=`${o.path}/${o.name}.code-workspace`,V=`${u.editor.scheme}://vscode-remote/ssh-remote+${e}@${a}${P}?windowId=_blank`;window.open(V,"_blank")},I=o=>{const e=u.environment.user,a=u.environment.host,c=`ssh://${e}@${a}`;window.open(c,"_self")},L=o=>{p.value=o,v.value=!0},M=async()=>{if(!p.value)return;const o=p.value;w.value=o,v.value=!1;try{const{data:e}=await N.delete(W(`/workspaces/${o}`));e.success?(F.success(`Workspace "${o}" deleted successfully`),await U()):F.error("Failed to delete workspace",{description:e.error||"Unknown error"})}catch{}finally{w.value=null,p.value=null}};return(o,e)=>(l(),i(_,null,[s(t(O),{title:`Workspaces - ${d.environment.name}`},null,8,["title"]),r("div",se,[r("div",ne,[s(H,{title:"Workspaces",description:"Group related sites together for easier management"}),s(t(f),{"as-child":"",variant:"secondary"},{default:n(()=>[s(t(x),{href:`/environments/${d.environment.id}/workspaces/create`},{default:n(()=>[s(t(A),{class:"w-4 h-4 mr-2"}),e[2]||(e[2]=m(" New Workspace ",-1))]),_:1},8,["href"])]),_:1})]),b.value?(l(),i("div",ae,[s(t(D),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-4"}),e[3]||(e[3]=r("p",{class:"text-zinc-400"},"Loading workspaces...",-1))])):$.value.length===0?(l(),i("div",oe,[s(t(T),{class:"w-12 h-12 mx-auto text-zinc-600 mb-4"}),e[5]||(e[5]=r("h3",{class:"text-lg font-medium text-white mb-2"},"No workspaces yet",-1)),e[6]||(e[6]=r("p",{class:"text-zinc-400 mb-6"},"Create a workspace to group related sites together.",-1)),s(t(f),{"as-child":"",variant:"secondary"},{default:n(()=>[s(t(x),{href:`/environments/${d.environment.id}/workspaces/create`},{default:n(()=>[s(t(A),{class:"w-4 h-4 mr-2"}),e[4]||(e[4]=m(" Create Your First Workspace ",-1))]),_:1},8,["href"])]),_:1})])):(l(),i("div",le,[s(t(ee),null,{default:n(()=>[s(t(Q),null,{default:n(()=>[s(t(Y),null,{default:n(()=>[s(t(z),null,{default:n(()=>[...e[7]||(e[7]=[m("Workspace",-1)])]),_:1}),s(t(z),null,{default:n(()=>[...e[8]||(e[8]=[m("Sites",-1)])]),_:1}),s(t(z),{class:"text-right"},{default:n(()=>[...e[9]||(e[9]=[m("Actions",-1)])]),_:1})]),_:1})]),_:1}),s(t(R),null,{default:n(()=>[(l(!0),i(_,null,j($.value,a=>(l(),y(t(Y),{key:a.name},{default:n(()=>[s(t(C),null,{default:n(()=>[s(t(x),{href:`/environments/${d.environment.id}/workspaces/${a.name}`,class:"flex items-center gap-3 hover:text-lime-400"},{default:n(()=>[s(t(T),{class:"w-4 h-4 text-lime-400"}),r("span",re,k(a.name),1)]),_:2},1032,["href"])]),_:2},1024),s(t(C),null,{default:n(()=>[r("div",ie,[r("span",de,k(a.site_count)+" site"+k(a.site_count!==1?"s":""),1),a.sites.length>0?(l(),i("div",ue,[(l(!0),i(_,null,j(a.sites.slice(0,3),c=>(l(),i("div",{key:c.name,class:"w-6 h-6 rounded-full bg-zinc-700 border border-zinc-600 flex items-center justify-center",title:c.name},[s(t(S),{class:"w-3 h-3 text-zinc-400"})],8,ce))),128)),a.sites.length>3?(l(),i("div",me," +"+k(a.sites.length-3),1)):g("",!0)])):g("",!0)])]),_:2},1024),s(t(C),{class:"text-right"},{default:n(()=>[r("div",fe,[o.$page.props.multi_environment?(l(),i(_,{key:0},[s(t(f),{onClick:c=>I(a),variant:"ghost",size:"sm",title:"Open in Terminal"},{default:n(()=>[s(t(X),{class:"w-3.5 h-3.5"})]),_:1},8,["onClick"]),a.has_workspace_file?(l(),y(t(f),{key:0,onClick:c=>B(a),variant:"ghost",size:"sm",title:`Open in ${d.editor.name}`},{default:n(()=>[s(K,{editor:d.editor.scheme,class:"w-3.5 h-3.5"},null,8,["editor"])]),_:1},8,["onClick","title"])):g("",!0)],64)):g("",!0),s(t(f),{"as-child":"",variant:"outline",size:"sm"},{default:n(()=>[s(t(x),{href:`/environments/${d.environment.id}/workspaces/${a.name}`},{default:n(()=>[...e[10]||(e[10]=[m(" Manage ",-1)])]),_:1},8,["href"])]),_:2},1024),s(t(f),{onClick:c=>L(a.name),variant:"ghost",size:"sm",class:"text-red-400 hover:text-red-300",disabled:w.value===a.name},{default:n(()=>[w.value===a.name?(l(),y(t(D),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),y(t(te),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]))]),s(J,{show:v.value,title:"Delete Workspace",onClose:e[1]||(e[1]=a=>v.value=!1)},{default:n(()=>[r("div",ve,[r("p",pe,' Are you sure you want to delete the workspace "'+k(p.value)+`"? This will remove the workspace directory and symlinks, but won't delete the actual sites. `,1),r("div",he,[s(t(f),{onClick:e[0]||(e[0]=a=>v.value=!1),variant:"ghost"},{default:n(()=>[...e[11]||(e[11]=[m("Cancel",-1)])]),_:1}),s(t(f),{onClick:M,variant:"destructive"},{default:n(()=>[...e[12]||(e[12]=[m(" Delete Workspace ",-1)])]),_:1})])])]),_:1},8,["show"])],64))}});export{ze as default};
