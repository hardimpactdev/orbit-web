import{$ as P,d as _,e as j,f as Y,B as z,Y as S,I as b}from"./craft-ui-DhFXzGOb.js";import{C as q}from"./circle-alert-DffoSCLm.js";import{I as B,d as O,y as U,c as o,a as t,f as m,e as w,r as p,g as a,u as l,t as x,H as E,F as H,i as J,w as u,b as f,P as V,S as K,o as d}from"./app-BnAW4W7n.js";import{L as C}from"./loader-circle-0KoIL4oR.js";import{T as R}from"./trash-2-CFCB31-K.js";const M=B("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),W={class:"space-y-6"},X={key:0,class:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg flex items-start gap-3"},G={class:"text-red-400/80 text-sm mt-1"},Q={key:1,class:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg flex items-start gap-3"},Z={class:"text-green-400/80 text-sm mt-1"},ee={key:2,class:"flex items-center justify-center py-12"},te={key:3,class:"space-y-3"},se={class:"flex items-center gap-3"},le={class:"p-2 bg-zinc-700 rounded"},ae={class:"text-sm font-medium text-white"},de={class:"text-xs text-zinc-500 mt-0.5"},ne={key:0,class:"text-center py-12 border border-dashed border-zinc-700 rounded-lg"},re={key:4,class:"p-4 bg-zinc-800/50 border border-zinc-700 rounded-lg space-y-4"},oe={class:"grid grid-cols-2 gap-4"},ie={class:"text-xs text-zinc-500 mt-1"},ue={key:0},pe={key:1},ve={class:"text-xs text-zinc-500 mt-1"},ce={class:"flex gap-2"},me={key:6,class:"flex items-center gap-2 text-zinc-400 text-sm"},Se=O({__name:"DnsSettings",props:{environmentId:{}},setup(T){const N=T,v=p([]),k=p(!0),c=p(!1),i=p(null),g=p(null),y=p(!1),n=p({type:"address",tld:"",value:""}),I=document.querySelector('meta[name="csrf-token"]')?.content||"",A=async()=>{k.value=!0,i.value=null;try{const e=await(await fetch(`/environments/${N.environmentId}/dns`,{headers:{Accept:"application/json"}})).json();e.success?v.value=e.mappings||[]:i.value=e.error||"Failed to load DNS mappings"}catch(s){i.value="Failed to load DNS mappings",console.error(s)}finally{k.value=!1}},D=async()=>{c.value=!0,i.value=null,g.value=null;try{const e=await(await fetch(`/environments/${N.environmentId}/dns`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":I},body:JSON.stringify({mappings:v.value})})).json();e.success?(g.value=e.dns_restarted?"DNS mappings updated and DNS service restarted successfully":"DNS mappings updated successfully",setTimeout(()=>{g.value=null},3e3)):i.value=e.error||"Failed to save DNS mappings"}catch(s){i.value="Failed to save DNS mappings",console.error(s)}finally{c.value=!1}},$=()=>{const s={...n.value};if(!s.value.trim()){i.value="IP address is required";return}if(s.type==="address"&&!s.tld?.trim()){i.value="TLD is required for address mappings";return}s.type==="server"&&!s.tld?.trim()&&delete s.tld,v.value.push(s),n.value={type:"address",tld:"",value:""},y.value=!1,i.value=null,D()},L=s=>{v.value.splice(s,1),D()},F=s=>s.type==="address"?`*.${s.tld} → ${s.value}`:s.tld?`*.${s.tld} DNS → ${s.value}`:`Fallback DNS → ${s.value}`;return U(()=>{A()}),(s,e)=>(d(),o("div",W,[e[23]||(e[23]=t("div",null,[t("h3",{class:"text-lg font-semibold text-white mb-2"},"DNS Mappings"),t("p",{class:"text-sm text-zinc-400"}," Configure DNS resolution for development domains and fallback DNS servers. ")],-1)),i.value?(d(),o("div",X,[a(l(q),{class:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),t("div",null,[e[6]||(e[6]=t("p",{class:"text-red-400 text-sm font-medium"},"Error",-1)),t("p",G,x(i.value),1)])])):m("",!0),g.value?(d(),o("div",Q,[a(l(E),{class:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),t("div",null,[e[7]||(e[7]=t("p",{class:"text-green-400 text-sm font-medium"},"Success",-1)),t("p",Z,x(g.value),1)])])):m("",!0),k.value?(d(),o("div",ee,[a(l(C),{class:"w-6 h-6 animate-spin text-zinc-500"})])):(d(),o("div",te,[(d(!0),o(H,null,J(v.value,(r,h)=>(d(),o("div",{key:h,class:"flex items-center justify-between p-4 bg-zinc-800/50 border border-zinc-700 rounded-lg hover:border-zinc-600 transition-colors"},[t("div",se,[t("div",le,[r.type==="address"?(d(),w(l(M),{key:0,class:"w-4 h-4 text-lime-400"})):(d(),w(l(K),{key:1,class:"w-4 h-4 text-blue-400"}))]),t("div",null,[t("p",ae,x(F(r)),1),t("p",de,x(r.type==="address"?"Address mapping":"DNS server"),1)])]),a(l(b),{variant:"ghost",size:"sm",onClick:xe=>L(h),disabled:c.value},{default:u(()=>[a(l(R),{class:"w-4 h-4 text-red-400"})]),_:1},8,["onClick","disabled"])]))),128)),v.value.length===0?(d(),o("div",ne,[a(l(M),{class:"w-12 h-12 text-zinc-600 mx-auto mb-3"}),e[8]||(e[8]=t("p",{class:"text-zinc-400 text-sm"},"No DNS mappings configured",-1)),e[9]||(e[9]=t("p",{class:"text-zinc-500 text-xs mt-1"},"Add your first mapping to get started",-1))])):m("",!0)])),y.value?(d(),o("div",re,[e[20]||(e[20]=t("h4",{class:"text-sm font-medium text-white"},"Add DNS Mapping",-1)),t("div",oe,[t("div",null,[e[12]||(e[12]=t("label",{class:"text-xs text-zinc-400 mb-2 block"},"Type",-1)),a(l(P),{modelValue:n.value.type,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.type=r)},{default:u(()=>[a(l(_),null,{default:u(()=>[a(l(j),{placeholder:"Select type"})]),_:1}),a(l(Y),null,{default:u(()=>[a(l(z),{value:"address"},{default:u(()=>[...e[10]||(e[10]=[f("Address (*.tld → IP)",-1)])]),_:1}),a(l(z),{value:"server"},{default:u(()=>[...e[11]||(e[11]=[f("DNS Server",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("p",ie,x(n.value.type==="address"?"Maps a TLD to an IP address":"Forwards queries to DNS server"),1)]),n.value.type==="address"?(d(),o("div",ue,[e[13]||(e[13]=t("label",{class:"text-xs text-zinc-400 mb-2 block"},"TLD",-1)),a(l(S),{modelValue:n.value.tld,"onUpdate:modelValue":e[1]||(e[1]=r=>n.value.tld=r),placeholder:"test",class:"w-full"},null,8,["modelValue"]),e[14]||(e[14]=t("p",{class:"text-xs text-zinc-500 mt-1"},'Without leading dot (e.g., "test" or "ccc")',-1))])):(d(),o("div",pe,[e[15]||(e[15]=t("label",{class:"text-xs text-zinc-400 mb-2 block"},"TLD (Optional)",-1)),a(l(S),{modelValue:n.value.tld,"onUpdate:modelValue":e[2]||(e[2]=r=>n.value.tld=r),placeholder:"ccc",class:"w-full"},null,8,["modelValue"]),e[16]||(e[16]=t("p",{class:"text-xs text-zinc-500 mt-1"},"Leave empty for fallback DNS",-1))]))]),t("div",null,[e[17]||(e[17]=t("label",{class:"text-xs text-zinc-400 mb-2 block"},"IP Address",-1)),a(l(S),{modelValue:n.value.value,"onUpdate:modelValue":e[3]||(e[3]=r=>n.value.value=r),placeholder:"127.0.0.1 or 8.8.8.8",class:"w-full"},null,8,["modelValue"]),t("p",ve,x(n.value.type==="address"?"IP to resolve the TLD to":"DNS server IP address"),1)]),t("div",ce,[a(l(b),{variant:"secondary",onClick:$,disabled:c.value},{default:u(()=>[a(l(V),{class:"w-4 h-4"}),e[18]||(e[18]=f(" Add Mapping ",-1))]),_:1},8,["disabled"]),a(l(b),{variant:"ghost",onClick:e[4]||(e[4]=r=>y.value=!1)},{default:u(()=>[...e[19]||(e[19]=[f(" Cancel ",-1)])]),_:1})])])):m("",!0),y.value?m("",!0):(d(),w(l(b),{key:5,variant:"outline",onClick:e[5]||(e[5]=r=>y.value=!0),disabled:c.value},{default:u(()=>[a(l(V),{class:"w-4 h-4"}),e[21]||(e[21]=f(" Add DNS Mapping ",-1))]),_:1},8,["disabled"])),c.value?(d(),o("div",me,[a(l(C),{class:"w-4 h-4 animate-spin"}),e[22]||(e[22]=f(" Saving and restarting DNS service... ",-1))])):m("",!0)]))}});export{Se as _};
