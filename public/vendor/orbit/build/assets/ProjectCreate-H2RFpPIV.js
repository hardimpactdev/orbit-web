import{c as ne,Y as re,d as ie,D as I,r as f,m as ue,a as v,h as s,b as t,u as l,i as de,t as d,q as ve,g,n as w,e as u,f as z,w as r,o as i,F as A,j as Z,N as me,p as E,z as ce,C as pe,a0 as fe,l as xe,$ as ge,y as _e}from"./app-B9x7YZpu.js";import{Y as ee,A as q,q as L,k as R,B as c,$,I as te}from"./craft-ui-CaWVxHTa.js";import{L as M}from"./loader-circle-Cx9CfdV2.js";import{C as be}from"./circle-alert-DUDXhcwq.js";import{C as ye}from"./copy-CtRH3W1X.js";const he=ne("git-fork",[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]]),ke=re("github",{state:()=>({selectedOrg:null}),actions:{setSelectedOrg(C){this.selectedOrg=C}},persist:{key:"orbit-github",pick:["selectedOrg"]}}),we={class:"mb-8"},ze={class:"text-zinc-400 mt-1"},Ce={class:"grid grid-cols-2 gap-8 py-6"},Se={key:0,class:"mt-1 text-xs text-zinc-500"},Te={class:"font-mono text-zinc-400"},Pe={class:"grid grid-cols-2 gap-8 py-6"},Ve={key:0,class:"flex items-center text-zinc-500"},qe={key:2,class:"text-sm text-zinc-500"},Le={key:3,class:"mt-2 flex items-center gap-2"},Re={key:3,class:"text-xs text-zinc-500"},$e={key:4,class:"text-xs text-lime-400"},je=["href"],Oe={key:6,class:"text-xs text-amber-400"},De={class:"grid grid-cols-2 gap-8 py-6"},Fe={key:0,class:"flex items-center text-zinc-500 mt-2"},He={key:1,class:"flex items-center gap-2 mt-2"},Ne={key:0,class:"text-xs px-2 py-0.5 rounded-full bg-zinc-700 text-zinc-400"},Ue={key:1,class:"text-xs px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400 border border-purple-500/20"},Ae={key:2,class:"text-xs text-zinc-500"},Ee={key:2,class:"mt-4 p-4 bg-zinc-800/50 border border-zinc-700 rounded-lg"},Me={class:"flex gap-3"},Ye={class:"flex items-center gap-2 mb-1"},Ge={class:"flex items-center gap-2 mb-1"},Be={key:3,class:"text-xs text-amber-400 mt-2"},Ke={key:4,class:"mt-3"},Qe={class:"flex flex-wrap gap-2"},Ie=["onClick"],We={class:"py-6"},Je={key:0,class:"mt-4 space-y-6"},Xe={class:"grid grid-cols-2 gap-8"},Ze={class:"text-sm text-zinc-500 mt-1"},et={key:0},tt={key:1},lt={class:"grid grid-cols-2 gap-8"},st={class:"text-sm text-zinc-500 mt-1"},at={class:"text-zinc-400"},ot={class:"grid grid-cols-2 gap-8"},nt={class:"text-sm text-zinc-500 mt-1"},rt={class:"text-zinc-400"},it={class:"grid grid-cols-2 gap-8"},ut={class:"text-sm text-zinc-500 mt-1"},dt={class:"text-zinc-400"},vt={class:"grid grid-cols-2 gap-8"},mt={class:"text-sm text-zinc-500 mt-1"},ct={class:"text-zinc-400"},pt={key:1,class:"mt-6"},ft={class:"p-4 bg-red-400/10 border border-red-400/20 rounded-lg"},xt={class:"text-red-400"},gt={class:"flex justify-end gap-3 pt-6 mt-6 border-t border-zinc-800"},wt=ie({__name:"ProjectCreate",props:{environment:{},recentTemplates:{}},setup(C){const j=C,Y=ke(),a=f({name:"",template:"",is_template:!1,fork:!1,visibility:"private",php_version:null,db_driver:null,session_driver:null,cache_driver:null,queue_driver:null}),D=f(!1),F=f(null),_=f(null),G=f([]),B=f(!1),p=f(null),b=f(null),S=f(!1),T=f(null);let P=null;const O=n=>n.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),H=E(()=>!p.value||!a.value.name?null:`${p.value}/${O(a.value.name)}`),le=E(()=>{if(!a.value.template)return null;const n=a.value.template.match(/(?:github\.com\/)?([^/]+\/[^/\s]+?)(?:\.git)?$/i);return n?n[1].toLowerCase():null}),W=E(()=>{if(!a.value.template||a.value.is_template||!p.value||!a.value.name)return!1;const n=O(a.value.name),e=`${p.value}/${n}`.toLowerCase();return le.value!==e}),J=E(()=>!(!a.value.name.trim()||S.value||b.value===!0||D.value)),V=f(!1),x=f(null),m=f(null),K=f(!1),h=f(null);let Q=null;const k=n=>n?{sqlite:"SQLite",pgsql:"PostgreSQL",mysql:"MySQL",file:"File",database:"Database",redis:"Redis",sync:"Sync",array:"Array"}[n]||n:"Not set";I(()=>a.value.name,n=>{if(P&&clearTimeout(P),b.value=null,T.value=null,!n||!p.value)return;S.value=!0;const e=p.value,o=n;P=setTimeout(()=>{X(e,o)},500)}),I(p,n=>{if(Y.setSelectedOrg(n?.toLowerCase()??null),n&&a.value.name){b.value=null,T.value=null,S.value=!0,P&&clearTimeout(P);const e=n,o=a.value.name;P=setTimeout(()=>{X(e,o)},300)}});async function X(n,e){if(!n||!e){S.value=!1;return}const o=O(e),y=`${n}/${o}`;try{const U=await(await fetch(`/environments/${j.environment.id}/github-repo-exists`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({repo:y})})).json();U.success?(b.value=U.exists,T.value=U.error||null):T.value=U.error||"Failed to check repository"}catch(N){console.error("Failed to check repo:",N),T.value="Failed to check repository availability"}finally{S.value=!1}}I(()=>a.value.template,n=>{if(Q&&clearTimeout(Q),!n){x.value=null,m.value=null,a.value.is_template=!1,h.value=null;return}Q=setTimeout(()=>{se(n)},500)});const se=async n=>{K.value=!0,h.value=null;try{const o=await(await fetch(`/environments/${j.environment.id}/template-defaults`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({template:n})})).json();if(o.success&&o.data){const y=o.data.drivers||o.data;x.value=y,m.value=o.data.metadata||{is_template:o.data.is_template||!1,framework:o.data.type||"unknown",default_branch:"main",repo:n},a.value.is_template=o.data.is_template||!1,m.value?.recommended_php_version&&(a.value.php_version=m.value.recommended_php_version),(y.db_driver||y.session_driver||y.cache_driver||y.queue_driver)&&(V.value=!0)}else h.value=o.error||"Could not fetch repository info",x.value=null,m.value=null,a.value.is_template=!1}catch(e){console.error("Failed to fetch repository info:",e),h.value="Failed to fetch repository info",x.value=null,m.value=null,a.value.is_template=!1}finally{K.value=!1}};ue(async()=>{B.value=!0;try{const[n,e]=await Promise.all([fetch(`/environments/${j.environment.id}/github-user`).then(o=>o.json()),fetch(`/environments/${j.environment.id}/github-orgs`).then(o=>o.json())]);if(n.success&&n.user&&(_.value=n.user.toLowerCase()),e.success&&e.data&&(G.value=e.data),Y.selectedOrg){const o=Y.selectedOrg.toLowerCase();[_.value?.toLowerCase(),...G.value.map(N=>N.login.toLowerCase())].includes(o)?p.value=o:p.value=_.value}else p.value=_.value}catch(n){console.error("Failed to fetch GitHub data:",n);try{const e=await fetch(`/environments/${j.environment.id}/github-user`).then(o=>o.json());e.success&&e.user&&(_.value=e.user.toLowerCase(),p.value=_.value)}catch{}}finally{B.value=!1}});const ae=n=>{a.value.template=n.repo_url,(n.db_driver||n.session_driver||n.cache_driver||n.queue_driver)&&(a.value.db_driver=n.db_driver,a.value.session_driver=n.session_driver,a.value.cache_driver=n.cache_driver,a.value.queue_driver=n.queue_driver,V.value=!0)},oe=()=>{J.value&&(D.value=!0,F.value=null,_e.post("/projects",{...a.value,org:p.value},{onSuccess:()=>{},onError:n=>{F.value=n.error||n.name||Object.values(n)[0]||"Failed to create project",D.value=!1},onFinish:()=>{}}))};return(n,e)=>(i(),v(A,null,[s(l(de),{title:"New Project"}),t("div",null,[t("div",we,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-white"},"New Project",-1)),t("p",ze,"Create a new project in "+d(C.environment.name),1)]),t("form",{onSubmit:ve(oe,["prevent"])},[t("div",Ce,[e[13]||(e[13]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Project Name"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Display name for the project. Will be slugified for the directory and URL. ")],-1)),t("div",null,[s(l(ee),{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.name=o),type:"text",id:"name",required:"",placeholder:"My Awesome Project",class:w(["w-full",{"border-red-500":b.value===!0}])},null,8,["modelValue","class"]),a.value.name&&O(a.value.name)!==a.value.name?(i(),v("p",Se,[e[12]||(e[12]=u(" Directory: ",-1)),t("span",Te,d(O(a.value.name)),1)])):g("",!0)])]),e[47]||(e[47]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Pe,[e[15]||(e[15]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Organization"),t("p",{class:"text-sm text-zinc-500 mt-1"}," GitHub account or organization where the repository will be created. ")],-1)),t("div",null,[B.value?(i(),v("div",Ve,[s(l(M),{class:"w-4 h-4 mr-2 animate-spin"}),e[14]||(e[14]=t("span",{class:"text-sm"},"Loading organizations...",-1))])):_.value?(i(),z(l($),{key:1,"model-value":p.value,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select organization"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:_.value},{default:r(()=>[u(d(_.value)+" (Personal) ",1)]),_:1},8,["value"]),(i(!0),v(A,null,Z(G.value,o=>(i(),z(l(c),{key:o.login,value:o.login.toLowerCase()},{default:r(()=>[u(d(o.login),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])):(i(),v("div",qe," Unable to load GitHub account ")),a.value.name&&p.value?(i(),v("div",Le,[S.value?(i(),z(l(M),{key:0,class:"w-3.5 h-3.5 animate-spin text-zinc-500"})):b.value===!1?(i(),z(l(me),{key:1,class:"w-3.5 h-3.5 text-lime-400"})):b.value===!0?(i(),z(l(be),{key:2,class:"w-3.5 h-3.5 text-red-400"})):g("",!0),S.value?(i(),v("span",Re," Checking "+d(H.value)+"... ",1)):b.value===!1?(i(),v("span",$e,d(H.value)+" is available ",1)):b.value===!0?(i(),v("a",{key:5,href:`https://github.com/${H.value}`,target:"_blank",class:"text-xs text-red-400 hover:underline"},d(H.value)+" already exists ",9,je)):T.value?(i(),v("span",Oe,d(T.value),1)):g("",!0)])):g("",!0)])]),e[48]||(e[48]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",De,[e[21]||(e[21]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Repository"),t("p",{class:"text-sm text-zinc-500 mt-1"}," GitHub repository to use as a starting point. ")],-1)),t("div",null,[s(l(ee),{modelValue:a.value.template,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.template=o),type:"text",id:"template",placeholder:"owner/repo or https://github.com/owner/repo",class:"w-full"},null,8,["modelValue"]),K.value?(i(),v("div",Fe,[s(l(M),{class:"w-3 h-3 mr-1.5 animate-spin"}),e[16]||(e[16]=t("span",{class:"text-xs"},"Analyzing repository...",-1))])):m.value&&!h.value?(i(),v("div",He,[t("span",{class:w(["text-xs px-2 py-0.5 rounded-full",m.value.is_template?"bg-lime-500/10 text-lime-400 border border-lime-500/20":"bg-blue-500/10 text-blue-400 border border-blue-500/20"])},d(m.value.is_template?"Template":"Repository"),3),m.value.framework!=="unknown"?(i(),v("span",Ne,d(m.value.framework),1)):g("",!0),m.value.recommended_php_version?(i(),v("span",Ue," PHP "+d(m.value.recommended_php_version),1)):g("",!0),W.value?g("",!0):(i(),v("span",Ae,d(m.value.is_template?"Will create new repo from template":"Will clone directly"),1))])):g("",!0),W.value&&m.value&&!h.value?(i(),v("div",Ee,[e[19]||(e[19]=t("p",{class:"text-sm text-zinc-400 mb-3"}," This repository belongs to someone else. How would you like to use it? ",-1)),t("div",Me,[t("button",{type:"button",onClick:e[3]||(e[3]=o=>a.value.fork=!0),class:w(["flex-1 p-3 rounded-lg border-2 transition-colors text-left",a.value.fork?"border-lime-500 bg-lime-500/10":"border-zinc-700 hover:border-zinc-600"])},[t("div",Ye,[s(l(he),{class:w(["w-4 h-4",a.value.fork?"text-lime-400":"text-zinc-400"])},null,8,["class"]),t("span",{class:w(["text-sm font-medium",a.value.fork?"text-lime-400":"text-white"])},"Fork",2)]),e[17]||(e[17]=t("p",{class:"text-xs text-zinc-500"}," Create a fork linked to the original repository ",-1))],2),t("button",{type:"button",onClick:e[4]||(e[4]=o=>a.value.fork=!1),class:w(["flex-1 p-3 rounded-lg border-2 transition-colors text-left",a.value.fork?"border-zinc-700 hover:border-zinc-600":"border-lime-500 bg-lime-500/10"])},[t("div",Ge,[s(l(ye),{class:w(["w-4 h-4",a.value.fork?"text-zinc-400":"text-lime-400"])},null,8,["class"]),t("span",{class:w(["text-sm font-medium",a.value.fork?"text-white":"text-lime-400"])},"Import",2)]),e[18]||(e[18]=t("p",{class:"text-xs text-zinc-500"}," Create an independent copy with no link to original ",-1))],2)])])):h.value&&a.value.template?(i(),v("div",Be,d(h.value),1)):g("",!0),C.recentTemplates.length>0?(i(),v("div",Ke,[e[20]||(e[20]=t("p",{class:"text-xs text-zinc-500 mb-2"},"Recent templates:",-1)),t("div",Qe,[(i(!0),v(A,null,Z(C.recentTemplates,o=>(i(),v("button",{key:o.id,type:"button",onClick:y=>ae(o),class:"px-2 py-1 text-xs bg-zinc-700 text-zinc-400 rounded hover:bg-zinc-600 hover:text-white transition-colors"},d(o.display_name),9,Ie))),128))])])):g("",!0)])]),x.value?(i(),v(A,{key:0},[e[44]||(e[44]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",We,[t("button",{type:"button",onClick:e[5]||(e[5]=o=>V.value=!V.value),class:"flex items-center gap-2 text-sm font-medium text-zinc-400 hover:text-white transition-colors"},[(i(),z(ce(V.value?l(pe):l(fe)),{class:"w-4 h-4"})),e[22]||(e[22]=u(" Configuration Options ",-1)),e[23]||(e[23]=t("span",{class:"text-xs text-zinc-500"},"(from template)",-1))]),V.value?(i(),v("div",Je,[t("div",Xe,[t("div",null,[e[24]||(e[24]=t("h3",{class:"text-sm font-medium text-white"},"PHP Version",-1)),t("p",Ze,[m.value?.min_php_version?(i(),v("span",et,"Minimum: PHP "+d(m.value.min_php_version)+"+",1)):(i(),v("span",tt,"Using latest PHP version"))])]),t("div",null,[s(l($),{modelValue:a.value.php_version,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.php_version=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select PHP version"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:null},{default:r(()=>[u(" Auto-detect ("+d(m.value?.recommended_php_version||"8.5")+") ",1)]),_:1}),s(l(c),{value:"8.5"},{default:r(()=>[u(" PHP 8.5"+d(m.value?.recommended_php_version==="8.5"?" (Recommended)":""),1)]),_:1}),s(l(c),{value:"8.4"},{default:r(()=>[u(" PHP 8.4"+d(m.value?.recommended_php_version==="8.4"?" (Recommended)":""),1)]),_:1}),s(l(c),{value:"8.3"},{default:r(()=>[u(" PHP 8.3"+d(m.value?.recommended_php_version==="8.3"?" (Recommended)":""),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",lt,[t("div",null,[e[26]||(e[26]=t("h3",{class:"text-sm font-medium text-white"},"Database",-1)),t("p",st,[e[25]||(e[25]=u(" Template default: ",-1)),t("span",at,d(k(x.value.db_driver)),1)])]),t("div",null,[s(l($),{modelValue:a.value.db_driver,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.db_driver=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select database"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:null},{default:r(()=>[u(" Keep Default ("+d(k(x.value.db_driver))+") ",1)]),_:1}),s(l(c),{value:"sqlite"},{default:r(()=>[...e[27]||(e[27]=[u("SQLite",-1)])]),_:1}),s(l(c),{value:"pgsql"},{default:r(()=>[...e[28]||(e[28]=[u("PostgreSQL",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",ot,[t("div",null,[e[30]||(e[30]=t("h3",{class:"text-sm font-medium text-white"},"Session",-1)),t("p",nt,[e[29]||(e[29]=u(" Template default: ",-1)),t("span",rt,d(k(x.value.session_driver)),1)])]),t("div",null,[s(l($),{modelValue:a.value.session_driver,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.session_driver=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select session driver"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:null},{default:r(()=>[u(" Keep Default ("+d(k(x.value.session_driver))+") ",1)]),_:1}),s(l(c),{value:"file"},{default:r(()=>[...e[31]||(e[31]=[u("File",-1)])]),_:1}),s(l(c),{value:"database"},{default:r(()=>[...e[32]||(e[32]=[u("Database",-1)])]),_:1}),s(l(c),{value:"redis"},{default:r(()=>[...e[33]||(e[33]=[u("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",it,[t("div",null,[e[35]||(e[35]=t("h3",{class:"text-sm font-medium text-white"},"Cache",-1)),t("p",ut,[e[34]||(e[34]=u(" Template default: ",-1)),t("span",dt,d(k(x.value.cache_driver)),1)])]),t("div",null,[s(l($),{modelValue:a.value.cache_driver,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.cache_driver=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select cache driver"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:null},{default:r(()=>[u(" Keep Default ("+d(k(x.value.cache_driver))+") ",1)]),_:1}),s(l(c),{value:"file"},{default:r(()=>[...e[36]||(e[36]=[u("File",-1)])]),_:1}),s(l(c),{value:"database"},{default:r(()=>[...e[37]||(e[37]=[u("Database",-1)])]),_:1}),s(l(c),{value:"redis"},{default:r(()=>[...e[38]||(e[38]=[u("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",vt,[t("div",null,[e[40]||(e[40]=t("h3",{class:"text-sm font-medium text-white"},"Queue",-1)),t("p",mt,[e[39]||(e[39]=u(" Template default: ",-1)),t("span",ct,d(k(x.value.queue_driver)),1)])]),t("div",null,[s(l($),{modelValue:a.value.queue_driver,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.queue_driver=o)},{default:r(()=>[s(l(q),{class:"w-full"},{default:r(()=>[s(l(L),{placeholder:"Select queue driver"})]),_:1}),s(l(R),null,{default:r(()=>[s(l(c),{value:null},{default:r(()=>[u(" Keep Default ("+d(k(x.value.queue_driver))+") ",1)]),_:1}),s(l(c),{value:"sync"},{default:r(()=>[...e[41]||(e[41]=[u("Sync",-1)])]),_:1}),s(l(c),{value:"database"},{default:r(()=>[...e[42]||(e[42]=[u("Database",-1)])]),_:1}),s(l(c),{value:"redis"},{default:r(()=>[...e[43]||(e[43]=[u("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])):g("",!0)])],64)):g("",!0),F.value?(i(),v("div",pt,[t("div",ft,[t("p",xt,d(F.value),1)])])):g("",!0),t("div",gt,[s(l(te),{"as-child":"",variant:"ghost"},{default:r(()=>[s(l(xe),{href:`/environments/${C.environment.id}/projects`},{default:r(()=>[...e[45]||(e[45]=[u(" Cancel ",-1)])]),_:1},8,["href"])]),_:1}),s(l(te),{type:"submit",disabled:!J.value,variant:"secondary"},{default:r(()=>[D.value?(i(),z(l(M),{key:0,class:"w-4 h-4 animate-spin"})):(i(),z(l(ge),{key:1,class:"w-4 h-4"})),e[46]||(e[46]=u(" Create Project ",-1))]),_:1},8,["disabled"])])],32)])],64))}});export{wt as default};
