import{d as z,j as I,y as O,c as m,g as o,a as r,u as t,h as H,w as d,b as a,C as P,l as S,p as $,m as _,f as p,t as v,z as T,A as k,r as y,s as h,F as A,o as c}from"./app-D43GO3N8.js";import{_ as B}from"./Heading.vue_vue_type_script_setup_true_lang-DMWrartX.js";import{X as u,Y as x,I as C}from"./craft-ui-aQagzPT3.js";import{T as R}from"./triangle-alert-DTrswVUG.js";const q={class:"mb-6"},M={class:"space-y-6"},X={key:0,class:"mt-2 text-sm text-red-400"},J={class:"flex items-center"},Y={class:"flex items-center"},K={class:"pl-6"},G={class:"space-y-6"},Q={class:"grid grid-cols-2 gap-4"},W={key:0,class:"mt-2 text-sm text-red-400"},Z={key:0,class:"mt-2 text-sm text-red-400"},ee={key:0,class:"mt-2 text-sm text-red-400"},te={class:"pt-6 border-t border-border"},se={class:"flex items-center"},re={class:"mt-2 text-sm text-muted-foreground"},oe={class:"font-mono text-foreground"},le={key:0,class:"mt-2 text-sm text-muted-foreground"},ne={key:1,class:"mt-2 text-sm text-amber-400 flex items-center"},ae={class:"mt-8 flex gap-3"},fe=z({__name:"Edit",props:{server:{}},setup(U){const i=U,s=I({name:i.server.name,host:i.server.host,user:i.server.user,port:i.server.port,is_local:i.server.is_local,external_access:i.server.external_access,external_host:i.server.external_host??""}),f=y(""),b=y(!0),g=y(null),w=y({}),V=h(()=>f.value||"test"),E=h(()=>{const n=f.value||"test";return Object.entries(w.value).filter(([e,l])=>l===n&&parseInt(e)!==i.server.id).map(([e])=>parseInt(e))}),N=h(()=>E.value.length>0),j=async()=>{try{const e=await(await fetch(`/environments/${i.server.id}/config`)).json();e.success&&e.data&&(g.value=e.data,f.value=e.data.tld||"test")}catch(n){console.error("Failed to load config:",n)}finally{b.value=!1}},D=async()=>{try{const e=await(await fetch("/api/environments/tlds")).json();e.success&&(w.value=e.data||{})}catch(n){console.error("Failed to load other server TLDs:",n)}},L=async()=>{const n=f.value.trim()||"test";if(!g.value)return{success:!1,error:"Config not loaded"};try{const e=await fetch(`/environments/${i.server.id}/config`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.content||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({paths:g.value.paths||[],tld:n,default_php_version:g.value.default_php_version||"8.4"})});if(!e.ok){const l=await e.text();try{return{success:!1,error:JSON.parse(l).message||"Request failed"}}catch{return{success:!1,error:`Server error: ${e.status}`}}}return await e.json()}catch(e){return{success:!1,error:e.message}}},F=async()=>{const n=await L();if(!n.success){alert("Failed to save TLD configuration: "+(n.error||"Unknown error"));return}s.put(`/environments/${i.server.id}`)};return O(()=>{j(),D()}),(n,e)=>(c(),m(A,null,[o(t(H),{title:"Edit Environment"}),r("div",null,[r("div",q,[o(t(S),{href:"/servers",class:"text-zinc-400 hover:text-white flex items-center transition-colors text-sm"},{default:d(()=>[o(t(P),{class:"w-4 h-4 mr-1"}),e[8]||(e[8]=a(" Back to Environments ",-1))]),_:1})]),o(B,{title:"Edit Environment"}),r("form",{onSubmit:$(F,["prevent"]),class:"mt-8 max-w-lg"},[r("div",M,[r("div",null,[o(t(u),{for:"name",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[9]||(e[9]=[a("Name",-1)])]),_:1}),o(t(x),{modelValue:t(s).name,"onUpdate:modelValue":e[0]||(e[0]=l=>t(s).name=l),type:"text",id:"name",required:"",class:"w-full"},null,8,["modelValue"]),t(s).errors.name?(c(),m("p",X,v(t(s).errors.name),1)):p("",!0)]),r("div",J,[_(r("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t(s).is_local=l),type:"checkbox",id:"is_local",class:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-lime-400 focus:ring-lime-400/20 focus:ring-offset-0"},null,512),[[T,t(s).is_local]]),o(t(u),{for:"is_local",class:"ml-2 text-muted-foreground"},{default:d(()=>[...e[10]||(e[10]=[a(" This is a local environment ",-1)])]),_:1})]),r("div",Y,[_(r("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t(s).external_access=l),type:"checkbox",id:"external_access",class:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-lime-400 focus:ring-lime-400/20 focus:ring-offset-0"},null,512),[[T,t(s).external_access]]),o(t(u),{for:"external_access",class:"ml-2 text-muted-foreground"},{default:d(()=>[...e[11]||(e[11]=[a(" External access (use SSH URLs for editor links) ",-1)])]),_:1})]),_(r("div",K,[o(t(u),{for:"external_host",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[12]||(e[12]=[a(" External Host / IP ",-1)])]),_:1}),o(t(x),{modelValue:t(s).external_host,"onUpdate:modelValue":e[3]||(e[3]=l=>t(s).external_host=l),type:"text",id:"external_host",placeholder:"e.g. 192.168.1.100 or myserver.example.com",class:"w-full"},null,8,["modelValue"]),e[13]||(e[13]=r("p",{class:"mt-1 text-xs text-muted-foreground"}," The hostname or IP address external users will use to connect via SSH ",-1))],512),[[k,t(s).external_access]]),_(r("div",G,[r("div",Q,[r("div",null,[o(t(u),{for:"host",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[14]||(e[14]=[a("Host",-1)])]),_:1}),o(t(x),{modelValue:t(s).host,"onUpdate:modelValue":e[4]||(e[4]=l=>t(s).host=l),type:"text",id:"host",class:"w-full"},null,8,["modelValue"]),t(s).errors.host?(c(),m("p",W,v(t(s).errors.host),1)):p("",!0)]),r("div",null,[o(t(u),{for:"port",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[15]||(e[15]=[a("Port",-1)])]),_:1}),o(t(x),{modelValue:t(s).port,"onUpdate:modelValue":e[5]||(e[5]=l=>t(s).port=l),type:"number",id:"port",class:"w-full"},null,8,["modelValue"]),t(s).errors.port?(c(),m("p",Z,v(t(s).errors.port),1)):p("",!0)])]),r("div",null,[o(t(u),{for:"user",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[16]||(e[16]=[a("SSH User",-1)])]),_:1}),o(t(x),{modelValue:t(s).user,"onUpdate:modelValue":e[6]||(e[6]=l=>t(s).user=l),type:"text",id:"user",class:"w-full"},null,8,["modelValue"]),t(s).errors.user?(c(),m("p",ee,v(t(s).errors.user),1)):p("",!0)])],512),[[k,!t(s).is_local]]),r("div",te,[e[20]||(e[20]=r("h3",{class:"text-sm font-medium text-foreground mb-4"},"DNS Configuration",-1)),r("div",null,[o(t(u),{for:"tld",class:"text-muted-foreground mb-2"},{default:d(()=>[...e[17]||(e[17]=[a(" TLD (Top-Level Domain) ",-1)])]),_:1}),r("div",se,[e[18]||(e[18]=r("span",{class:"text-muted-foreground mr-1"},".",-1)),o(t(x),{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=l=>f.value=l),type:"text",id:"tld",placeholder:"test",class:"w-32 font-mono"},null,8,["modelValue"])]),r("p",re,[e[19]||(e[19]=a(" Sites will be accessible at ",-1)),r("span",oe,"sitename."+v(V.value),1)]),b.value?(c(),m("p",le," Loading current TLD... ")):p("",!0),N.value?(c(),m("p",ne,[o(t(R),{class:"w-4 h-4 mr-1"}),a(" Another environment is using ."+v(V.value)+" - this may cause DNS conflicts ",1)])):p("",!0)])])]),r("div",ae,[o(t(C),{type:"submit",disabled:t(s).processing,variant:"secondary"},{default:d(()=>[...e[21]||(e[21]=[a(" Save Changes ",-1)])]),_:1},8,["disabled"]),o(t(C),{"as-child":"",variant:"ghost"},{default:d(()=>[o(t(S),{href:"/servers"},{default:d(()=>[...e[22]||(e[22]=[a("Cancel",-1)])]),_:1})]),_:1})])],32)])],64))}});export{fe as default};
