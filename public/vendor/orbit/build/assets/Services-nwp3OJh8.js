import{I as L,d as he,y as be,e as f,w as m,a as l,c as r,r as p,o as n,g as a,u as t,S as fe,F as _,i as W,f as z,s as F,t as y,J as ze,b as S,P as Se,k as _e,p as $e,m as xe,v as We,K as Qe,L as Je,M as x,N as Ye,B as Ge,h as Xe,n as te,O as Ze,Q as ye}from"./app-DZdISfWy.js";import{u as Ce}from"./services-9y3XRd4j.js";import{_ as le}from"./Modal.vue_vue_type_script_setup_true_lang-CLi2Fc-n.js";import{I as $,H as Ke,Y as N,_ as et,c as tt,k as ve,M as st,y as lt}from"./craft-ui-AiEoEllR.js";import{L as M}from"./loader-circle-ByYS-AX-.js";import{G as Pe}from"./globe-CZSp9DE1.js";import{_ as nt}from"./DnsSettings.vue_vue_type_script_setup_true_lang-X6ggpFou.js";import{C as at}from"./circle-alert-BNaJbVMK.js";import{E as it}from"./eye-DEN5ltx1.js";import{R as pe}from"./refresh-cw-BihquqIM.js";import{T as we}from"./trash-2-n33-04l6.js";import{X as ot}from"./x-CNgcYSa_.js";const ge=L("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const se=L("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const rt=L("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ct=L("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const me=L("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Me=L("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const ut=L("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const dt=L("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ke=L("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const vt=L("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),pt={class:"p-6"},mt={key:0,class:"py-12 text-center"},ft={key:1,class:"py-12 text-center"},gt={key:2,class:"space-y-8"},ht={key:0},bt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},yt={class:"flex items-start justify-between mb-2"},wt={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},kt={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},zt={class:"text-white font-medium mb-1"},St={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},_t=he({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(j,{emit:R}){const u=j,q=R,T=Ce(),V=p(!0),C=p([]),h=p(null),w=F(()=>u.getApiUrl("")),I=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],D=F(()=>{const c={core:[],php:[],database:[],utility:[]};return C.value.forEach(i=>{c[i.category]?c[i.category].push(i):c.utility.push(i)}),c}),A=async()=>{V.value=!0;try{const i=await(await fetch(u.getApiUrl("/services/available"))).json();i.success&&(C.value=i.data||[])}catch(c){console.error("Failed to fetch available services:",c)}finally{V.value=!1}},Q=async c=>{h.value=c;try{const i=await T.enableService(c,w.value);i?.success?(q("serviceEnabled",c),q("close")):alert("Failed to enable service: "+(i?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{h.value=null}},k=c=>{switch(c){case"core":return Pe;case"database":return se;case"php":return ge;case"utility":return Me;default:return fe}};return be(()=>{u.show&&A()}),(c,i)=>(n(),f(le,{show:j.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:i[0]||(i[0]=v=>c.$emit("close"))},{default:m(()=>[l("div",pt,[V.value?(n(),r("div",mt,[a(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),i[1]||(i[1]=l("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):C.value.length===0?(n(),r("div",ft,[a(t(fe),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),i[2]||(i[2]=l("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(n(),r("div",gt,[(n(),r(_,null,W(I,v=>(n(),r(_,{key:v.key},[D.value[v.key].length>0?(n(),r("div",ht,[l("h4",bt,y(v.label),1),l("div",xt,[(n(!0),r(_,null,W(D.value[v.key],g=>(n(),r("div",{key:g.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[l("div",null,[l("div",yt,[l("div",wt,[(n(),f(ze(k(g.category)),{class:"w-5 h-5"}))]),g.required?(n(),r("span",kt," Required ")):z("",!0)]),l("h5",zt,y(g.label),1),l("p",St,y(g.description),1)]),a(t($),{onClick:ne=>Q(g.name),disabled:h.value!==null,variant:"secondary",class:"w-full justify-center"},{default:m(()=>[h.value===g.name?(n(),r(_,{key:0},[a(t(M),{class:"w-4 h-4 animate-spin mr-2"}),i[3]||(i[3]=S(" Enabling... ",-1))],64)):(n(),r(_,{key:1},[a(t(Se),{class:"w-4 h-4 mr-2"}),i[4]||(i[4]=S(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):z("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),$t={class:"p-6"},Ct={key:0,class:"py-12 text-center"},Pt={key:1,class:"py-12 text-center"},Mt={key:2},Vt=["for"],At={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Ut={key:0,class:"relative"},Ft=["id","onUpdate:modelValue"],jt=["value"],Lt={key:1,class:"flex items-center"},Et={class:"ml-3 text-sm text-zinc-400"},Rt={key:2,class:"relative"},Ht=["id","type","onUpdate:modelValue","placeholder"],Nt=["onClick"],qt={key:3,class:"text-xs text-zinc-500"},Tt={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},It=he({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(j,{emit:R}){const u=j,q=R,T=p(!0),V=p(!1),C=p(null),h=p({}),w=p({}),I=F(()=>u.serviceName==="dns"),D=async()=>{if(u.serviceName){T.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/info`))).json();if(c.success&&c.data){C.value=c.data,h.value={...c.data.config};const i={};Object.entries(c.data.configSchema).forEach(([v,g])=>{g.secret&&(i[v]=!1)}),w.value=i}}catch(k){console.error("Failed to fetch service info:",k)}finally{T.value=!1}}},A=async()=>{if(u.serviceName){V.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":u.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:h.value})})).json();c.success?(q("configUpdated",u.serviceName),q("close")):alert("Failed to update configuration: "+(c.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{V.value=!1}}},Q=k=>{w.value[k]=!w.value[k]};return _e(()=>u.show,k=>{k&&u.serviceName?D():(C.value=null,h.value={})}),be(()=>{u.show&&u.serviceName&&D()}),(k,c)=>(n(),f(le,{show:j.show,title:C.value?`Configure ${C.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:c[1]||(c[1]=i=>k.$emit("close"))},{default:m(()=>[l("div",$t,[T.value?(n(),r("div",Ct,[a(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),c[2]||(c[2]=l("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!C.value&&!I.value?(n(),r("div",Pt,[a(t(at),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),c[3]||(c[3]=l("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):I.value?(n(),r("div",Mt,[a(nt,{"environment-id":j.environmentId},null,8,["environment-id"])])):(n(),r("form",{key:3,onSubmit:$e(A,["prevent"]),class:"space-y-6"},[(n(!0),r(_,null,W(C.value?.configSchema??{},(i,v)=>(n(),r("div",{key:v,class:"space-y-1.5"},[l("label",{for:v,class:"block text-sm font-medium text-zinc-300"},[S(y(i.label)+" ",1),i.secret?(n(),r("span",At,"Secret")):z("",!0)],8,Vt),i.enum?(n(),r("div",Ut,[xe(l("select",{id:v,"onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(n(!0),r(_,null,W(i.enum,g=>(n(),r("option",{key:g,value:g},y(g),9,jt))),128))],8,Ft),[[We,h.value[v]]]),c[4]||(c[4]=l("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[l("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[l("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):i.type==="boolean"?(n(),r("div",Lt,[a(t(Ke),{checked:h.value[v],"onUpdate:checked":g=>h.value[v]=g},null,8,["checked","onUpdate:checked"]),l("span",Et,y(h.value[v]?"Enabled":"Disabled"),1)])):(n(),r("div",Rt,[xe(l("input",{id:v,type:i.secret&&!w.value[v]?"password":i.type==="integer"?"number":"text","onUpdate:modelValue":g=>h.value[v]=g,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:i.default?.toString()},null,8,Ht),[[Qe,h.value[v]]]),i.secret?(n(),r("button",{key:0,type:"button",onClick:g=>Q(v),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[w.value[v]?(n(),f(t(ct),{key:0,class:"w-4 h-4"})):(n(),f(t(it),{key:1,class:"w-4 h-4"}))],8,Nt)):z("",!0)])),i.description?(n(),r("p",qt,y(i.description),1)):z("",!0)]))),128)),l("div",Tt,[a(t($),{type:"button",onClick:c[0]||(c[0]=i=>k.$emit("close")),variant:"outline"},{default:m(()=>[...c[5]||(c[5]=[S(" Cancel ",-1)])]),_:1}),a(t($),{type:"submit",disabled:V.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:m(()=>[V.value?(n(),f(t(M),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(n(),f(t(dt),{key:1,class:"w-4 h-4 mr-2"})),c[6]||(c[6]=S(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),Dt={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Bt={class:"text-sm text-zinc-500 mt-1"},Ot={class:"flex items-center gap-2"},Wt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Qt={key:1,class:"space-y-6"},Jt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Yt={class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},Gt={class:"flex items-center justify-between"},Xt={class:"text-sm font-medium text-zinc-100"},Zt={class:"divide-y divide-zinc-800/50"},Kt={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50"},es={class:"flex-1 min-w-0"},ts={class:"flex items-center gap-2 flex-wrap"},ss={class:"font-medium text-sm text-zinc-100"},ls={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-zinc-800/80 text-zinc-400 ring-1 ring-inset ring-zinc-700/50"},ns={class:"text-xs text-zinc-500 mt-0.5 truncate"},as={key:0,class:"text-zinc-600/70"},is={key:1,class:"text-zinc-500/70"},os={class:"flex items-center gap-2"},rs={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},cs={key:0,class:"px-4 py-3 bg-red-500/5"},us={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-3 py-2 flex items-center justify-between"},ds=["onClick"],vs={class:"flex flex-col max-h-[70vh]"},ps={class:"flex items-center gap-3 px-6 py-3 border-b border-zinc-800 bg-zinc-900/50"},ms={class:"flex-1 overflow-auto p-4 bg-black"},fs={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap"},gs={class:"p-6"},hs={key:0,class:"py-8 text-center"},bs={class:"grid grid-cols-2 gap-4"},xs={class:"grid grid-cols-2 gap-4"},ys={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},Fs=he({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(j){const R=j,u=Ce(),q=Ze(),T=Je(),V=F(()=>!!q.props.reverb?.enabled),C=p(!1);_e(T,s=>{V.value&&s==="failed"&&!C.value&&(C.value=!0,x.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const h=s=>R.remoteApiUrl?`${R.remoteApiUrl}${s}`:`/api/environments/${R.environment.id}${s}`,w=F(()=>h("")),I=document.querySelector('meta[name="csrf-token"]')?.content||"",D=F(()=>u.services),A=p(!1),Q=F(()=>u.servicesRunning),k=F(()=>u.servicesTotal),c=p(!1),i=p(null),v=p(!1),g=p(!1),ne=p(null),ae=p(!1),H=p(null),J=p(""),G=p(!1),Y=p(!1),ie=p(null);let E=null;const X=p(!1),oe=p(!1),Z=p(!1),re=p(""),b=p({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),ce={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:Pe,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:fe,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:se,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:se,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:se,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Me,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:vt,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker for production (orbit.ccc)",icon:me,category:"utility",required:!0},"horizon-dev":{name:"Laravel Horizon",description:"Queue worker for development (orbit-web.ccc)",icon:me,category:"utility",required:!0}};function K(s){return s==="caddy"||s.startsWith("php-")||s==="horizon"||s==="horizon-dev"?"host":"docker"}function Ve(s){if(ce[s])return ce[s];if(s.startsWith("php-")){const e=s.replace("php-","");let o=e;return e.length===2&&!e.includes(".")&&(o=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${o}`,description:"Native PHP-FPM service",icon:ge,category:"php"}}return{name:s,description:"Service",icon:ge,category:"utility"}}const Ae=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],ee=F(()=>{const s={core:[],php:[],database:[],utility:[]};for(const[e,o]of Object.entries(D.value)){const d=Ve(e);s[d.category].push({key:e,service:o,meta:d})}return s.php.sort((e,o)=>e.key.localeCompare(o.key)),s}),Ue=F(()=>Q.value===0);function Fe(s){if(!s.startsWith("php-"))return null;const e=s.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const je=F(()=>{const s=ee.value.php.map(({key:e})=>Fe(e)).filter(e=>e!==null);return s.length===0?null:(s.sort((e,o)=>{const[d,P]=e.split(".").map(Number),[U,O]=o.split(".").map(Number);return d!==U?d-U:P-O}),s[s.length-1])});async function Le(){const s=je.value;if(!s){x.error("No PHP services detected");return}re.value=s,oe.value=!0,X.value=!0;try{const e=await fetch(h(`/php/config/${s}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const o=await e.json();o.success&&o.data?.settings&&(b.value={...b.value,...o.data.settings})}catch(e){x.error(`Error loading PHP settings: ${e}`)}finally{oe.value=!1}}async function Ee(){Z.value=!0;try{const s=await fetch(h(`/php/config/${re.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b.value)});if(!s.ok)throw new Error("Failed to save PHP settings");const e=await s.json();e.success?(x.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),X.value=!1):x.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(s){x.error("Error Saving PHP Settings",{description:String(s)})}finally{Z.value=!1}}async function B(s=!1){s||(A.value=!0);try{await u.fetchServices(w.value)}finally{s||(A.value=!1)}}async function Re(){i.value="stop-all";try{const s=await u.stopAll(w.value);s.success?(x.success("Services Stopping",{description:"All services are being stopped."}),await B(!0)):x.error("Failed to Stop Services",{description:s.error||"An unknown error occurred."})}catch{x.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{i.value=null}}async function He(){c.value=!0,i.value="restart-all";try{const s=await u.restartAll(w.value);s.success?(x.success("Services Restarting",{description:"All services are being restarted."}),await B(!0)):x.error("Failed to Restart Services",{description:s.error||"An unknown error occurred."})}catch{x.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{c.value=!1,i.value=null}}async function ue(s,e){const o=K(s);try{let d;e==="start"?d=await u.startService(s,w.value,o):e==="stop"?d=await u.stopService(s,w.value,o):d=await u.restartService(s,w.value,o),d?.success?d.jobId||await B(!0):x.error(`Failed to ${e} ${s}: `+(d?.error||"Unknown error"))}catch{x.error(`Failed to ${e} ${s}`)}}async function Ne(s){if(confirm(`Are you sure you want to remove ${s}?`))try{const e=await u.disableService(s,w.value);e?.success?(x.success(`${s} disabled`),await B(!0)):x.error("Failed to remove service: "+(e?.error||"Unknown error"))}catch{x.error("Failed to remove service")}}function qe(s){ne.value=s,g.value=!0}async function Te(s){H.value=s,ae.value=!0,await de()}async function de(){if(H.value){G.value=!0;try{const e=K(H.value)==="host"?`/host-services/${H.value}/logs`:`/services/${H.value}/logs`,d=await(await fetch(h(e))).json();d.success?J.value=d.logs||"No logs available":J.value="Failed to fetch logs: "+(d.error||"Unknown error")}catch{J.value="Failed to fetch logs"}finally{G.value=!1}}}function Ie(){ae.value=!1,H.value=null,J.value="",Y.value=!1,ie.value=null,E&&(clearInterval(E),E=null)}function De(){ie.value=new Date,J.value=`--- Logs cleared at ${ie.value.toLocaleTimeString()} ---

Refresh to see new logs.`}function Be(){Y.value=!Y.value,Y.value?E=setInterval(de,3e3):E&&(clearInterval(E),E=null)}function Oe(s){return s.icon}return V.value&&Ye("orbit",".service.status.changed",s=>{u.handleServiceStatusChanged(s.job_id,s.service,s.status,s.error),s.error?x.error(`Failed to ${s.action} ${s.service}: ${s.error}`):x.success(`${s.service} ${s.action} completed`)}),be(async()=>{u.setActiveEnvironment(R.environment.id),u.isStale&&B(),u.recoverPendingJobs(w.value)}),Ge(()=>{E&&clearInterval(E)}),(s,e)=>(n(),r(_,null,[a(t(Xe),{title:`Services - ${j.environment.name}`},null,8,["title"]),l("div",null,[l("header",Dt,[l("div",null,[e[15]||(e[15]=l("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Services",-1)),l("p",Bt,[A.value?(n(),r(_,{key:0},[S("Loading services...")],64)):(n(),r(_,{key:1},[S(y(Q.value)+"/"+y(k.value)+" services running",1)],64))])]),l("div",Ot,[a(t($),{onClick:e[0]||(e[0]=o=>v.value=!0),disabled:A.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:m(()=>[a(t(Se),{class:"w-4 h-4 mr-1.5"}),e[16]||(e[16]=S(" Add Service ",-1))]),_:1},8,["disabled"]),Ue.value?z("",!0):(n(),f(t($),{key:0,onClick:Re,disabled:A.value||i.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[i.value==="stop-all"?(n(),f(t(M),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(n(),f(t(ke),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[17]||(e[17]=S(" Stop All ",-1))]),_:1},8,["disabled"])),a(t($),{onClick:He,disabled:A.value||i.value!==null,variant:"secondary",size:"sm"},{default:m(()=>[c.value?(n(),f(t(M),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(n(),f(t(pe),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[18]||(e[18]=S(" Restart All ",-1))]),_:1},8,["disabled"])])]),A.value?(n(),r("div",Wt,[a(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[19]||(e[19]=l("p",{class:"text-zinc-500"},"Loading services...",-1))])):(n(),r("div",Qt,[(n(),r(_,null,W(Ae,o=>(n(),r(_,{key:o.key},[ee.value[o.key].length>0?(n(),r("div",Jt,[l("div",Yt,[l("div",Gt,[l("h2",Xt,y(o.label),1),o.key==="php"?(n(),f(t($),{key:0,onClick:Le,variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-zinc-100",title:"PHP Settings"},{default:m(()=>[a(t(ye),{class:"w-4 h-4"})]),_:1})):z("",!0)])]),l("div",Zt,[(n(!0),r(_,null,W(ee.value[o.key],({key:d,service:P,meta:U})=>(n(),r("div",{key:d,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},[l("div",Kt,[(n(),f(ze(Oe(U)),{class:"h-4 w-4 text-zinc-400"}))]),l("div",es,[l("div",ts,[l("span",ss,y(U.name),1),P.required||U.required?(n(),r("span",ls," Required ")):z("",!0),l("span",{class:te(["px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full ring-1 ring-inset",K(d)==="docker"?"bg-blue-500/10 text-blue-400 ring-blue-500/20":"bg-lime-500/10 text-lime-400 ring-lime-500/20"])},y(K(d)),3),l("span",{class:te(["h-2 w-2 rounded-full",P.status==="running"?"bg-lime-400":P.status==="stopped"?"bg-zinc-600":"bg-red-400"])},null,2)]),l("p",ns,[S(y(U.description)+" ",1),U.ports?(n(),r("span",as," Â· ")):z("",!0),U.ports?(n(),r("span",is,y(U.ports),1)):z("",!0)])]),l("div",os,[l("span",{class:te(["px-2.5 py-1 text-xs font-medium rounded-full ring-1 ring-inset",P.status==="running"?"bg-lime-500/15 text-lime-400 ring-lime-500/30":P.status==="stopped"?"bg-zinc-800 text-zinc-400 ring-zinc-700":"bg-red-500/15 text-red-400 ring-red-500/30"])},y(P.status==="running"?"Running":P.status==="stopped"?"Stopped":"Error"),3),l("div",rs,[P.status!=="running"?(n(),f(t($),{key:0,onClick:O=>ue(d,"start"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Start"},{default:m(()=>[t(u).isServicePending(d)?(n(),f(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(t(ut),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):z("",!0),P.status==="running"?(n(),f(t($),{key:1,onClick:O=>ue(d,"stop"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",title:"Stop"},{default:m(()=>[t(u).isServicePending(d)?(n(),f(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(t(ke),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):z("",!0),a(t($),{onClick:O=>ue(d,"restart"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800",title:"Restart"},{default:m(()=>[t(u).isServicePending(d)?(n(),f(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(n(),f(t(pe),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"]),a(t(lt),null,{default:m(()=>[a(t(et),{"as-child":""},{default:m(()=>[a(t($),{variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800"},{default:m(()=>[a(t(rt),{class:"w-4 h-4"})]),_:1})]),_:1}),a(t(tt),{align:"end",class:"w-40"},{default:m(()=>[a(t(ve),{onClick:O=>qe(d)},{default:m(()=>[a(t(ye),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=S(" Settings ",-1))]),_:1},8,["onClick"]),a(t(ve),{onClick:O=>Te(d)},{default:m(()=>[a(t(me),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=S(" View Logs ",-1))]),_:1},8,["onClick"]),!P.required&&!U.required?(n(),r(_,{key:0},[a(t(st)),a(t(ve),{onClick:O=>Ne(d),disabled:t(u).isServicePending(d),class:"text-red-400 focus:text-red-400"},{default:m(()=>[a(t(we),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=S(" Remove ",-1))]),_:1},8,["onClick","disabled"])],64)):z("",!0)]),_:2},1024)]),_:2},1024)])])]))),128)),(n(!0),r(_,null,W(ee.value[o.key],({key:d})=>(n(),r(_,{key:`error-${d}`},[t(u).getServiceError(d)?(n(),r("div",cs,[l("div",us,[l("span",null,"Error: "+y(t(u).getServiceError(d)),1),l("button",{onClick:P=>t(u).clearServiceError(d),class:"text-red-400 hover:text-white ml-2"},[a(t(ot),{class:"w-3 h-3"})],8,ds)])])):z("",!0)],64))),128))])])):z("",!0)],64))),64))])),a(_t,{show:v.value,"get-api-url":h,"csrf-token":t(I),onClose:e[1]||(e[1]=o=>v.value=!1),onServiceEnabled:e[2]||(e[2]=()=>B())},null,8,["show","csrf-token"]),a(It,{show:g.value,"service-name":ne.value,"environment-id":j.environment.id,"get-api-url":h,"csrf-token":t(I),onClose:e[3]||(e[3]=o=>g.value=!1),onConfigUpdated:e[4]||(e[4]=()=>B())},null,8,["show","service-name","environment-id","csrf-token"]),a(le,{show:ae.value,title:`${ce[H.value]?.name||H.value} Logs`,maxWidth:"max-w-4xl",onClose:Ie},{default:m(()=>[l("div",vs,[l("div",ps,[a(t($),{onClick:de,disabled:G.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:m(()=>[G.value?(n(),f(t(M),{key:0,class:"w-4 h-4 animate-spin"})):(n(),f(t(pe),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),a(t($),{onClick:De,disabled:G.value,variant:"ghost",size:"icon-sm",title:"Clear logs display"},{default:m(()=>[a(t(we),{class:"w-4 h-4"})]),_:1},8,["disabled"]),l("button",{onClick:Be,class:te(["text-xs px-2 py-1 rounded-full",Y.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},y(Y.value?"Auto-refresh ON":"Auto-refresh"),3)]),l("div",ms,[l("pre",fs,y(J.value),1)])])]),_:1},8,["show","title"]),a(le,{show:X.value,title:`PHP ${re.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=o=>X.value=!1)},{default:m(()=>[l("div",gs,[oe.value?(n(),r("div",hs,[a(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[23]||(e[23]=l("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(n(),r("form",{key:1,onSubmit:$e(Ee,["prevent"]),class:"space-y-6"},[l("div",null,[e[28]||(e[28]=l("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),l("div",bs,[l("div",null,[e[24]||(e[24]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),a(t(N),{modelValue:b.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=o=>b.value.upload_max_filesize=o),class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[25]||(e[25]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),a(t(N),{modelValue:b.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value.post_max_size=o),class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[26]||(e[26]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),a(t(N),{modelValue:b.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=o=>b.value.memory_limit=o),class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),a(t(N),{modelValue:b.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=o=>b.value.max_execution_time=o),class:"w-full font-mono"},null,8,["modelValue"])])])]),l("div",null,[e[33]||(e[33]=l("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),l("div",xs,[l("div",null,[e[29]||(e[29]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),a(t(N),{modelValue:b.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value.max_children=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[30]||(e[30]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),a(t(N),{modelValue:b.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value.start_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[31]||(e[31]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),a(t(N),{modelValue:b.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=o=>b.value.min_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),l("div",null,[e[32]||(e[32]=l("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),a(t(N),{modelValue:b.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=o=>b.value.max_spare_servers=o),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),l("div",ys,[a(t($),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=o=>X.value=!1)},{default:m(()=>[...e[34]||(e[34]=[S(" Cancel ",-1)])]),_:1}),a(t($),{type:"submit",variant:"secondary",disabled:Z.value},{default:m(()=>[Z.value?(n(),f(t(M),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),S(" "+y(Z.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{Fs as default};
