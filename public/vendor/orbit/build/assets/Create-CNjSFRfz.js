import{d as $,r as _,k as O,z,m as U,a as r,h as a,b as s,u as t,i as M,w as c,e as u,C as X,l as K,n as j,g as d,q as F,t as m,f as y,o,S as Y,s as T,v as W,F as V,j as q,A as J,y as G}from"./app-DiMZxkRm.js";import{_ as Q}from"./Heading.vue_vue_type_script_setup_true_lang-eZQjLc_c.js";import{X as w,Y as S,I as b}from"./craft-ui-CGsjg9tx.js";import{L as A}from"./loader-circle-CyQlpWW1.js";import{C as B}from"./circle-check-big-DEeGtdYn.js";import{C as Z}from"./circle-alert-CR3SfrDI.js";const ee={class:"mb-6"},te={class:"mb-8"},se={class:"inline-flex rounded-lg bg-zinc-800 p-1"},le=["disabled"],oe={key:0,class:"ml-1 text-xs"},re={class:"space-y-6"},ne={key:0,class:"mt-2 text-sm text-red-400"},ae={class:"mt-8 flex gap-3"},ie={class:"space-y-6"},ue={key:0,class:"mt-2 text-sm text-red-400"},de={key:0,class:"mt-2 text-sm text-red-400"},me={key:0,class:"mt-2 text-sm text-red-400"},ce={key:0},ve={key:1,class:"p-4 bg-lime-400/10 border border-lime-400/20 rounded-lg"},pe={class:"flex items-start"},he={class:"flex-1"},fe={class:"mt-1 text-sm text-zinc-400"},ye={key:0},be={key:2,class:"p-4 bg-blue-400/10 border border-blue-400/20 rounded-lg"},xe={class:"flex items-start"},ke={class:"flex-1"},ge={class:"text-sm font-medium text-blue-400"},_e={key:3,class:"p-4 bg-red-400/10 border border-red-400/20 rounded-lg"},we={class:"flex items-start"},Ce={class:"flex-1"},Se={class:"mt-1 text-sm text-zinc-400"},ze={key:4},Ke={key:0,label:"Saved Keys"},Ve=["value"],Ae={key:1,label:"Import from ~/.ssh/"},Ee=["value"],Le={key:2,class:"mt-2 text-sm text-red-400"},Ne={key:0,class:"mt-8 p-4 bg-yellow-400/10 border border-yellow-400/20 rounded-lg"},Oe={class:"mt-8 flex gap-3"},Ie=$({__name:"Create",props:{currentUser:{},sshKeys:{},availableSshKeys:{},hasLocalEnvironment:{type:Boolean}},setup(p){const h=p,x=_(h.hasLocalEnvironment?"remote":"local"),E=z(()=>h.sshKeys.find(e=>e.is_default)?.public_key||h.sshKeys[0]?.public_key||""),f=O({name:"Local",host:"localhost",user:h.currentUser,port:22,is_local:!0}),l=O({name:"",host:"",user:"root",ssh_public_key:E.value}),L=z(()=>h.sshKeys.length>0||Object.keys(h.availableSshKeys).length>0),C=_(E.value),I=z(()=>!L.value||C.value==="custom");U(C,v=>{v&&v!=="custom"?l.ssh_public_key=v:v==="custom"&&(l.ssh_public_key="")});const k=_(!1),i=_(null),g=_(!1);U([()=>l.host,()=>l.user],()=>{i.value=null,g.value=!1});const P=async()=>{if(l.host){k.value=!0,i.value=null;try{const v=await fetch("/provision/check-server",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({host:l.host,user:l.user})});i.value=await v.json(),g.value=!0}catch{i.value={has_orbit:!1,has_orbit_user:!1,orbit_running:!1,can_connect:!1,connected_as:null,error:"Failed to check server connection"},g.value=!0}finally{k.value=!1}}},D=()=>{G.post("/servers",{name:l.name,host:l.host,user:i.value?.connected_as==="launchpad"?"launchpad":l.user,port:22,is_local:!1})},H=()=>{f.post("/servers")},R=()=>{l.post("/provision")};return(v,e)=>(o(),r(V,null,[a(t(M),{title:"Add Environment"}),s("div",null,[s("div",ee,[a(t(K),{href:"/servers",class:"text-zinc-400 hover:text-white flex items-center transition-colors text-sm"},{default:c(()=>[a(t(X),{class:"w-4 h-4 mr-1"}),e[9]||(e[9]=u(" Back to Environments ",-1))]),_:1})]),a(Q,{title:"Add Environment"}),e[29]||(e[29]=s("p",{class:"text-zinc-400 mb-8 mt-2"}," Add a local or remote environment to manage development projects. ",-1)),s("div",te,[s("div",se,[s("button",{type:"button",onClick:e[0]||(e[0]=n=>x.value="local"),disabled:p.hasLocalEnvironment,class:j(["px-4 py-1.5 text-sm font-medium rounded-md transition-colors",x.value==="local"?"bg-zinc-600 text-white":p.hasLocalEnvironment?"text-zinc-600 cursor-not-allowed":"text-zinc-400 hover:text-white"])},[e[10]||(e[10]=u(" Local ",-1)),p.hasLocalEnvironment?(o(),r("span",oe,"(configured)")):d("",!0)],10,le),s("button",{type:"button",onClick:e[1]||(e[1]=n=>x.value="remote"),class:j(["px-4 py-1.5 text-sm font-medium rounded-md transition-colors",x.value==="remote"?"bg-zinc-600 text-white":"text-zinc-400 hover:text-white"])}," Remote ",2)])]),x.value==="local"?(o(),r("form",{key:0,onSubmit:F(H,["prevent"]),class:"max-w-lg"},[s("div",re,[s("div",null,[a(t(w),{for:"local-name",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[11]||(e[11]=[u(" Environment Name ",-1)])]),_:1}),a(t(S),{modelValue:t(f).name,"onUpdate:modelValue":e[2]||(e[2]=n=>t(f).name=n),type:"text",id:"local-name",required:"",placeholder:"Local",class:"w-full"},null,8,["modelValue"]),t(f).errors.name?(o(),r("p",ne,m(t(f).errors.name),1)):d("",!0)])]),s("div",ae,[a(t(b),{type:"submit",disabled:t(f).processing,variant:"secondary"},{default:c(()=>[...e[12]||(e[12]=[u(" Add ",-1)])]),_:1},8,["disabled"]),a(t(b),{"as-child":"",variant:"ghost"},{default:c(()=>[a(t(K),{href:"/servers"},{default:c(()=>[...e[13]||(e[13]=[u(" Cancel ",-1)])]),_:1})]),_:1})])],32)):(o(),r("form",{key:1,onSubmit:F(R,["prevent"]),class:"max-w-lg"},[s("div",ie,[s("div",null,[a(t(w),{for:"remote-name",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[14]||(e[14]=[u(" Environment Name ",-1)])]),_:1}),a(t(S),{modelValue:t(l).name,"onUpdate:modelValue":e[3]||(e[3]=n=>t(l).name=n),type:"text",id:"remote-name",required:"",placeholder:"Production",class:"w-full"},null,8,["modelValue"]),t(l).errors.name?(o(),r("p",ue,m(t(l).errors.name),1)):d("",!0)]),s("div",null,[a(t(w),{for:"host",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[15]||(e[15]=[u(" Host IP Address ",-1)])]),_:1}),a(t(S),{modelValue:t(l).host,"onUpdate:modelValue":e[4]||(e[4]=n=>t(l).host=n),type:"text",id:"host",required:"",placeholder:"192.168.1.100",class:"w-full"},null,8,["modelValue"]),t(l).errors.host?(o(),r("p",de,m(t(l).errors.host),1)):d("",!0)]),s("div",null,[a(t(w),{for:"user",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[16]||(e[16]=[u(" SSH User ",-1)])]),_:1}),a(t(S),{modelValue:t(l).user,"onUpdate:modelValue":e[5]||(e[5]=n=>t(l).user=n),type:"text",id:"user",required:"",placeholder:"root",class:"w-full"},null,8,["modelValue"]),e[17]||(e[17]=s("p",{class:"mt-2 text-sm text-muted-foreground"}," User must have sudo privileges for provisioning ",-1)),t(l).errors.user?(o(),r("p",me,m(t(l).errors.user),1)):d("",!0)]),t(l).host&&!g.value?(o(),r("div",ce,[a(t(b),{type:"button",onClick:P,disabled:k.value,variant:"outline",class:"w-full"},{default:c(()=>[k.value?(o(),y(t(A),{key:0,class:"w-4 h-4 animate-spin"})):(o(),y(t(Y),{key:1,class:"w-4 h-4"})),u(" "+m(k.value?"Checking server...":"Check Server"),1)]),_:1},8,["disabled"])])):d("",!0),i.value?.has_orbit?(o(),r("div",ve,[s("div",pe,[a(t(B),{class:"w-5 h-5 text-lime-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",he,[e[18]||(e[18]=s("p",{class:"text-sm font-medium text-lime-400"}," Orbit is already configured on this server! ",-1)),s("p",fe,[u(" Status: "+m(i.value.orbit_running?"Running":"Not running")+" ",1),i.value.status?.projects?.length?(o(),r("span",ye," · "+m(i.value.status.projects.length)+" project(s)",1)):d("",!0)]),e[19]||(e[19]=s("p",{class:"mt-2 text-sm text-zinc-500"}," You can add this environment without re-provisioning. ",-1))])])])):i.value?.can_connect&&!i.value?.has_orbit?(o(),r("div",be,[s("div",xe,[a(t(B),{class:"w-5 h-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",ke,[s("p",ge," Connected successfully as "+m(i.value.connected_as),1),e[20]||(e[20]=s("p",{class:"mt-1 text-sm text-zinc-400"}," Orbit is not installed on this server. Provisioning will set it up. ",-1))])])])):i.value?.error?(o(),r("div",_e,[s("div",we,[a(t(Z),{class:"w-5 h-5 text-red-400 mr-3 mt-0.5 flex-shrink-0"}),s("div",Ce,[e[21]||(e[21]=s("p",{class:"text-sm font-medium text-red-400"},"Connection Failed",-1)),s("p",Se,m(i.value.error),1),s("button",{type:"button",onClick:e[6]||(e[6]=n=>g.value=!1),class:"mt-2 text-sm text-zinc-400 hover:text-white transition-colors"}," Try again ")])])])):d("",!0),i.value?.has_orbit?d("",!0):(o(),r("div",ze,[a(t(w),{for:"ssh_public_key",class:"text-muted-foreground mb-2"},{default:c(()=>[...e[22]||(e[22]=[u(" SSH Public Key ",-1)])]),_:1}),L.value?T((o(),r("select",{key:0,"onUpdate:modelValue":e[7]||(e[7]=n=>C.value=n),class:"w-full"},[e[23]||(e[23]=s("option",{value:""},"Select a key...",-1)),p.sshKeys.length>0?(o(),r("optgroup",Ke,[(o(!0),r(V,null,q(p.sshKeys,n=>(o(),r("option",{key:n.id,value:n.public_key},m(n.name)+" ("+m(n.key_type)+")"+m(n.is_default?" ★":""),9,Ve))),128))])):d("",!0),Object.keys(p.availableSshKeys).length>0?(o(),r("optgroup",Ae,[(o(!0),r(V,null,q(p.availableSshKeys,(n,N)=>(o(),r("option",{key:N,value:n.content},m(N)+" ("+m(n.type)+") ",9,Ee))),128))])):d("",!0),e[24]||(e[24]=s("option",{value:"custom"},"Enter custom key...",-1))],512)),[[W,C.value]]):d("",!0),I.value?T((o(),r("textarea",{key:1,"onUpdate:modelValue":e[8]||(e[8]=n=>t(l).ssh_public_key=n),id:"ssh_public_key",rows:"3",required:"",placeholder:"ssh-rsa AAAA...",class:"w-full mt-2 font-mono text-sm"},null,512)),[[J,t(l).ssh_public_key]]):d("",!0),e[25]||(e[25]=s("p",{class:"mt-2 text-sm text-muted-foreground"}," This key will be added to the launchpad user on the remote machine ",-1)),t(l).errors.ssh_public_key?(o(),r("p",Le,m(t(l).errors.ssh_public_key),1)):d("",!0)]))]),i.value?.has_orbit?d("",!0):(o(),r("div",Ne,[...e[26]||(e[26]=[s("p",{class:"text-sm text-yellow-400"},[s("strong",null,"Note:"),u(" We'll first check if Orbit is already installed. If not, provisioning will make these changes: ")],-1),s("ul",{class:"mt-2 text-sm text-zinc-400 list-disc list-inside space-y-1"},[s("li",null,[u(" Create a "),s("code",{class:"bg-zinc-800 px-1 rounded text-zinc-300"},"launchpad"),u(" user with sudo access ")]),s("li",null,"Disable SSH password authentication"),s("li",null,"Disable root SSH login"),s("li",null,"Install Docker"),s("li",null,"Install and initialize Orbit")],-1)])])),s("div",Oe,[i.value?.has_orbit?(o(),y(t(b),{key:0,type:"button",onClick:D,disabled:t(l).processing||!t(l).name,variant:"secondary"},{default:c(()=>[t(l).processing?(o(),y(t(A),{key:0,class:"w-4 h-4 animate-spin"})):d("",!0),e[27]||(e[27]=u(" Add ",-1))]),_:1},8,["disabled"])):(o(),y(t(b),{key:1,type:"submit",disabled:t(l).processing,variant:"secondary"},{default:c(()=>[t(l).processing?(o(),y(t(A),{key:0,class:"w-4 h-4 animate-spin"})):d("",!0),u(" "+m(t(l).processing?"Setting up...":"Provision"),1)]),_:1},8,["disabled"])),a(t(b),{"as-child":"",variant:"ghost"},{default:c(()=>[a(t(K),{href:"/servers"},{default:c(()=>[...e[28]||(e[28]=[u(" Cancel ",-1)])]),_:1})]),_:1})])],32))])],64))}});export{Ie as default};
