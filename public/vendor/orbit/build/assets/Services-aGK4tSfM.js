import{I as E,d as fe,y as ge,e as p,w as g,a as s,c as o,r as m,o as l,g as i,u as t,S as pe,F as _,i as W,f as z,s as F,t as y,J as we,b as S,P as ke,k as ze,p as Se,m as he,v as De,K as Be,L as Oe,M as x,N as We,B as Je,h as Qe,n as te,O as Ye,Q as be}from"./app-BnAW4W7n.js";import{u as _e}from"./services-BbltWuMO.js";import{_ as ne}from"./Modal.vue_vue_type_script_setup_true_lang-yh--R97d.js";import{I as $,H as Ge,Y as N,_ as Xe,c as Ze,k as de,M as Ke,y as et}from"./craft-ui-DhFXzGOb.js";import{L as M}from"./loader-circle-0KoIL4oR.js";import{G as $e}from"./globe-CzzsB_uK.js";import{_ as tt}from"./DnsSettings.vue_vue_type_script_setup_true_lang-DLvovycE.js";import{C as st}from"./circle-alert-DffoSCLm.js";import{E as nt}from"./eye-BEbbDPfj.js";import{R as ve}from"./refresh-cw-CUgUAuYH.js";import{T as lt}from"./trash-2-CFCB31-K.js";import{X as at}from"./x-CbyLY8Lc.js";const me=E("container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);const se=E("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const it=E("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const rt=E("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const xe=E("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Ce=E("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);const ot=E("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const ct=E("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ye=E("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const ut=E("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),dt={class:"p-6"},vt={key:0,class:"py-12 text-center"},pt={key:1,class:"py-12 text-center"},mt={key:2,class:"space-y-8"},ft={key:0},gt={class:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-4 px-1"},ht={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},bt={class:"flex items-start justify-between mb-2"},xt={class:"w-10 h-10 rounded-lg bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:text-lime-400 group-hover:bg-lime-400/10 transition-colors"},yt={key:0,class:"text-[10px] font-bold uppercase tracking-tight px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-500 border border-zinc-700"},wt={class:"text-white font-medium mb-1"},kt={class:"text-sm text-zinc-500 line-clamp-2 mb-4"},zt=fe({__name:"AddServiceModal",props:{show:{type:Boolean},getApiUrl:{type:Function},csrfToken:{}},emits:["close","serviceEnabled"],setup(j,{emit:L}){const u=j,q=L,I=_e(),V=m(!0),C=m([]),h=m(null),w=F(()=>u.getApiUrl("")),T=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],D=F(()=>{const c={core:[],php:[],database:[],utility:[]};return C.value.forEach(a=>{c[a.category]?c[a.category].push(a):c.utility.push(a)}),c}),A=async()=>{V.value=!0;try{const a=await(await fetch(u.getApiUrl("/services/available"))).json();a.success&&(C.value=a.data||[])}catch(c){console.error("Failed to fetch available services:",c)}finally{V.value=!1}},J=async c=>{h.value=c;try{const a=await I.enableService(c,w.value);a?.success?(q("serviceEnabled",c),q("close")):alert("Failed to enable service: "+(a?.error||"Unknown error"))}catch{alert("Failed to enable service")}finally{h.value=null}},k=c=>{switch(c){case"core":return $e;case"database":return se;case"php":return me;case"utility":return Ce;default:return pe}};return ge(()=>{u.show&&A()}),(c,a)=>(l(),p(ne,{show:j.show,title:"Add Service",maxWidth:"max-w-2xl",onClose:a[0]||(a[0]=v=>c.$emit("close"))},{default:g(()=>[s("div",dt,[V.value?(l(),o("div",vt,[i(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),a[1]||(a[1]=s("p",{class:"text-zinc-500"},"Discovering available services...",-1))])):C.value.length===0?(l(),o("div",pt,[i(t(pe),{class:"w-8 h-8 mx-auto text-zinc-700 mb-3"}),a[2]||(a[2]=s("p",{class:"text-zinc-500"},"No additional services available at this time.",-1))])):(l(),o("div",mt,[(l(),o(_,null,W(T,v=>(l(),o(_,{key:v.key},[D.value[v.key].length>0?(l(),o("div",ft,[s("h4",gt,y(v.label),1),s("div",ht,[(l(!0),o(_,null,W(D.value[v.key],f=>(l(),o("div",{key:f.name,class:"p-4 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-zinc-800/50 hover:border-zinc-700 transition-all group flex flex-col justify-between"},[s("div",null,[s("div",bt,[s("div",xt,[(l(),p(we(k(f.category)),{class:"w-5 h-5"}))]),f.required?(l(),o("span",yt," Required ")):z("",!0)]),s("h5",wt,y(f.label),1),s("p",kt,y(f.description),1)]),i(t($),{onClick:le=>J(f.name),disabled:h.value!==null,variant:"secondary",class:"w-full justify-center"},{default:g(()=>[h.value===f.name?(l(),o(_,{key:0},[i(t(M),{class:"w-4 h-4 animate-spin mr-2"}),a[3]||(a[3]=S(" Enabling... ",-1))],64)):(l(),o(_,{key:1},[i(t(ke),{class:"w-4 h-4 mr-2"}),a[4]||(a[4]=S(" Add Service ",-1))],64))]),_:2},1032,["onClick","disabled"])]))),128))])])):z("",!0)],64))),64))]))])]),_:1},8,["show"]))}}),St={class:"p-6"},_t={key:0,class:"py-12 text-center"},$t={key:1,class:"py-12 text-center"},Ct={key:2},Pt=["for"],Mt={key:0,class:"ml-1 text-[10px] text-zinc-500 uppercase"},Vt={key:0,class:"relative"},At=["id","onUpdate:modelValue"],Ut=["value"],Ft={key:1,class:"flex items-center"},jt={class:"ml-3 text-sm text-zinc-400"},Et={key:2,class:"relative"},Rt=["id","type","onUpdate:modelValue","placeholder"],Lt=["onClick"],Ht={key:3,class:"text-xs text-zinc-500"},Nt={class:"pt-4 flex items-center justify-end gap-3 border-t border-zinc-800"},qt=fe({__name:"ConfigureServiceModal",props:{show:{type:Boolean},serviceName:{},environmentId:{},getApiUrl:{type:Function},csrfToken:{}},emits:["close","configUpdated"],setup(j,{emit:L}){const u=j,q=L,I=m(!0),V=m(!1),C=m(null),h=m({}),w=m({}),T=F(()=>u.serviceName==="dns"),D=async()=>{if(u.serviceName){I.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/info`))).json();if(c.success&&c.data){C.value=c.data,h.value={...c.data.config};const a={};Object.entries(c.data.configSchema).forEach(([v,f])=>{f.secret&&(a[v]=!1)}),w.value=a}}catch(k){console.error("Failed to fetch service info:",k)}finally{I.value=!1}}},A=async()=>{if(u.serviceName){V.value=!0;try{const c=await(await fetch(u.getApiUrl(`/services/${u.serviceName}/config`),{method:"POST",headers:{"X-CSRF-TOKEN":u.csrfToken,"Content-Type":"application/json"},body:JSON.stringify({config:h.value})})).json();c.success?(q("configUpdated",u.serviceName),q("close")):alert("Failed to update configuration: "+(c.error||"Unknown error"))}catch{alert("Failed to update configuration")}finally{V.value=!1}}},J=k=>{w.value[k]=!w.value[k]};return ze(()=>u.show,k=>{k&&u.serviceName?D():(C.value=null,h.value={})}),ge(()=>{u.show&&u.serviceName&&D()}),(k,c)=>(l(),p(ne,{show:j.show,title:C.value?`Configure ${C.value.label}`:"Configure Service",maxWidth:"max-w-lg",onClose:c[1]||(c[1]=a=>k.$emit("close"))},{default:g(()=>[s("div",St,[I.value?(l(),o("div",_t,[i(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),c[2]||(c[2]=s("p",{class:"text-zinc-500"},"Loading configuration...",-1))])):!C.value&&!T.value?(l(),o("div",$t,[i(t(st),{class:"w-8 h-8 mx-auto text-red-500/50 mb-3"}),c[3]||(c[3]=s("p",{class:"text-zinc-500"},"Failed to load service information.",-1))])):T.value?(l(),o("div",Ct,[i(tt,{"environment-id":j.environmentId},null,8,["environment-id"])])):(l(),o("form",{key:3,onSubmit:Se(A,["prevent"]),class:"space-y-6"},[(l(!0),o(_,null,W(C.value?.configSchema??{},(a,v)=>(l(),o("div",{key:v,class:"space-y-1.5"},[s("label",{for:v,class:"block text-sm font-medium text-zinc-300"},[S(y(a.label)+" ",1),a.secret?(l(),o("span",Mt,"Secret")):z("",!0)],8,Pt),a.enum?(l(),o("div",Vt,[he(s("select",{id:v,"onUpdate:modelValue":f=>h.value[v]=f,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all appearance-none"},[(l(!0),o(_,null,W(a.enum,f=>(l(),o("option",{key:f,value:f},y(f),9,Ut))),128))],8,At),[[De,h.value[v]]]),c[4]||(c[4]=s("div",{class:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-zinc-500"},[s("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[s("path",{d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd","fill-rule":"evenodd"})])],-1))])):a.type==="boolean"?(l(),o("div",Ft,[i(t(Ge),{checked:h.value[v],"onUpdate:checked":f=>h.value[v]=f},null,8,["checked","onUpdate:checked"]),s("span",jt,y(h.value[v]?"Enabled":"Disabled"),1)])):(l(),o("div",Et,[he(s("input",{id:v,type:a.secret&&!w.value[v]?"password":a.type==="integer"?"number":"text","onUpdate:modelValue":f=>h.value[v]=f,class:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-lime-500/50 focus:border-lime-500 transition-all",placeholder:a.default?.toString()},null,8,Rt),[[Be,h.value[v]]]),a.secret?(l(),o("button",{key:0,type:"button",onClick:f=>J(v),class:"absolute inset-y-0 right-0 px-3 flex items-center text-zinc-500 hover:text-zinc-300"},[w.value[v]?(l(),p(t(rt),{key:0,class:"w-4 h-4"})):(l(),p(t(nt),{key:1,class:"w-4 h-4"}))],8,Lt)):z("",!0)])),a.description?(l(),o("p",Ht,y(a.description),1)):z("",!0)]))),128)),s("div",Nt,[i(t($),{type:"button",onClick:c[0]||(c[0]=a=>k.$emit("close")),variant:"outline"},{default:g(()=>[...c[5]||(c[5]=[S(" Cancel ",-1)])]),_:1}),i(t($),{type:"submit",disabled:V.value,variant:"secondary",class:"min-w-[100px] justify-center"},{default:g(()=>[V.value?(l(),p(t(M),{key:0,class:"w-4 h-4 animate-spin mr-2"})):(l(),p(t(ct),{key:1,class:"w-4 h-4 mr-2"})),c[6]||(c[6]=S(" Save Changes ",-1))]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"]))}}),It={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},Tt={class:"text-sm text-zinc-500 mt-1"},Dt={class:"flex items-center gap-2"},Bt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-8 text-center"},Ot={key:1,class:"space-y-6"},Wt={key:0,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 overflow-hidden"},Jt={class:"px-4 py-3 border-b border-zinc-800 bg-zinc-800/30"},Qt={class:"flex items-center justify-between"},Yt={class:"text-sm font-medium text-zinc-100"},Gt={class:"divide-y divide-zinc-800/50"},Xt={class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-md bg-zinc-800/50 border border-zinc-700/50"},Zt={class:"flex-1 min-w-0"},Kt={class:"flex items-center gap-2 flex-wrap"},es={class:"font-medium text-sm text-zinc-100"},ts={key:0,class:"px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full bg-zinc-800/80 text-zinc-400 ring-1 ring-inset ring-zinc-700/50"},ss={class:"text-xs text-zinc-500 mt-0.5 truncate"},ns={key:0,class:"text-zinc-600/70"},ls={key:1,class:"text-zinc-500/70"},as={class:"flex items-center gap-2"},is={class:"flex items-center gap-0.5 opacity-40 hover:opacity-100 transition-opacity"},rs={key:0,class:"px-4 py-3 bg-red-500/5"},os={class:"text-xs text-red-400 bg-red-400/10 border border-red-400/20 rounded px-3 py-2 flex items-center justify-between"},cs=["onClick"],us={class:"flex flex-col max-h-[70vh]"},ds={class:"flex items-center gap-3 px-6 py-3 border-b border-zinc-800 bg-zinc-900/50"},vs={class:"flex-1 overflow-auto p-4 bg-black"},ps={class:"text-xs text-zinc-300 font-mono whitespace-pre-wrap"},ms={class:"p-6"},fs={key:0,class:"py-8 text-center"},gs={class:"grid grid-cols-2 gap-4"},hs={class:"grid grid-cols-2 gap-4"},bs={class:"flex justify-end gap-3 pt-4 border-t border-zinc-800"},As=fe({__name:"Services",props:{environment:{},remoteApiUrl:{},editor:{},localPhpIniPath:{},homebrewPrefix:{}},setup(j){const L=j,u=_e(),q=Ye(),I=Oe(),V=F(()=>!!q.props.reverb?.enabled),C=m(!1);ze(I,n=>{V.value&&n==="failed"&&!C.value&&(C.value=!0,x.warning("Real-time updates unavailable",{description:"Could not connect to Reverb. Status updates may be delayed."}))});const h=n=>L.remoteApiUrl?`${L.remoteApiUrl}${n}`:`/api/environments/${L.environment.id}${n}`,w=F(()=>h("")),T=document.querySelector('meta[name="csrf-token"]')?.content||"",D=F(()=>u.services),A=m(!1),J=F(()=>u.servicesRunning),k=F(()=>u.servicesTotal),c=m(!1),a=m(null),v=m(!1),f=m(!1),le=m(null),ae=m(!1),H=m(null),Y=m(""),Z=m(!1),Q=m(!1);let R=null;const G=m(!1),ie=m(!1),X=m(!1),re=m(""),b=m({upload_max_filesize:"2M",post_max_size:"8M",memory_limit:"128M",max_execution_time:"30",max_children:"5",start_servers:"2",min_spare_servers:"1",max_spare_servers:"3"}),oe={dns:{name:"DNS Server",description:"Resolves local domains to Orbit",icon:$e,ports:"53",category:"core",required:!0},caddy:{name:"Caddy Web Server",description:"HTTPS reverse proxy with automatic certificates",icon:pe,ports:"80, 443",category:"core",required:!0},postgres:{name:"PostgreSQL",description:"Relational database server",icon:se,ports:"5432",category:"database"},mysql:{name:"MySQL",description:"Relational database server",icon:se,ports:"3306",category:"database"},redis:{name:"Redis",description:"In-memory cache and message broker",icon:se,ports:"6379",category:"database",required:!0},mailpit:{name:"Mailpit",description:"Email testing and capture",icon:Ce,ports:"1025, 8025",category:"utility"},reverb:{name:"Laravel Reverb",description:"WebSocket server for real-time features",icon:ut,ports:"8080",category:"utility",required:!0},horizon:{name:"Laravel Horizon",description:"Queue worker management for Redis",icon:xe,category:"utility",required:!0}};function K(n){return n==="caddy"||n.startsWith("php-")||n==="horizon"?"host":"docker"}function Pe(n){if(oe[n])return oe[n];if(n.startsWith("php-")){const e=n.replace("php-","");let r=e;return e.length===2&&!e.includes(".")&&(r=`${e.slice(0,1)}.${e.slice(1)}`),{name:`PHP ${r}`,description:"Native PHP-FPM service",icon:me,category:"php"}}return{name:n,description:"Service",icon:me,category:"utility"}}const Me=[{key:"core",label:"Core Services"},{key:"php",label:"PHP Servers"},{key:"database",label:"Databases"},{key:"utility",label:"Utilities"}],ee=F(()=>{const n={core:[],php:[],database:[],utility:[]};for(const[e,r]of Object.entries(D.value)){const d=Pe(e);n[d.category].push({key:e,service:r,meta:d})}return n.php.sort((e,r)=>e.key.localeCompare(r.key)),n}),Ve=F(()=>J.value===0);function Ae(n){if(!n.startsWith("php-"))return null;const e=n.replace("php-","");return e.includes(".")?e:e.length===2?`${e.slice(0,1)}.${e.slice(1)}`:null}const Ue=F(()=>{const n=ee.value.php.map(({key:e})=>Ae(e)).filter(e=>e!==null);return n.length===0?null:(n.sort((e,r)=>{const[d,P]=e.split(".").map(Number),[U,O]=r.split(".").map(Number);return d!==U?d-U:P-O}),n[n.length-1])});async function Fe(){const n=Ue.value;if(!n){x.error("No PHP services detected");return}re.value=n,ie.value=!0,G.value=!0;try{const e=await fetch(h(`/php/config/${n}`));if(!e.ok)throw new Error("Failed to fetch PHP settings");const r=await e.json();r.success&&r.data?.settings&&(b.value={...b.value,...r.data.settings})}catch(e){x.error(`Error loading PHP settings: ${e}`)}finally{ie.value=!1}}async function je(){X.value=!0;try{const n=await fetch(h(`/php/config/${re.value}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b.value)});if(!n.ok)throw new Error("Failed to save PHP settings");const e=await n.json();e.success?(x.success("PHP Settings Saved",{description:"PHP-FPM has been restarted with the new configuration."}),G.value=!1):x.error("Failed to Save Settings",{description:e.error||"An unknown error occurred."})}catch(n){x.error("Error Saving PHP Settings",{description:String(n)})}finally{X.value=!1}}async function B(n=!1){n||(A.value=!0);try{await u.fetchServices(w.value)}finally{n||(A.value=!1)}}async function Ee(){a.value="stop-all";try{const n=await u.stopAll(w.value);n.success?(x.success("Services Stopping",{description:"All services are being stopped."}),await B(!0)):x.error("Failed to Stop Services",{description:n.error||"An unknown error occurred."})}catch{x.error("Failed to Stop Services",{description:"Could not connect to the server."})}finally{a.value=null}}async function Re(){c.value=!0,a.value="restart-all";try{const n=await u.restartAll(w.value);n.success?(x.success("Services Restarting",{description:"All services are being restarted."}),await B(!0)):x.error("Failed to Restart Services",{description:n.error||"An unknown error occurred."})}catch{x.error("Failed to Restart Services",{description:"Could not connect to the server."})}finally{c.value=!1,a.value=null}}async function ce(n,e){const r=K(n);try{let d;e==="start"?d=await u.startService(n,w.value,r):e==="stop"?d=await u.stopService(n,w.value,r):d=await u.restartService(n,w.value,r),d?.success?d.jobId||await B(!0):x.error(`Failed to ${e} ${n}: `+(d?.error||"Unknown error"))}catch{x.error(`Failed to ${e} ${n}`)}}async function Le(n){if(confirm(`Are you sure you want to remove ${n}?`))try{const e=await u.disableService(n,w.value);e?.success?(x.success(`${n} disabled`),await B(!0)):x.error("Failed to remove service: "+(e?.error||"Unknown error"))}catch{x.error("Failed to remove service")}}function He(n){le.value=n,f.value=!0}async function Ne(n){H.value=n,ae.value=!0,await ue()}async function ue(){if(H.value){Z.value=!0;try{const e=K(H.value)==="host"?`/host-services/${H.value}/logs`:`/services/${H.value}/logs`,d=await(await fetch(h(e))).json();d.success?Y.value=d.logs||"No logs available":Y.value="Failed to fetch logs: "+(d.error||"Unknown error")}catch{Y.value="Failed to fetch logs"}finally{Z.value=!1}}}function qe(){ae.value=!1,H.value=null,Y.value="",Q.value=!1,R&&(clearInterval(R),R=null)}function Ie(){Q.value=!Q.value,Q.value?R=setInterval(ue,3e3):R&&(clearInterval(R),R=null)}function Te(n){return n.icon}return V.value&&We("orbit",".service.status.changed",n=>{u.handleServiceStatusChanged(n.job_id,n.service,n.status,n.error),n.error?x.error(`Failed to ${n.action} ${n.service}: ${n.error}`):x.success(`${n.service} ${n.action} completed`)}),ge(async()=>{u.setActiveEnvironment(L.environment.id),u.isStale&&B(),u.recoverPendingJobs(w.value)}),Je(()=>{R&&clearInterval(R)}),(n,e)=>(l(),o(_,null,[i(t(Qe),{title:`Services - ${j.environment.name}`},null,8,["title"]),s("div",null,[s("header",It,[s("div",null,[e[15]||(e[15]=s("h1",{class:"text-2xl font-semibold tracking-tight text-zinc-100"},"Services",-1)),s("p",Tt,[A.value?(l(),o(_,{key:0},[S("Loading services...")],64)):(l(),o(_,{key:1},[S(y(J.value)+"/"+y(k.value)+" services running",1)],64))])]),s("div",Dt,[i(t($),{onClick:e[0]||(e[0]=r=>v.value=!0),disabled:A.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:g(()=>[i(t(ke),{class:"w-4 h-4 mr-1.5"}),e[16]||(e[16]=S(" Add Service ",-1))]),_:1},8,["disabled"]),Ve.value?z("",!0):(l(),p(t($),{key:0,onClick:Ee,disabled:A.value||a.value!==null,variant:"secondary",size:"sm"},{default:g(()=>[a.value==="stop-all"?(l(),p(t(M),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),p(t(ye),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[17]||(e[17]=S(" Stop All ",-1))]),_:1},8,["disabled"])),i(t($),{onClick:Re,disabled:A.value||a.value!==null,variant:"secondary",size:"sm"},{default:g(()=>[c.value?(l(),p(t(M),{key:0,class:"w-3.5 h-3.5 mr-1.5 animate-spin"})):(l(),p(t(ve),{key:1,class:"w-3.5 h-3.5 mr-1.5"})),e[18]||(e[18]=S(" Restart All ",-1))]),_:1},8,["disabled"])])]),A.value?(l(),o("div",Bt,[i(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[19]||(e[19]=s("p",{class:"text-zinc-500"},"Loading services...",-1))])):(l(),o("div",Ot,[(l(),o(_,null,W(Me,r=>(l(),o(_,{key:r.key},[ee.value[r.key].length>0?(l(),o("div",Wt,[s("div",Jt,[s("div",Qt,[s("h2",Yt,y(r.label),1),r.key==="php"?(l(),p(t($),{key:0,onClick:Fe,variant:"ghost",size:"icon-sm",class:"h-7 w-7 text-zinc-400 hover:text-zinc-100",title:"PHP Settings"},{default:g(()=>[i(t(be),{class:"w-4 h-4"})]),_:1})):z("",!0)])]),s("div",Gt,[(l(!0),o(_,null,W(ee.value[r.key],({key:d,service:P,meta:U})=>(l(),o("div",{key:d,class:"flex items-center gap-4 px-4 py-3 transition-colors hover:bg-zinc-800/30"},[s("div",Xt,[(l(),p(we(Te(U)),{class:"h-4 w-4 text-zinc-400"}))]),s("div",Zt,[s("div",Kt,[s("span",es,y(U.name),1),P.required||U.required?(l(),o("span",ts," Required ")):z("",!0),s("span",{class:te(["px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide rounded-full ring-1 ring-inset",K(d)==="docker"?"bg-blue-500/10 text-blue-400 ring-blue-500/20":"bg-lime-500/10 text-lime-400 ring-lime-500/20"])},y(K(d)),3),s("span",{class:te(["h-2 w-2 rounded-full",P.status==="running"?"bg-lime-400":P.status==="stopped"?"bg-zinc-600":"bg-red-400"])},null,2)]),s("p",ss,[S(y(U.description)+" ",1),U.ports?(l(),o("span",ns," Â· ")):z("",!0),U.ports?(l(),o("span",ls,y(U.ports),1)):z("",!0)])]),s("div",as,[s("span",{class:te(["px-2.5 py-1 text-xs font-medium rounded-full ring-1 ring-inset",P.status==="running"?"bg-lime-500/15 text-lime-400 ring-lime-500/30":P.status==="stopped"?"bg-zinc-800 text-zinc-400 ring-zinc-700":"bg-red-500/15 text-red-400 ring-red-500/30"])},y(P.status==="running"?"Running":P.status==="stopped"?"Stopped":"Error"),3),s("div",is,[P.status!=="running"?(l(),p(t($),{key:0,onClick:O=>ce(d,"start"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-lime-400 hover:bg-zinc-800",title:"Start"},{default:g(()=>[t(u).isServicePending(d)?(l(),p(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),p(t(ot),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):z("",!0),P.status==="running"?(l(),p(t($),{key:1,onClick:O=>ce(d,"stop"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-red-400 hover:bg-zinc-800",title:"Stop"},{default:g(()=>[t(u).isServicePending(d)?(l(),p(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),p(t(ye),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"])):z("",!0),i(t($),{onClick:O=>ce(d,"restart"),disabled:t(u).isServicePending(d),variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800",title:"Restart"},{default:g(()=>[t(u).isServicePending(d)?(l(),p(t(M),{key:0,class:"w-3.5 h-3.5 animate-spin"})):(l(),p(t(ve),{key:1,class:"w-3.5 h-3.5"}))]),_:2},1032,["onClick","disabled"]),i(t(et),null,{default:g(()=>[i(t(Xe),{"as-child":""},{default:g(()=>[i(t($),{variant:"ghost",size:"icon-sm",class:"h-8 w-8 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800"},{default:g(()=>[i(t(it),{class:"w-4 h-4"})]),_:1})]),_:1}),i(t(Ze),{align:"end",class:"w-40"},{default:g(()=>[i(t(de),{onClick:O=>He(d)},{default:g(()=>[i(t(be),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=S(" Settings ",-1))]),_:1},8,["onClick"]),i(t(de),{onClick:O=>Ne(d)},{default:g(()=>[i(t(xe),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=S(" View Logs ",-1))]),_:1},8,["onClick"]),!P.required&&!U.required?(l(),o(_,{key:0},[i(t(Ke)),i(t(de),{onClick:O=>Le(d),disabled:t(u).isServicePending(d),class:"text-red-400 focus:text-red-400"},{default:g(()=>[i(t(lt),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=S(" Remove ",-1))]),_:1},8,["onClick","disabled"])],64)):z("",!0)]),_:2},1024)]),_:2},1024)])])]))),128)),(l(!0),o(_,null,W(ee.value[r.key],({key:d})=>(l(),o(_,{key:`error-${d}`},[t(u).getServiceError(d)?(l(),o("div",rs,[s("div",os,[s("span",null,"Error: "+y(t(u).getServiceError(d)),1),s("button",{onClick:P=>t(u).clearServiceError(d),class:"text-red-400 hover:text-white ml-2"},[i(t(at),{class:"w-3 h-3"})],8,cs)])])):z("",!0)],64))),128))])])):z("",!0)],64))),64))])),i(zt,{show:v.value,"get-api-url":h,"csrf-token":t(T),onClose:e[1]||(e[1]=r=>v.value=!1),onServiceEnabled:e[2]||(e[2]=()=>B())},null,8,["show","csrf-token"]),i(qt,{show:f.value,"service-name":le.value,"environment-id":j.environment.id,"get-api-url":h,"csrf-token":t(T),onClose:e[3]||(e[3]=r=>f.value=!1),onConfigUpdated:e[4]||(e[4]=()=>B())},null,8,["show","service-name","environment-id","csrf-token"]),i(ne,{show:ae.value,title:`${oe[H.value]?.name||H.value} Logs`,maxWidth:"max-w-4xl",onClose:qe},{default:g(()=>[s("div",us,[s("div",ds,[i(t($),{onClick:ue,disabled:Z.value,variant:"ghost",size:"icon-sm",title:"Refresh"},{default:g(()=>[Z.value?(l(),p(t(M),{key:0,class:"w-4 h-4 animate-spin"})):(l(),p(t(ve),{key:1,class:"w-4 h-4"}))]),_:1},8,["disabled"]),s("button",{onClick:Ie,class:te(["text-xs px-2 py-1 rounded-full",Q.value?"bg-lime-500/10 text-lime-400":"bg-zinc-700/50 text-zinc-400 hover:text-white"])},y(Q.value?"Auto-refresh ON":"Auto-refresh"),3)]),s("div",vs,[s("pre",ps,y(Y.value),1)])])]),_:1},8,["show","title"]),i(ne,{show:G.value,title:`PHP ${re.value} Settings`,maxWidth:"max-w-lg",onClose:e[14]||(e[14]=r=>G.value=!1)},{default:g(()=>[s("div",ms,[ie.value?(l(),o("div",fs,[i(t(M),{class:"w-8 h-8 mx-auto text-zinc-600 animate-spin mb-3"}),e[23]||(e[23]=s("p",{class:"text-zinc-500"},"Loading settings...",-1))])):(l(),o("form",{key:1,onSubmit:Se(je,["prevent"]),class:"space-y-6"},[s("div",null,[e[28]||(e[28]=s("h4",{class:"text-sm font-medium text-white mb-3"},"php.ini",-1)),s("div",gs,[s("div",null,[e[24]||(e[24]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Upload Max Filesize",-1)),i(t(N),{modelValue:b.value.upload_max_filesize,"onUpdate:modelValue":e[5]||(e[5]=r=>b.value.upload_max_filesize=r),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[25]||(e[25]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Post Max Size",-1)),i(t(N),{modelValue:b.value.post_max_size,"onUpdate:modelValue":e[6]||(e[6]=r=>b.value.post_max_size=r),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[26]||(e[26]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Memory Limit",-1)),i(t(N),{modelValue:b.value.memory_limit,"onUpdate:modelValue":e[7]||(e[7]=r=>b.value.memory_limit=r),class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[27]||(e[27]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Execution Time (sec)",-1)),i(t(N),{modelValue:b.value.max_execution_time,"onUpdate:modelValue":e[8]||(e[8]=r=>b.value.max_execution_time=r),class:"w-full font-mono"},null,8,["modelValue"])])])]),s("div",null,[e[33]||(e[33]=s("h4",{class:"text-sm font-medium text-white mb-3"},"PHP-FPM Pool",-1)),s("div",hs,[s("div",null,[e[29]||(e[29]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Children",-1)),i(t(N),{modelValue:b.value.max_children,"onUpdate:modelValue":e[9]||(e[9]=r=>b.value.max_children=r),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[30]||(e[30]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Start Servers",-1)),i(t(N),{modelValue:b.value.start_servers,"onUpdate:modelValue":e[10]||(e[10]=r=>b.value.start_servers=r),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[31]||(e[31]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Min Spare Servers",-1)),i(t(N),{modelValue:b.value.min_spare_servers,"onUpdate:modelValue":e[11]||(e[11]=r=>b.value.min_spare_servers=r),type:"number",class:"w-full font-mono"},null,8,["modelValue"])]),s("div",null,[e[32]||(e[32]=s("label",{class:"block text-xs text-zinc-400 mb-1"},"Max Spare Servers",-1)),i(t(N),{modelValue:b.value.max_spare_servers,"onUpdate:modelValue":e[12]||(e[12]=r=>b.value.max_spare_servers=r),type:"number",class:"w-full font-mono"},null,8,["modelValue"])])])]),s("div",bs,[i(t($),{type:"button",variant:"ghost",onClick:e[13]||(e[13]=r=>G.value=!1)},{default:g(()=>[...e[34]||(e[34]=[S(" Cancel ",-1)])]),_:1}),i(t($),{type:"submit",variant:"secondary",disabled:X.value},{default:g(()=>[X.value?(l(),p(t(M),{key:0,class:"w-4 h-4 animate-spin"})):z("",!0),S(" "+y(X.value?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])],32))])]),_:1},8,["show","title"])])],64))}});export{As as default};
