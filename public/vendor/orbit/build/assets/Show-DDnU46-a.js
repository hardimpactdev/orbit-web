import{c as J,d as ae,z as ie,r as c,s as oe,D as re,a,h as r,b as e,u as l,i as ce,g,t as o,x as de,w as f,f as b,e as d,o as n,S as ue,n as E,F as x,E as ve,I as me,j as F,T as U,M as $}from"./app-Bbna9dak.js";import{u as xe}from"./services-DQw4B8a2.js";import{a as w}from"./axios-BgMvqVbd.js";import{I as _,Y as R,d as fe,e as ge,f as pe,B as W,$ as be}from"./craft-ui-C92f09yC.js";import{L as q}from"./loader-circle-BXJ5bexd.js";import{T as he}from"./triangle-alert-CqEb6FB4.js";import{T as ye}from"./trash-2-DaZ2o4F1.js";const ze=J("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);const ke=J("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),we={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},_e={class:"flex items-center gap-3"},Ce={class:"text-2xl font-semibold tracking-tight text-zinc-100"},Se={key:0,class:"px-2 py-0.5 text-xs font-mono bg-zinc-800 text-zinc-400 rounded-full"},Ve={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 p-4 mb-6"},Le={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-4"},Ie={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-lime-500/15"},Te={class:"text-sm font-medium text-zinc-100"},Ae={class:"flex items-center gap-2 mt-0.5"},Ue={class:"relative flex h-2.5 w-2.5"},$e={key:0,class:"absolute inline-flex h-full w-full rounded-full bg-lime-400 opacity-75 animate-ping"},je={key:0,class:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},De={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Ee={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},He={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Me={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},Oe={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Ye={class:"text-2xl font-semibold text-zinc-100 tabular-nums"},Be={key:0,class:"text-xs text-zinc-500"},Ne={class:"flex flex-col gap-1 p-4 rounded-lg bg-zinc-800/30 border border-zinc-800"},Fe={class:"rounded-lg border border-zinc-800 bg-zinc-900/50 mb-6"},Re={class:"flex items-center justify-between p-4 border-b border-zinc-800"},We={class:"p-4 space-y-4"},qe={class:"flex items-start gap-3"},Je={class:"flex h-5 w-5 items-center justify-center rounded-full bg-lime-500/15 mt-0.5"},Ge={class:"text-sm text-lime-400 font-medium break-all"},Ke={class:"flex items-center gap-6 text-sm"},Qe={class:"ml-1 text-zinc-300 font-mono"},Xe={class:"flex items-start gap-3"},Ze={class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-500/15 mt-0.5"},et={key:1,class:"text-zinc-500 text-sm"},tt={key:1,class:"rounded-lg border border-zinc-800 bg-zinc-900/50 mb-6"},st={class:"flex items-center justify-between p-4 border-b border-zinc-800"},nt={key:0,class:"p-4 space-y-4"},lt={key:0,class:"text-zinc-500 text-sm"},at={class:"text-sm text-zinc-100 font-mono bg-zinc-800/50 rounded px-2 py-1.5"},it={key:0},ot={key:1,class:"text-zinc-500"},rt={class:"flex items-center gap-8"},ct={class:"text-sm text-zinc-100 font-mono"},dt={class:"text-sm text-zinc-100 font-mono"},ut={key:1,class:"p-4 space-y-4"},vt={class:"space-y-2"},mt=["onClick"],xt={class:"mt-1 text-xs text-zinc-500"},ft={class:"flex gap-3 pt-2"},wt=ae({__name:"Show",props:{environment:{},installation:{},editor:{},remoteApiUrl:{}},setup(u){const h=u,L=s=>h.remoteApiUrl?`${h.remoteApiUrl}${s}`:`/api/environments/${h.environment.id}${s}`,y=c(null),i=c("idle"),j=c("Connection not tested"),z=xe(),P=c(!0),H=c([]),I=c(!0),M=c({}),v=c(null),D=c(!0),C=c(!1),T=c(!1),p=c([]),S=c(""),A=c("8.4"),V=c(!1),G=de(()=>v.value?.tld||"test");async function O(){i.value="testing",j.value="Testing connection...";try{const{data:s}=await w.post(`/api/environments/${h.environment.id}/test-connection`,{},{signal:y.value?.signal});i.value=s.success?"success":"error",j.value=s.message}catch(s){if(U.isCancel(s))return;i.value="error",j.value="Connection failed"}}async function K(){P.value=!0;try{await z.fetchServices(L(""))}catch(s){console.error("Failed to load services status:",s)}finally{P.value=!1}}async function Y(){I.value=!0;try{const{data:s}=await w.get(L("/sites"),{signal:y.value?.signal});s.success&&s.data&&(H.value=s.data.sites||[])}catch(s){if(U.isCancel(s))return}finally{I.value=!1}}async function Q(){try{const{data:s}=await w.get(L("/worktrees"),{signal:y.value?.signal});if(s.success&&s.data?.worktrees){const t={};for(const m of s.data.worktrees)t[m.site]||(t[m.site]=[]),t[m.site].push(m);M.value=t}}catch(s){if(U.isCancel(s))return}}async function X(){D.value=!0;try{const{data:s}=await w.get(L("/config"),{signal:y.value?.signal});s.success&&(v.value=s.data)}catch(s){if(U.isCancel(s))return}finally{D.value=!1}}async function Z(){V.value=!0;try{const{data:s}=await w.post("/cli/install",{});s.success?window.location.reload():$.error("Failed to install CLI",{description:s.error||"Unknown error"})}catch{}finally{V.value=!1}}function ee(){v.value&&(p.value=[...v.value.paths||[]],p.value.length===0&&p.value.push(""),S.value=v.value.tld||"test",A.value=v.value.default_php_version||"8.4"),C.value=!0}function te(){C.value=!1}function se(){p.value.push("")}function ne(s){p.value.splice(s,1)}async function le(){const s=p.value.filter(t=>t.trim()!=="");if(s.length===0){$.error("Validation Error",{description:"Please add at least one site path"});return}T.value=!0;try{const{data:t}=await w.post(`/environments/${h.environment.id}/config`,{paths:s,tld:S.value.trim()||"test",default_php_version:A.value});t.success?(v.value=t.data,C.value=!1,$.success("Configuration saved"),await Y()):$.error("Failed to save config",{description:t.error||"Unknown error"})}catch{}finally{T.value=!1}}let B=null;return ie(()=>{y.value=new AbortController,B=oe.on("before",()=>{y.value?.abort()}),z.setActiveEnvironment(h.environment.id),O(),h.installation.installed&&(X(),K(),Y(),Q())}),re(()=>{B?.(),y.value?.abort()}),(s,t)=>(n(),a(x,null,[r(l(ce),{title:u.environment.name},null,8,["title"]),e("div",null,[e("header",we,[e("div",_e,[e("h1",Ce,o(u.environment.name),1),v.value?(n(),a("span",Se,"."+o(G.value),1)):g("",!0)]),r(l(_),{onClick:O,variant:"outline",size:"sm",class:"bg-transparent border-zinc-700 text-zinc-300 hover:bg-zinc-800 hover:text-zinc-100"},{default:f(()=>[i.value==="testing"?(n(),b(l(q),{key:0,class:"w-4 h-4 mr-1.5 animate-spin"})):g("",!0),t[2]||(t[2]=d(" Test Connection ",-1))]),_:1})]),e("div",Ve,[e("div",Le,[e("div",Pe,[e("div",Ie,[u.environment.is_local?(n(),b(l(ke),{key:0,class:"h-5 w-5 text-lime-400"})):(n(),b(l(ue),{key:1,class:"h-5 w-5 text-lime-400"}))]),e("div",null,[e("p",Te,o(u.environment.is_local?"Local Machine":`${u.environment.user}@${u.environment.host}`),1),e("div",Ae,[e("span",Ue,[i.value==="success"?(n(),a("span",$e)):g("",!0),e("span",{class:E(["relative inline-flex rounded-full h-2.5 w-2.5",{"bg-zinc-600":i.value==="idle","bg-amber-400":i.value==="testing","bg-lime-400":i.value==="success","bg-red-400":i.value==="error"}])},null,2)]),e("span",{class:E(["text-sm",i.value==="success"?"text-zinc-100":"text-zinc-500"])},o(i.value==="success"?"Connected":i.value==="error"?"Disconnected":i.value==="testing"?"Testing...":"Not tested"),3)])])]),t[3]||(t[3]=e("div",{class:"text-right hidden sm:block"},[e("p",{class:"text-xs text-zinc-500"},"Last sync"),e("p",{class:"text-sm text-zinc-300"},"Just now")],-1))])]),u.installation.installed?(n(),a("div",je,[e("div",De,[t[4]||(t[4]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Sites",-1)),e("span",Ee,[I.value?(n(),a(x,{key:0},[d("-")],64)):(n(),a(x,{key:1},[d(o(H.value.length),1)],64))])]),e("div",He,[t[5]||(t[5]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Workspaces",-1)),e("span",Me,[I.value?(n(),a(x,{key:0},[d("-")],64)):(n(),a(x,{key:1},[d(o(Object.keys(M.value).length),1)],64))])]),e("div",Oe,[t[6]||(t[6]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Services",-1)),e("span",Ye,[P.value?(n(),a(x,{key:0},[d("-")],64)):(n(),a(x,{key:1},[d(o(l(z).servicesRunning)+"/"+o(l(z).servicesTotal),1)],64))]),!P.value&&l(z).servicesRunning===l(z).servicesTotal?(n(),a("span",Be,"All healthy")):g("",!0)]),e("div",Ne,[t[7]||(t[7]=e("span",{class:"text-xs text-zinc-500 uppercase tracking-wide"},"Status",-1)),e("span",{class:E(["text-2xl font-semibold tabular-nums",i.value==="success"?"text-lime-400":i.value==="error"?"text-red-400":"text-zinc-500"])},o(i.value==="success"?"Online":i.value==="error"?"Offline":"Checking"),3)])])):g("",!0),e("div",Fe,[e("div",Re,[t[9]||(t[9]=e("h2",{class:"text-sm font-medium text-zinc-100"},"Orbit Installation",-1)),u.installation.installed?(n(),b(l(_),{key:0,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-zinc-400 hover:text-zinc-100"},{default:f(()=>[r(l(ve),{class:"h-3.5 w-3.5 mr-1"}),t[8]||(t[8]=d(" Open ",-1))]),_:1})):g("",!0)]),e("div",We,[u.installation.installed?(n(),a(x,{key:0},[e("div",qe,[e("div",Je,[r(l(me),{class:"h-3 w-3 text-lime-400"})]),e("div",null,[e("p",Ge,o(u.installation.path),1),t[10]||(t[10]=e("p",{class:"text-xs text-zinc-500 mt-1"},"Installation verified",-1))])]),e("div",Ke,[e("div",null,[t[11]||(t[11]=e("span",{class:"text-zinc-500"},"Version:",-1)),e("span",Qe,o(u.installation.version),1)])])],64)):(n(),a(x,{key:1},[e("div",Xe,[e("div",Ze,[r(l(he),{class:"h-3 w-3 text-amber-400"})]),t[12]||(t[12]=e("div",null,[e("p",{class:"text-sm text-amber-400 font-medium"},"Orbit CLI not found"),e("p",{class:"text-xs text-zinc-500 mt-1"},"Install to manage sites and services")],-1))]),u.environment.is_local?(n(),b(l(_),{key:0,onClick:Z,disabled:V.value,variant:"outline",size:"sm",class:"bg-transparent border-zinc-700 text-zinc-300 hover:bg-zinc-800"},{default:f(()=>[V.value?(n(),b(l(q),{key:0,class:"w-4 h-4 animate-spin mr-1.5"})):(n(),b(l(ze),{key:1,class:"w-4 h-4 mr-1.5"})),d(" "+o(V.value?"Installing...":"Install Orbit CLI"),1)]),_:1},8,["disabled"])):(n(),a("p",et," Install orbit on this environment to manage sites. "))],64))])]),u.installation.installed?(n(),a("div",tt,[e("div",st,[t[14]||(t[14]=e("h2",{class:"text-sm font-medium text-zinc-100"},"Configuration",-1)),C.value?g("",!0):(n(),b(l(_),{key:0,onClick:ee,variant:"ghost",size:"sm",class:"h-7 px-2 text-xs text-zinc-400 hover:text-zinc-100"},{default:f(()=>[...t[13]||(t[13]=[d(" Edit ",-1)])]),_:1}))]),C.value?(n(),a("div",ut,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs text-zinc-500 mb-2"},"Site Paths",-1)),e("div",vt,[(n(!0),a(x,null,F(p.value,(m,k)=>(n(),a("div",{key:k,class:"flex items-center gap-2"},[r(l(R),{modelValue:p.value[k],"onUpdate:modelValue":N=>p.value[k]=N,type:"text",placeholder:"/home/user/sites",class:"flex-1 font-mono text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e("button",{onClick:N=>ne(k),class:"text-zinc-500 hover:text-red-400 p-2 transition-colors"},[r(l(ye),{class:"w-4 h-4"})],8,mt)]))),128))]),e("button",{onClick:se,class:"mt-2 text-xs text-zinc-400 hover:text-zinc-200 transition-colors"}," + Add path ")]),e("div",null,[t[19]||(t[19]=e("label",{for:"config-tld",class:"block text-xs text-zinc-500 mb-1"},"TLD",-1)),r(l(R),{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=m=>S.value=m),type:"text",id:"config-tld",placeholder:"test",class:"w-full max-w-xs font-mono text-sm"},null,8,["modelValue"]),e("p",xt," Sites will be accessible at sitename."+o(S.value||"test"),1)]),e("div",null,[t[22]||(t[22]=e("label",{for:"config-php",class:"block text-xs text-zinc-500 mb-1"},"Default PHP Version",-1)),r(l(be),{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=m=>A.value=m)},{default:f(()=>[r(l(fe),{class:"w-full max-w-xs"},{default:f(()=>[r(l(ge),{placeholder:"Select PHP version"})]),_:1}),r(l(pe),null,{default:f(()=>[r(l(W),{value:"8.3"},{default:f(()=>[...t[20]||(t[20]=[d("PHP 8.3",-1)])]),_:1}),r(l(W),{value:"8.4"},{default:f(()=>[...t[21]||(t[21]=[d("PHP 8.4",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e("div",ft,[r(l(_),{onClick:le,disabled:T.value,size:"sm",class:"bg-lime-500 hover:bg-lime-600 text-zinc-950"},{default:f(()=>[d(o(T.value?"Saving...":"Save changes"),1)]),_:1},8,["disabled"]),r(l(_),{onClick:te,variant:"ghost",size:"sm"},{default:f(()=>[...t[23]||(t[23]=[d("Cancel",-1)])]),_:1})])])):(n(),a("div",nt,[D.value?(n(),a("div",lt," Loading configuration... ")):v.value?(n(),a(x,{key:1},[e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs text-zinc-500 mb-1"},"Site Paths",-1)),e("p",at,[v.value.paths?.length?(n(!0),a(x,{key:0},F(v.value.paths,(m,k)=>(n(),a("span",{key:m},[d(o(m),1),k<v.value.paths.length-1?(n(),a("br",it)):g("",!0)]))),128)):(n(),a("span",ot,"No paths configured"))])]),e("div",rt,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs text-zinc-500 mb-1"},"TLD",-1)),e("p",ct,"."+o(v.value.tld||"test"),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-zinc-500 mb-1"},"Default PHP",-1)),e("p",dt,o(v.value.default_php_version||"8.4"),1)])])],64)):g("",!0)]))])):g("",!0)])],64))}});export{wt as default};
